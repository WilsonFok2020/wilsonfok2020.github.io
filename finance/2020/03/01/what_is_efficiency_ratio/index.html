<!DOCTYPE html> <html lang=" en "><head> <meta charset="utf-8"> <title>Wilson Fok - A data science enthusiast</title> <meta http-equip="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <meta name="description" content="What is efficiency ratio?" /> <meta name="keywords" content="What is efficiency ratio?, Wilson Fok, finance" /> <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml"> <meta content="" property="fb:app_id"> <meta content="Wilson Fok" property="og:site_name"> <meta content="What is efficiency ratio?" property="og:title"> <meta content="article" property="og:type"> <meta content="Correlation between efficiency ratio and log return" property="og:description"> <meta content="/finance/2020/03/01/what_is_efficiency_ratio/" property="og:url"> <meta content="2020-03-01T00:00:00+08:00" property="article:published_time"> <meta content="/about/" property="article:author"> <meta content="finance" property="article:section"> <meta name="twitter:card" content="summary"> <meta name="twitter:site" content="@"> <meta name="twitter:creator" content="@"> <meta name="twitter:title" content="What is efficiency ratio?"> <meta content="Wilson Fok" property="og:site_name"> <meta name="twitter:url" content="/finance/2020/03/01/what_is_efficiency_ratio/"> <meta name="twitter:description" content="Hello, My name is Wilson Fok. I love to extract useful insights and knowledge from big data. I also like to make new friends and connections. Let's connect! "> <!-- load layout style css --> <link rel="stylesheet" href="/assets/css/main.css" /> <link rel="stylesheet" href="/assets/css/custom-style.css" /> <link rel="stylesheet" href="/assets/bower_components/lightgallery/dist/css/lightgallery.min.css"/> <link rel="stylesheet" href="/assets/bower_components/bootstrap/dist/css/bootstrap.min.css" /> <link rel="stylesheet" href="/assets/bower_components/font-awesome/web-fonts-with-css/css/fontawesome-all.min.css" /> <!-- Favicon --> <link rel="icon" href="/assets/img/favicon.ico" type="image/gif" sizes="16x16"> <!-- Jquery --> <!-- one or more of the below scripts does fancy word animation and dropdown menu --> <script src="/assets/extra_js/jquery-3.4.1.min.js"></script> <script src="/assets/extra_js/picturefill min/picturefill.min.js"></script> <script src="/assets/extra_js/instantsearch min/instantsearch.min.js"></script> <script src="/assets/extra_js/moment min/moment.min.js"></script> <script src="/assets/bower_components/jquery.easing/jquery.easing.min.js"></script> <script src="/assets/bower_components/bootstrap/dist/js/bootstrap.bundle.min.js"></script> <script src="/assets/bower_components/jquery-mousewheel/jquery.mousewheel.min.js"></script> <script src="/assets/bower_components/lightgallery/dist/js/lightgallery-all.min.js"></script> <script src="/assets/bower_components/imagesloaded/imagesloaded.pkgd.min.js"></script> <script src="/assets/bower_components/nanobar/nanobar.min.js"></script> <script src="/assets/bower_components/typewrite/dist/typewrite.min.js"></script> </head><body> <div class="container-fluid"><header> <div class="col-lg-12"> <div class="row"> <nav class="navbar navbar-expand-lg fixed-top navbar-dark " id="topNav"> <!-- <a class="navbar-brand" href="#">Wilson Fok</a> --> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="/">Wilson Fok</a> <div class="collapse navbar-collapse" id="navbarNav"> <ul class="navbar-nav"> <li class="nav-item"> <a class="nav-link" href="/about">About Me</a> </li> <li class="nav-item"> <a class="nav-link" href="/blog">Blog</a> </li> <li class="nav-item"> <a class="nav-link" href="/contact">Contact Me</a> </li> </ul> </div> <ul class="nav justify-content-end"> <!-- <li class="nav-item"> <a class="nav-link" id="search-icon" href="/search/"><i class="fa fa-search" aria-hidden="true"></i></a> </li> --> <li class="nav-item"> <input class="nav-link switch" id="theme-toggle" onclick="modeSwitcher() "type="checkbox" name="checkbox" > </li> </ul> </nav> </div> </div> </header><div class="col-lg-12"> <!-- Blog Post Breadcrumbs --><div class="col-lg-12"> <nav aria-label="breadcrumb" role="navigation"> <ol class="breadcrumb"> <li class="breadcrumb-item"> <a href="/blog"><i class="fa fa-home" aria-hidden="true"></i></a> </li> <li class="breadcrumb-item active" aria-current="page"><a href="/finance/2020/03/01/what_is_efficiency_ratio/">What is efficiency ratio?</a></li> </ol> </nav> </div><div class="row" id="blog-post-container"> <div class="col-lg-8 offset-md-2"><article class="card" itemscope itemtype="http://schema.org/BlogPosting"> <div class="card-header"> <!-- <h1 class="post-title" itemprop="name headline">What is efficiency ratio?</h1> --> <h4 class="post-meta">Correlation between efficiency ratio and log return</h4> <p class="post-summary">Posted by : <img src="/assets/img/WilsonFokbiggestABI.png" class="author-profile-img"> <span itemprop="author" itemscope itemtype="http://schema.org/Person"> <span itemprop="name">Wilson Fok</span> </span> on <time datetime="2020-03-01 00:00:00 +0800" itemprop="datePublished">Mar 1, 2020</time> </p> <span class="disqus-comment-count" data-disqus-identifier="/finance/2020/03/01/what_is_efficiency_ratio/"></span> <div class="post-categories"> Category : <a href="/blog/categories/finance">finance</a> </div> </div> <div class="card-body" itemprop="articleBody"> <p>I am going to explore a way to quantify price movement in price action time series stock data and then I am going to evaluate the correlation between movement and the monthly log return of some stocks.</p> <p>I have come across this idea of how to measure noise in the price action time series from this book- <a href="https://www.amazon.com/Creating-Successful-Algorithmic-Trading-Strategy/dp/1119224748/"> A Guide to Creating A Successful Algorithmic Trading Strategy by Perry Kaufman</a>.</p> <p>The tool the author introduced is called efficiency ratio. Efficiency ratio is calculated as the net change of the price over a fixed period divided by the sum of the absolute daily price change. In other words, how many incremental price changes are needed to arrive at the final price from the initial price and the path the initial price travels to reach the final price. In theory, the ratio is mathematically bound between 0 and 1. The higher the efficiency ratio, the price movement would be more like a straight line.</p> <p>Let’s look at some examples. To see how efficiency ratio works in practice, I’ve selected some 500 stocks from the US market and the Hong Kong market because their historical records are available for free at yahoo.com. My stock criteria are:</p> <p><ul> <li>They have no missing price action data. </li> <li>Their end-of-the-day close price is available.</li> <li>They have a long trading history- more than 4000 entries of price actions.</li> <li>Their average daily trading volume is about 5200000.</li> <li>The period in which we do all the calculations must have at least one trade. That is, the trading volume is greater than 0. </li> <li>Prices are positive.</li> </ul> </p> <hr /> <p>Based on the author’s description, I calculate the efficiency ratio like this:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">cal_efficiencyRatio</span><span class="p">(</span><span class="n">x2</span><span class="p">):</span>
    
    <span class="n">total_movement</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">net_change</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">x2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">-</span> <span class="n">x2</span><span class="p">[</span><span class="mi">0</span><span class="p">,:])</span>
    <span class="k">return</span> <span class="n">net_change</span> <span class="o">/</span> <span class="n">total_movement</span><span class="p">,</span> <span class="n">net_change</span><span class="p">,</span> <span class="n">total_movement</span>
</code></pre></div></div> <p>Based on the general definition of log return, I calculate the log return like this:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">lookback_period</span><span class="p">,</span> <span class="n">forward_period</span> <span class="o">=</span> <span class="n">full</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">TRADINGDAYS_YEAR</span><span class="p">],</span> <span class="n">full</span><span class="p">[</span><span class="n">TRADINGDAYS_YEAR</span><span class="p">:]</span>
        
<span class="n">log_return</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">forward_period</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">forward_period</span><span class="p">[</span><span class="mi">0</span><span class="p">,:])</span>
</code></pre></div></div> <p>For every stock, I examine a continuous window of 13-month of price action time series. The efficiency ratio is calculated over the past 12-month. The log return is calculated over the last or 13th month only. The window slides across by 1 trading day to calculate the next efficiency ratio and log return until the end of the time series is reached. To see the effect of the price actions on efficiency ratio, I rank the efficiency ratios under either positive or negative log return.</p> <p>The four figures below show the different efficiency ratio, ranging from low to high. <img src="/assets/images/efficiency_ratio/positive_returns.png" alt="Picture description" class="center-image" /></p> <p>The red line represents the price action over the past 12 months, in which the efficiency ratio is calculated. The blue line represents the price action over the next month / 13th month, in which the log return of the stock is calculated.</p> <p>To make comparison easier, I put the y-axis as the percentage change in price relative to the initial price. X-axis shows the time interval since trading day 0 when the period begins until trading day 300.</p> <p>From these four figures, we can see that as the efficiency ratio rises, the price action patterns become more linear and more like a step-function. The more oscillations, the lower the efficiency. In fact, some very high efficiency ratio comes from a sudden rise or drop in price, perhaps a possible consequence of cooperate actions or announcements.</p> <p>While the above four show positive log return over the next month, I take a closer look at another set of four which show negative or zero log return.</p> <p><img src="/assets/images/efficiency_ratio/negative_returns.png" alt="Picture description" class="center-image" /></p> <p>Another interesting observation is that even though the efficiency ratios are similar, the actual path travelled by the price can be very different. Next, what is the relationship between the efficiency ratio and monthly log return of these stocks?</p> <p><img src="/assets/images/efficiency_ratio/efficiency_returns.png" alt="Picture description" class="center-image" /></p> <p>The figure shows the distribution of efficiency ratio, log return and the cooccurrence of the two. The square figure is a heatmap of the log return vs efficiency ratio. The histograms on the top and on the right show the distributions of efficiency ratio and log return respectively.</p> <p>Most of the values of the efficiency ratio taper off after 0.2 and are very heavily left skewed. The log return appears bell-like with most values tapering off after +- 0.25. I’ve tested its normality using the Shapiro-Wilk test and normality test as follows:</p> <p>Despite its appearance, there is enough evidence to suggest the log return distribution is not normal.</p> <p>The heatmap represents the probability of cooccurrence of the efficiency ratio and log return across their ranges. Red means higher probability of cooccurrence; blue means lower probability. The pattern reveals an ellipse, lying horizontally and radiating outward. This orientation and shape suggest that there is no or little correlation between efficiency ratio over the past 12 months and log return over the next month.</p> <p>Indeed, I’ve calculated their Pearson product-moment correlation coefficient to be about 0.001.</p> <h2> Python script </h2> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">os</span><span class="p">,</span> <span class="n">copy</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="n">mpl</span>


<span class="k">def</span> <span class="nf">plot_hist_density</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span> <span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">,</span> <span class="n">xbins</span><span class="p">,</span> <span class="n">ybins</span><span class="p">):</span>
    
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

    <span class="c1"># Plot parameters - global
</span>    <span class="n">left</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.63</span>
    <span class="n">bottom</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.63</span>
    <span class="n">bottom_h</span> <span class="o">=</span> <span class="n">left_h</span> <span class="o">=</span> <span class="n">left</span> <span class="o">+</span> <span class="n">width</span> <span class="o">+</span> <span class="mf">0.05</span> <span class="c1"># spacing
</span>    <span class="n">rect_2dhist</span> <span class="o">=</span> <span class="p">[</span><span class="n">left</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">]</span>
    <span class="n">rect_histx</span> <span class="o">=</span> <span class="p">[</span><span class="n">left</span><span class="p">,</span> <span class="n">bottom_h</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">]</span>
    <span class="n">rect_histy</span> <span class="o">=</span> <span class="p">[</span><span class="n">left_h</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">height</span><span class="p">]</span>
    
    <span class="c1"># Plot location and size
</span>    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
    <span class="n">ax2dhist</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">rect_2dhist</span><span class="p">)</span>
    <span class="n">axHistx</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">rect_histx</span><span class="p">)</span>
    <span class="n">axHisty</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">rect_histy</span><span class="p">)</span>
    
    
<span class="c1">#    x = np.random.rand(1000)
#    y = np.random.rand(1000)
#    
#    xbins = 10
#    ybins = 10
#    
</span>    <span class="nb">xrange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span><span class="n">x_max</span><span class="p">,</span><span class="n">xbins</span><span class="p">)</span>
    <span class="n">yrange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">y_min</span><span class="p">,</span><span class="n">y_max</span><span class="p">,</span> <span class="n">ybins</span><span class="p">)</span>
<span class="c1">#    xrange = np.linspace(0,0.2,xbins)
#    yrange = np.linspace(-0.5,0.5, ybins)
</span>    
    <span class="n">H</span><span class="p">,</span> <span class="n">xedges</span><span class="p">,</span> <span class="n">yedges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram2d</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="p">(</span><span class="n">yrange</span><span class="p">,</span><span class="nb">xrange</span><span class="p">))</span>
    
    <span class="c1">#normalize
</span>    <span class="n">H</span> <span class="o">=</span> <span class="n">H</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">H</span><span class="p">)</span>
    
    <span class="c1"># Use the bins to find the extent of our plot
#    extent = [yedges[0], yedges[-1], xedges[0], xedges[-1]]
</span>    
    <span class="c1"># levels = (5, 4, 3) # Needed for contours only... 
</span>    
    <span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="nb">xrange</span><span class="p">,</span><span class="n">yrange</span><span class="p">)</span> <span class="c1"># Create a mess over our range of bins
</span>    
    <span class="c1"># Fix colors -- white for values of 1.0. 
</span>    <span class="n">cmap</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">)</span>
    <span class="n">cmap</span><span class="o">.</span><span class="n">set_bad</span><span class="p">(</span><span class="s">'w'</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span>  <span class="c1"># w is color, for values of 1.0
</span>    
    <span class="n">cax</span> <span class="o">=</span> <span class="p">(</span><span class="n">ax2dhist</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">))</span>
    <span class="c1"># Setup the color bar
</span>    <span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cax</span><span class="p">)</span>
    <span class="c1">#cbar.ax.set_yticklabels(['1', '2', '4', '6', '8'], size=24)
</span>    <span class="n">ax2dhist</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">'efficiency ratio'</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">ax2dhist</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">'log return'</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    
    <span class="c1">##########################################################
</span>    <span class="c1"># Create the axes histograms
</span>    <span class="c1">##########################################################
</span>    <span class="c1"># Note that even with log=True, the array N is NOT log of the weighted counts
</span>    <span class="c1"># Eventually we want to normalize these value (in N) by binwidth and overall
</span>    <span class="c1"># simulation volume... but I don't know how to do that.
</span>    <span class="n">N</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">patches</span> <span class="o">=</span> <span class="n">axHistx</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="nb">xrange</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">N</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">patches</span> <span class="o">=</span> <span class="n">axHisty</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">yrange</span><span class="p">,</span>  <span class="n">density</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s">'horizontal'</span><span class="p">)</span>


<span class="c1">#
</span><span class="k">def</span> <span class="nf">cal_efficiencyRatio</span><span class="p">(</span><span class="n">x2</span><span class="p">):</span>
    
    <span class="n">total_movement</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">net_change</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">x2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">-</span> <span class="n">x2</span><span class="p">[</span><span class="mi">0</span><span class="p">,:])</span>
    <span class="k">return</span> <span class="n">net_change</span> <span class="o">/</span> <span class="n">total_movement</span><span class="p">,</span> <span class="n">net_change</span><span class="p">,</span> <span class="n">total_movement</span>
    

<span class="c1">##########################
</span><span class="k">def</span> <span class="nf">array_generator</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">interval</span><span class="p">):</span>
    
    <span class="n">L</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">start</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="o">-</span><span class="n">interval</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
<span class="c1">#        print (start, start+interval)
</span>        <span class="k">yield</span> <span class="n">x</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">start</span><span class="o">+</span><span class="n">interval</span><span class="p">][:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    

<span class="n">cwd</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span>

<span class="n">TRADINGDAYS_YEAR</span> <span class="o">=</span> <span class="mi">270</span>
<span class="n">TRADINGDAYS_MONTH</span> <span class="o">=</span><span class="nb">int</span><span class="p">(</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">TRADINGDAYS_YEAR</span> <span class="o">/</span> <span class="mi">12</span><span class="p">))</span>
<span class="n">LOOKBACK_ONEMONTH</span> <span class="o">=</span> <span class="n">TRADINGDAYS_YEAR</span> <span class="o">+</span> <span class="n">TRADINGDAYS_MONTH</span>    




<span class="n">filePath</span> <span class="o">=</span> <span class="p">(</span><span class="n">cwd</span> <span class="o">/</span> <span class="s">'../blogs/price_action_data_stats.csv'</span> <span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filePath</span><span class="p">)</span>

<span class="n">ratio_table</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

<span class="n">stock_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s">'path'</span><span class="p">]</span><span class="o">.</span><span class="nb">apply</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">)[</span><span class="o">-</span><span class="mi">500</span><span class="p">:])</span>

<span class="k">print</span> <span class="p">(</span><span class="s">'average daily trading volume {}'</span><span class="o">.</span><span class="nb">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s">'average_trading_volume'</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">500</span><span class="p">:])))</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">500</span><span class="p">):</span>
    <span class="k">print</span> <span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'path'</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="n">i</span><span class="p">]</span>

    
    <span class="n">pa</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">pa</span><span class="p">[</span><span class="s">'Close'</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">vol</span> <span class="o">=</span> <span class="n">pa</span><span class="p">[</span><span class="s">'Volume'</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    
    <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="p">(</span><span class="n">full</span><span class="p">,</span> <span class="n">full_vol</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">array_generator</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">LOOKBACK_ONEMONTH</span><span class="p">),</span> 
                                 <span class="n">array_generator</span><span class="p">(</span><span class="n">vol</span><span class="p">,</span> <span class="n">LOOKBACK_ONEMONTH</span><span class="p">))):</span>
        <span class="n">lookback_period</span><span class="p">,</span> <span class="n">forward_period</span> <span class="o">=</span> <span class="n">full</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">TRADINGDAYS_YEAR</span><span class="p">],</span> <span class="n">full</span><span class="p">[</span><span class="n">TRADINGDAYS_YEAR</span><span class="p">:]</span>
        
        <span class="n">log_return</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">forward_period</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">forward_period</span><span class="p">[</span><span class="mi">0</span><span class="p">,:])</span>
        
        <span class="n">ratio</span><span class="p">,</span> <span class="n">net_change</span><span class="p">,</span> <span class="n">total_movement</span> <span class="o">=</span> <span class="n">cal_efficiencyRatio</span><span class="p">(</span><span class="n">lookback_period</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">ratio</span><span class="p">):</span>
            <span class="k">print</span> <span class="p">(</span><span class="s">'i {}, t{}, ratio {}, net change {}, total movement {}'</span><span class="o">.</span><span class="nb">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span>
                   <span class="n">ratio</span><span class="p">,</span> <span class="n">net_change</span><span class="p">,</span> <span class="n">total_movement</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="n">ratio_table</span><span class="p">[</span><span class="s">'path'</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">ratio_table</span><span class="p">[</span><span class="s">'time'</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="n">ratio_table</span><span class="p">[</span><span class="s">'log_return'</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">log_return</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">ratio_table</span><span class="p">[</span><span class="s">'efficiency_ratio'</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ratio</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">ratio_table</span><span class="p">[</span><span class="s">'volume'</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="nb">min</span><span class="p">(</span><span class="n">full_vol</span><span class="p">))</span>


<span class="n">ratio_table_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">ratio_table</span><span class="p">)</span>   

<span class="n">liquid_ratio</span> <span class="o">=</span> <span class="n">ratio_table_df</span><span class="p">[</span><span class="n">ratio_table_df</span><span class="p">[</span><span class="s">'volume'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> 


<span class="n">plot_hist_density</span><span class="p">(</span><span class="n">liquid_ratio</span><span class="p">[</span><span class="s">'efficiency_ratio'</span><span class="p">],</span>
                  <span class="n">liquid_ratio</span><span class="p">[</span><span class="s">'log_return'</span><span class="p">],</span>
                  <span class="mi">0</span><span class="p">,</span>
                  <span class="mf">0.4</span><span class="p">,</span>
                  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                  <span class="mi">1</span><span class="p">,</span>
                  <span class="mi">200</span><span class="p">,</span>
                  <span class="mi">200</span><span class="p">)</span> 


<span class="c1">###############################################
</span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="k">print</span> <span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">shapiro</span><span class="p">(</span><span class="n">liquid_ratio</span><span class="p">[</span><span class="s">'log_return'</span><span class="p">]))</span>

<span class="n">k2</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">normaltest</span><span class="p">(</span><span class="n">liquid_ratio</span><span class="p">[</span><span class="s">'log_return'</span><span class="p">])</span>

<span class="n">alpha</span> <span class="o">=</span> <span class="mf">1e-3</span>

<span class="k">if</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="n">alpha</span><span class="p">:</span>
    <span class="k">print</span> <span class="p">(</span><span class="s">'the null hypothesis can be rejected'</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span> <span class="p">(</span><span class="s">'the null hypothesis cannot be rejected'</span><span class="p">)</span>


<span class="k">print</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">liquid_ratio</span><span class="p">[</span><span class="s">'efficiency_ratio'</span><span class="p">],</span>
                  <span class="n">liquid_ratio</span><span class="p">[</span><span class="s">'log_return'</span><span class="p">]))</span> 
</code></pre></div></div> </div> <div id="disqus_thread"></div> </article> <script> var disqus_config = function () { this.page.url = "/finance/2020/03/01/what_is_efficiency_ratio/"; /* Replace PAGE_URL with your page's canonical URL variable */ this.page.identifier = "/finance/2020/03/01/what_is_efficiency_ratio"; /* Replace PAGE_IDENTIFIER with your page's unique identifier variable */ }; (function () { /* DON'T EDIT BELOW THIS LINE */ var d = document, s = d.createElement('script'); s.src = 'https://.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a> </noscript></div> </div> <!-- End of row--> <div class="row"> <div class="col-md-4"> <div class="card"> <div class="card-header"> About </div> <div class="card-body"> <!-- Your Bio --> <p class="author_bio"> Hello, My name is Wilson Fok. I love to extract useful insights and knowledge from big data. Constructive feedback and insightful comments are very welcome!</p> </div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-header">Categories </div> <div class="card-body text-dark"> <div id="#finance"></div> <li class="tag-head"> <a href="/blog/categories/finance">finance</a> </li> <a name="finance"></a> </div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-header">Useful Links </div> <div class="card-body text-dark"> <li > <a href="/about">About Me</a> </li> <li > <a href="/blog">Blog</a> </li> <li > <a href="/contact">Contact Me</a> </li> </div> </div> </div> </div> </div> <footer> <p> Powered by Jekyll. Hosted on <a href="https://pages.github.com">Github</a>. Subscribe via <a href=" /feed.xml ">RSS <i class="fa fa-rss" aria-hidden="true"></i> </a> </p> </footer> </div> <script> var options = { classname: 'my-class', id: 'my-id' }; var nanobar = new Nanobar( options ); nanobar.go( 30 ); nanobar.go( 76 ); nanobar.go(100); </script> <!-- <div hidden id="snipcart" data-api-key="Y2I1NTAyNWYtMTNkMy00ODg0LWE4NDItNTZhYzUxNzJkZTI5NjM3MDI4NTUzNzYyMjQ4NzU0"></div> <script src="https://cdn.snipcart.com/themes/v3.0.0-beta.3/default/snipcart.js" defer></script> --> <script src="/assets/js/mode-switcher.js"></script> </body> </html>
