<!DOCTYPE html> <html lang=" en "><head> <meta charset="utf-8"> <title>Wilson Fok - A data science enthusiast</title> <meta http-equip="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <meta name="description" content="Gold and Silver" /> <meta name="keywords" content="Gold and Silver, Wilson Fok, Finance" /> <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml"> <meta content="" property="fb:app_id"> <meta content="Wilson Fok" property="og:site_name"> <meta content="Gold and Silver" property="og:title"> <meta content="article" property="og:type"> <meta content="the price movement of gold and silver" property="og:description"> <meta content="/finance/2020/04/25/gold_silver/" property="og:url"> <meta content="2020-04-25T00:00:00+08:00" property="article:published_time"> <meta content="/about/" property="article:author"> <meta content="Finance" property="article:section"> <meta name="twitter:card" content="summary"> <meta name="twitter:site" content="@"> <meta name="twitter:creator" content="@"> <meta name="twitter:title" content="Gold and Silver"> <meta content="Wilson Fok" property="og:site_name"> <meta name="twitter:url" content="/finance/2020/04/25/gold_silver/"> <meta name="twitter:description" content="Hello, My name is Wilson Fok. I love to extract useful insights and knowledge from big data. I also like to make new friends and connections. Let's connect! "> <!-- load layout style css --> <link rel="stylesheet" href="/assets/css/main.css" /> <link rel="stylesheet" href="/assets/css/custom-style.css" /> <link rel="stylesheet" href="/assets/bower_components/lightgallery/dist/css/lightgallery.min.css"/> <link rel="stylesheet" href="/assets/bower_components/bootstrap/dist/css/bootstrap.min.css" /> <link rel="stylesheet" href="/assets/bower_components/font-awesome/web-fonts-with-css/css/fontawesome-all.min.css" /> <!-- Favicon --> <link rel="icon" href="/assets/img/favicon.ico" type="image/gif" sizes="16x16"> <!-- Jquery --> <!-- one or more of the below scripts does fancy word animation and dropdown menu --> <script src="/assets/extra_js/jquery-3.4.1.min.js"></script> <script src="/assets/extra_js/picturefill min/picturefill.min.js"></script> <script src="/assets/extra_js/instantsearch min/instantsearch.min.js"></script> <script src="/assets/extra_js/moment min/moment.min.js"></script> <script src="/assets/bower_components/jquery.easing/jquery.easing.min.js"></script> <script src="/assets/bower_components/bootstrap/dist/js/bootstrap.bundle.min.js"></script> <script src="/assets/bower_components/jquery-mousewheel/jquery.mousewheel.min.js"></script> <script src="/assets/bower_components/lightgallery/dist/js/lightgallery-all.min.js"></script> <script src="/assets/bower_components/imagesloaded/imagesloaded.pkgd.min.js"></script> <script src="/assets/bower_components/nanobar/nanobar.min.js"></script> <script src="/assets/bower_components/typewrite/dist/typewrite.min.js"></script> </head><body> <div class="container-fluid"><header> <div class="col-lg-12"> <div class="row"> <nav class="navbar navbar-expand-lg fixed-top navbar-dark " id="topNav"> <!-- <a class="navbar-brand" href="#">Wilson Fok</a> --> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="/">Wilson Fok</a> <div class="collapse navbar-collapse" id="navbarNav"> <ul class="navbar-nav"> <li class="nav-item"> <a class="nav-link" href="/about">About Me</a> </li> <li class="nav-item"> <a class="nav-link" href="/blog">Blog</a> </li> <li class="nav-item"> <a class="nav-link" href="/blog/categories">Categories</a> </li> <li class="nav-item"> <a class="nav-link" href="/contact">Contact Me</a> </li> </ul> </div> <ul class="nav justify-content-end"> <!-- <li class="nav-item"> <a class="nav-link" id="search-icon" href="/search/"><i class="fa fa-search" aria-hidden="true"></i></a> </li> --> <li class="nav-item"> <input class="nav-link switch" id="theme-toggle" onclick="modeSwitcher() "type="checkbox" name="checkbox" > </li> </ul> </nav> </div> </div> </header><div class="col-lg-12"> <!-- Blog Post Breadcrumbs --><div class="col-lg-12"> <nav aria-label="breadcrumb" role="navigation"> <ol class="breadcrumb"> <li class="breadcrumb-item"> <a href="/blog"><i class="fa fa-home" aria-hidden="true"></i></a> </li> <li class="breadcrumb-item active" aria-current="page"><a href="/finance/2020/04/25/gold_silver/">Gold and Silver</a></li> </ol> </nav> </div><div class="row" id="blog-post-container"> <div class="col-lg-8 offset-md-2"><article class="card" itemscope itemtype="http://schema.org/BlogPosting"> <div class="card-header"> <h1 class="post-title" itemprop="name headline">Gold and Silver</h1> <p></p> <h6 class="post-meta"> <i> Summary : the price movement of gold and silver</i> </h6> <p class="post-summary">Posted by : <img src="/assets/img/profile.png" class="author-profile-img"> <span itemprop="author" itemscope itemtype="http://schema.org/Person"> <span itemprop="name">Wilson Fok</span> </span> on <time datetime="2020-04-25 00:00:00 +0800" itemprop="datePublished">Apr 25, 2020</time> </p> <span class="disqus-comment-count" data-disqus-identifier="/finance/2020/04/25/gold_silver/"></span> <div class="post-categories"> Category : <a href="/blog/categories/Finance">Finance</a> </div> </div> <div class="card-body" itemprop="articleBody"> <p>Silver and gold are the most widely known precious metals. Apart from silver and gold, precious metals include platinum and palladium. However, what so special about silver and gold is that they have a long history of being used as money, even though they are no longer used as “money” today.</p> <p>This article explores the price movement of silver and gold over the recent decades. Even though there are many ways to invest in precious metals, namely futures, contracts for differences, ETFs, owning miner stocks, or owning physical bullions, I pick the ETF way for simplicity. To track the prices of the two metals, I used ETF: GLD to track gold prices and ETF: SLV to track silver prices. This comes with an implicit assumption that the tracking errors of the ETFs are negligible, and the market close price is representative of the metal prices longterm.</p> <h3 id="correlation-between-gold-and-silver">Correlation between gold and silver</h3> <p>Of late, gold price has risen by significant amount. Let’s review gold and silver price movement of the past decades.</p> <p><img src="/assets/images/gold_silver/gold_silver_prices.png" alt="Picture description" class="center-image" /></p> <p>At first glance, gold and silver seem to move together or correlated. Let’s assume we buy and hold the metal and let’s calculate the return (in percentage based on the ETF price change) over different time lags(steps or holding periods) including 30, 90, 180, 360 trading days. These steps roughly translate to 1 month, 3 months, 6 months and 1 year time periods.</p> <p>The correlation is calculated based on Pearson Product Moment Correlation. The windows used for the correlation calculation match the step sizes. Thus, this helps to show how the correlation varies with different holding periods of gold and silver and with different number of observations.</p> <p>When we look more closely at the correlations, we can see there are periods when gold and silver largely move in tandem ( values greater than 0.7) and when the two metals move apart in opposite direction (values less than -0.1). With fewer observations (&lt;90), the correlations oscillate significantly and widely. The oscillation reduces with more observations. As the holding period increase, the swing becomes wider also, thereby making the pattern more apparent.</p> <p><img src="/assets/images/gold_silver/correlation_step30.png" alt="Picture description" class="center-image" /> <img src="/assets/images/gold_silver/correlation_step90.png" alt="Picture description" class="center-image" /> <img src="/assets/images/gold_silver/correlation_step180.png" alt="Picture description" class="center-image" /> <img src="/assets/images/gold_silver/correlation_step360.png" alt="Picture description" class="center-image" /></p> <h4 id="how-many-times-the-returns-of-gold-and-silver-move-in-one-direction-or-move-in-opposite-direction">How many times the returns of gold and silver move in one direction or move in opposite direction?</h4> <p><img src="/assets/images/gold_silver/proportion_sign.png" alt="Picture description" class="center-image" /></p> <p>Answer: very often (shown in red)</p> <p>I would like to draw several observations:</p> <ul> <li>Gold versus silver ratio cannot hold or must oscillate widely whenever the correlation becomes so unstable</li> <li>Even though gold and silver are precious metal, they can exhibit opposite behaviors as indicated by the negative correlations.</li> <li>I think after all silver has a large demand from industrial companies for manufacturing a wide array of products. Gold, on the other hand, has little industrial use (except for jewelry).</li> </ul> <h4 id="what-is-the-distribution-of-returns-when-gold-and-silver-move-in-the-same-direction-or-in-the-opposite-direction">What is the distribution of returns when gold and silver move in the same direction or in the opposite direction?</h4> <p>Let’s take a look at situation in which gold and silver move in the same direction. Each figure show the distribution of returns (counts on y-axis; return magnitude on x-axis) (gold in green; silver in blue) with its holding period written on top. Their median is shown by a vertical line.</p> <p><img src="/assets/images/gold_silver/hist_same_30.png" alt="Picture description" class="center-image" /> <img src="/assets/images/gold_silver/hist_same_90.png" alt="Picture description" class="center-image" /> <img src="/assets/images/gold_silver/hist_same_180.png" alt="Picture description" class="center-image" /> <img src="/assets/images/gold_silver/hist_same_360.png" alt="Picture description" class="center-image" /></p> <p>Silver is far more volatile than gold as its distribution is wider.</p> <p>Now, we turn our attention to what happens when the returns of the two move in opposite direction. Silver tends to lose money; gold tends to make money.</p> <p><img src="/assets/images/gold_silver/hist_opposite_30.png" alt="Picture description" class="center-image" /> <img src="/assets/images/gold_silver/hist_opposite_90.png" alt="Picture description" class="center-image" /> <img src="/assets/images/gold_silver/hist_opposite_180.png" alt="Picture description" class="center-image" /> <img src="/assets/images/gold_silver/hist_opposite_360.png" alt="Picture description" class="center-image" /></p> <h3 id="backtesting-of-a-9010-gold-versus-silver-portfolio">Backtesting of a 90:10 gold versus silver portfolio</h3> <p>Quantopian algorithm backtesting platform has provided a summary of the performance.</p> <table> <tbody> <tr> <td>Annual return</td> <td>6.26%</td> </tr> <tr> <td>Cumulative returns</td> <td>133.531%</td> </tr> <tr> <td>Annual volatility</td> <td>19.246%</td> </tr> <tr> <td>Sharpe ratio</td> <td>0.41</td> </tr> <tr> <td>Calmar ratio</td> <td>0.13</td> </tr> <tr> <td>Stability</td> <td>0.32</td> </tr> <tr> <td>Max drawdown</td> <td>-48.222%</td> </tr> <tr> <td>Omega ratio</td> <td>1.08</td> </tr> <tr> <td>Sortino ratio</td> <td>0.58</td> </tr> <tr> <td>Skew</td> <td>-0.20</td> </tr> <tr> <td>Kurtosis</td> <td>6.85</td> </tr> <tr> <td>Tail ratio</td> <td>1.01</td> </tr> <tr> <td>Daily value at risk</td> <td>-2.393%</td> </tr> <tr> <td>Gross leverage</td> <td>1.00</td> </tr> <tr> <td>Daily turnover</td> <td>0.095%</td> </tr> <tr> <td>Alpha</td> <td>0.07</td> </tr> <tr> <td>Beta</td> <td>0.06</td> </tr> </tbody> </table> <p>The portfolio’s returns during different time periods or events are summarized below.</p> <table> <thead> <tr> <th>Stress Events</th> <th style="text-align: center">mean</th> <th style="text-align: center">min</th> <th style="text-align: center">max</th> </tr> </thead> <tbody> <tr> <td>Lehman</td> <td style="text-align: center">-0.13%</td> <td style="text-align: center">-5.39%</td> <td style="text-align: center">11.98%</td> </tr> <tr> <td>US downgrade/European Debt Crisis</td> <td style="text-align: center">0.64%</td> <td style="text-align: center">-3.85%</td> <td style="text-align: center">3.73%</td> </tr> <tr> <td>Fukushima</td> <td style="text-align: center">0.35%</td> <td style="text-align: center">-0.80%</td> <td style="text-align: center">1.65%</td> </tr> <tr> <td>EZB IR Event</td> <td style="text-align: center">0.06%</td> <td style="text-align: center">-0.93%</td> <td style="text-align: center">2.25%</td> </tr> <tr> <td>Aug07</td> <td style="text-align: center">0.02%</td> <td style="text-align: center">-2.44%</td> <td style="text-align: center">1.73%</td> </tr> <tr> <td>Mar08</td> <td style="text-align: center">-0.49%</td> <td style="text-align: center">-4.03%</td> <td style="text-align: center">3.19%</td> </tr> <tr> <td>Sept08</td> <td style="text-align: center">0.23%</td> <td style="text-align: center">-5.39%</td> <td style="text-align: center">11.98%</td> </tr> <tr> <td>2009Q1</td> <td style="text-align: center">0.21%</td> <td style="text-align: center">-3.94%</td> <td style="text-align: center">4.64%</td> </tr> <tr> <td>2009Q2</td> <td style="text-align: center">0.09%</td> <td style="text-align: center">-2.94%</td> <td style="text-align: center">3.28%</td> </tr> <tr> <td>Flash Crash</td> <td style="text-align: center">0.60%</td> <td style="text-align: center">-0.47%</td> <td style="text-align: center">2.86%</td> </tr> <tr> <td>Apr14</td> <td style="text-align: center">-0.01%</td> <td style="text-align: center">-1.82%</td> <td style="text-align: center">1.26%</td> </tr> <tr> <td>Oct14</td> <td style="text-align: center">-0.14%</td> <td style="text-align: center">-2.21%</td> <td style="text-align: center">1.42%</td> </tr> <tr> <td>Fall2015</td> <td style="text-align: center">-0.01%</td> <td style="text-align: center">-1.51%</td> <td style="text-align: center">2.11%</td> </tr> <tr> <td>Low Volatility Bull Market</td> <td style="text-align: center">0.01%</td> <td style="text-align: center">-7.10%</td> <td style="text-align: center">3.64%</td> </tr> <tr> <td>GFC Crash</td> <td style="text-align: center">0.09%</td> <td style="text-align: center">-8.38%</td> <td style="text-align: center">11.98%</td> </tr> <tr> <td>Recovery</td> <td style="text-align: center">0.07%</td> <td style="text-align: center">-6.29%</td> <td style="text-align: center">3.73%</td> </tr> <tr> <td>New Normal</td> <td style="text-align: center">0.00%</td> <td style="text-align: center">-9.16%</td> <td style="text-align: center">5.06%</td> </tr> </tbody> </table> <p><img src="/assets/images/gold_silver/gold_90_silver_10_performance_snapshot.png" alt="Picture description" class="center-image" /></p> <hr /> <p>Below shows an overall summary of the performance over the entire period.</p> <p><img src="/assets/images/gold_silver/gold_90_silver_10_performance_summary.png" alt="Picture description" class="center-image" /></p> <h4 id="various-mix-of-gold-and-silver-portfolio">Various mix of gold and silver portfolio</h4> <p>From 2006-05-01 to 2020-04-23, inclusion of silver reduces returns and increases risk.</p> <p><img src="/assets/images/gold_silver/backtesting.png" alt="Picture description" class="center-image" /></p> <h4 id="python-code">Python code</h4> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="k">def</span> <span class="nf">custom_change_percentage</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    


<span class="k">def</span> <span class="nf">cal_change_percentage</span><span class="p">(</span><span class="n">price_dict</span><span class="p">,</span> <span class="n">ticker</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">latest</span><span class="p">):</span>
    
<span class="c1">#     print ('from {}'.format(latest))
#     print ('---%s---' %ticker)
</span>    
    <span class="n">series</span> <span class="o">=</span> <span class="n">price_dict</span><span class="p">[</span><span class="n">ticker</span><span class="p">]</span>
    <span class="n">series</span> <span class="o">=</span> <span class="n">cut_from</span><span class="p">(</span><span class="n">latest</span><span class="p">,</span> <span class="n">series</span><span class="p">)</span>
    <span class="n">series</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">step</span><span class="p">)</span><span class="o">.</span><span class="nb">apply</span><span class="p">(</span><span class="n">custom_change_percentage</span><span class="p">)</span>
    <span class="n">series</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">series</span>
    


<span class="k">def</span> <span class="nf">cut_from</span><span class="p">(</span><span class="n">latest</span><span class="p">,</span> <span class="n">series</span><span class="p">):</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span> <span class="n">latest</span>
    <span class="n">where</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span> <span class="o">==</span> <span class="bp">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">series</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">where</span><span class="p">:]</span>
    

<span class="k">def</span> <span class="nf">build_change_price_dict</span><span class="p">(</span><span class="n">price_dict</span><span class="p">,</span> <span class="n">ticker</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">date0</span><span class="p">):</span>
    
    <span class="n">latest</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">date0</span><span class="p">[</span><span class="n">ticker</span><span class="p">]</span> <span class="k">for</span> <span class="n">ticker</span> <span class="ow">in</span> <span class="n">basket</span><span class="p">])</span>
    
    <span class="k">for</span> <span class="n">ticker</span> <span class="ow">in</span> <span class="n">basket</span><span class="p">:</span>

        <span class="n">ch_per</span> <span class="o">=</span> <span class="n">cal_change_percentage</span><span class="p">(</span><span class="n">price_dict</span><span class="p">,</span> <span class="n">ticker</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">latest</span><span class="p">)</span>
        <span class="n">price_dict2</span><span class="p">[</span><span class="n">ticker</span><span class="p">]</span> <span class="o">=</span> <span class="n">ch_per</span>
        
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">price_dict2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>

<span class="k">def</span> <span class="nf">cal_correlation_classes</span><span class="p">(</span><span class="n">price_dict</span><span class="p">,</span> <span class="n">ticker</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">date0</span><span class="p">,</span> <span class="n">basket</span><span class="p">,</span> <span class="n">windows</span><span class="p">):</span>
    
    <span class="n">correlation_dict_windows</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="n">dfs</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">basket</span><span class="p">,</span> <span class="mi">2</span><span class="p">)):</span>

        <span class="k">print</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">asset_classes</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">asset_classes</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
        
        
        <span class="c1"># build price dict, add gaps
</span>                
        <span class="n">df</span> <span class="o">=</span> <span class="n">build_change_price_dict</span><span class="p">(</span><span class="n">price_dict</span><span class="p">,</span> <span class="n">ticker</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">date0</span><span class="p">)</span>
        <span class="n">correlation_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">window</span> <span class="ow">in</span> <span class="n">windows</span><span class="p">:</span>

            <span class="n">c</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">)</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>


            <span class="n">correlation_dict</span><span class="p">[</span><span class="n">window</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span>

        <span class="n">key</span> <span class="o">=</span> <span class="n">asset_classes</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="s">'_vs_'</span><span class="o">+</span> <span class="n">asset_classes</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">dfs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span>
        <span class="n">correlation_dict_windows</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">correlation_dict</span>
    <span class="k">return</span> <span class="n">correlation_dict_windows</span><span class="p">,</span> <span class="n">dfs</span>

<span class="k">def</span> <span class="nf">plot_correlations</span><span class="p">(</span><span class="n">correlation_dict_windows</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="mi">360</span><span class="p">):</span>

    <span class="k">for</span> <span class="n">comparison</span><span class="p">,</span> <span class="n">correlation_dict</span> <span class="ow">in</span> <span class="n">correlation_dict_windows</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">comparison</span> <span class="o">+</span> <span class="s">'_step_'</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">step</span><span class="p">))</span>


        <span class="k">for</span> <span class="n">window</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">correlation_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            
<span class="c1">#             print (value)
</span>            <span class="n">L</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">L</span> <span class="o">&lt;</span> <span class="n">period</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">window</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="n">period</span><span class="p">:],</span> <span class="n">label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">window</span><span class="p">))</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s">'both'</span><span class="p">)</span>



        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s">'lower left'</span><span class="p">)</span>
    

<span class="n">price_dict2</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">basket</span> <span class="o">=</span> <span class="p">[</span><span class="s">'GLD'</span><span class="p">,</span> <span class="s">'SLV'</span><span class="p">]</span>
<span class="n">steps</span> <span class="o">=</span> <span class="p">[</span><span class="mi">30</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="mi">180</span><span class="p">,</span> <span class="mi">360</span><span class="p">]</span>
<span class="n">windows</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">360</span><span class="p">]</span>

<span class="n">same</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">opp</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">gold_dist</span> <span class="o">=</span> <span class="p">{</span><span class="s">'same'</span><span class="p">:{},</span>
            <span class="s">'opposite'</span><span class="p">:{}}</span>
<span class="n">silver_dist</span> <span class="o">=</span> <span class="p">{</span><span class="s">'same'</span><span class="p">:{},</span>
            <span class="s">'opposite'</span><span class="p">:{}}</span>
<span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">steps</span><span class="p">:</span>
    
    
    
    
    <span class="n">correlation_dict_windows</span><span class="p">,</span> <span class="n">dfs</span> <span class="o">=</span> <span class="n">cal_correlation_classes</span><span class="p">(</span><span class="n">price_dict</span><span class="p">,</span> <span class="n">ticker</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">date0</span><span class="p">,</span> <span class="n">basket</span><span class="p">,</span> <span class="n">windows</span><span class="p">)</span>
    
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dfs</span><span class="p">[</span><span class="s">'gold_vs_silver'</span><span class="p">][</span><span class="s">'GLD'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dfs</span><span class="p">[</span><span class="s">'gold_vs_silver'</span><span class="p">][</span><span class="s">'SLV'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">c</span> <span class="o">=</span> <span class="n">a</span> <span class="o">==</span> <span class="n">b</span>
    <span class="n">gold_dist</span><span class="p">[</span><span class="s">'same'</span><span class="p">][</span><span class="n">step</span><span class="p">]</span> <span class="o">=</span> <span class="n">dfs</span><span class="p">[</span><span class="s">'gold_vs_silver'</span><span class="p">][</span><span class="s">'GLD'</span><span class="p">][</span><span class="n">c</span><span class="p">]</span> 
    <span class="n">silver_dist</span><span class="p">[</span><span class="s">'same'</span><span class="p">][</span><span class="n">step</span><span class="p">]</span> <span class="o">=</span> <span class="n">dfs</span><span class="p">[</span><span class="s">'gold_vs_silver'</span><span class="p">][</span><span class="s">'SLV'</span><span class="p">][</span><span class="n">c</span><span class="p">]</span>

    <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">a</span> <span class="o">!=</span> <span class="n">b</span>
    <span class="n">gold_dist</span><span class="p">[</span><span class="s">'opposite'</span><span class="p">][</span><span class="n">step</span><span class="p">]</span> <span class="o">=</span> <span class="n">dfs</span><span class="p">[</span><span class="s">'gold_vs_silver'</span><span class="p">][</span><span class="s">'GLD'</span><span class="p">][</span><span class="n">d</span><span class="p">]</span> 
    <span class="n">silver_dist</span><span class="p">[</span><span class="s">'opposite'</span><span class="p">][</span><span class="n">step</span><span class="p">]</span> <span class="o">=</span> <span class="n">dfs</span><span class="p">[</span><span class="s">'gold_vs_silver'</span><span class="p">][</span><span class="s">'SLV'</span><span class="p">][</span><span class="n">d</span><span class="p">]</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="n">same</span><span class="p">[</span><span class="n">step</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span>
    <span class="n">opp</span><span class="p">[</span><span class="n">step</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span>
    
    <span class="n">plot_correlations</span><span class="p">(</span><span class="n">correlation_dict_windows</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
	
	
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="c1"># width = 0.35       # the width of the bars: can also be len(x) sequence
</span>
<span class="n">width</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">same_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">same</span><span class="p">[</span><span class="n">step</span><span class="p">]</span> <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">steps</span><span class="p">]</span>
<span class="n">opp_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">opp</span><span class="p">[</span><span class="n">step</span><span class="p">]</span> <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">steps</span><span class="p">]</span>

<span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">steps</span><span class="p">,</span> <span class="n">same_data</span> <span class="p">,</span> <span class="n">width</span><span class="p">,</span>  <span class="n">label</span><span class="o">=</span><span class="s">'same'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'r'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">steps</span><span class="p">,</span> <span class="n">opp_data</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="n">same_data</span><span class="p">,</span>
       <span class="n">label</span><span class="o">=</span><span class="s">'opposite'</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">'percentage of the proportion of the sign of their returns to be same or opposite'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">'step'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mf">0.75</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="n">n_bins</span> <span class="o">=</span> <span class="mi">50</span>


<span class="k">for</span> <span class="n">situation</span> <span class="ow">in</span> <span class="p">[</span><span class="s">'same'</span><span class="p">,</span> <span class="s">'opposite'</span><span class="p">]:</span>
    
    <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">steps</span><span class="p">:</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">silver_dist</span><span class="p">[</span><span class="n">situation</span><span class="p">][</span><span class="n">step</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">n_bins</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">'silver'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'b'</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">silver_dist</span><span class="p">[</span><span class="n">situation</span><span class="p">][</span><span class="n">step</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s">'b'</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">gold_dist</span><span class="p">[</span><span class="n">situation</span><span class="p">][</span><span class="n">step</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">n_bins</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">'gold'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'g'</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">gold_dist</span><span class="p">[</span><span class="n">situation</span><span class="p">][</span><span class="n">step</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s">'g'</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">situation</span> <span class="o">+</span> <span class="s">'_'</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">step</span><span class="p">))</span>
<span class="c1">#         plt.xlim([-1,2])
</span>        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">price_dict</span><span class="p">[</span><span class="s">'GLD'</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">'gold'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'g'</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">'gold share price'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'g'</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s">'y'</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="s">'g'</span><span class="p">)</span>

<span class="n">ax2</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">price_dict</span><span class="p">[</span><span class="s">'SLV'</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">'silver'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'b'</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">'silver share price'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'b'</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s">'y'</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="s">'b'</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div> </div> <div id="disqus_thread"></div> </article> <script> var disqus_config = function () { this.page.url = "/finance/2020/04/25/gold_silver/"; /* Replace PAGE_URL with your page's canonical URL variable */ this.page.identifier = "/finance/2020/04/25/gold_silver"; /* Replace PAGE_IDENTIFIER with your page's unique identifier variable */ }; (function () { /* DON'T EDIT BELOW THIS LINE */ var d = document, s = d.createElement('script'); s.src = 'https://.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a> </noscript></div> </div> <!-- End of row--> <div class="row"> <div class="col-md-4"> <div class="card"> <div class="card-header"> About </div> <div class="card-body"> <!-- Your Bio --> <p class="author_bio"> Hello, My name is Wilson Fok. I love to extract useful insights and knowledge from big data. Constructive feedback and insightful comments are very welcome!</p> </div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-header">Categories </div> <div class="card-body text-dark"> <div id="#Finance"></div> <li class="tag-head"> <a href="/blog/categories/Finance">Finance</a> </li> <a name="Finance"></a> <div id="#NLP"></div> <li class="tag-head"> <a href="/blog/categories/NLP">NLP</a> </li> <a name="NLP"></a> <div id="#Deep_Learning"></div> <li class="tag-head"> <a href="/blog/categories/Deep_Learning">Deep_Learning</a> </li> <a name="Deep_Learning"></a> <div id="#Others"></div> <li class="tag-head"> <a href="/blog/categories/Others">Others</a> </li> <a name="Others"></a> </div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-header">Useful Links </div> <div class="card-body text-dark"> <li > <a href="/about">About Me</a> </li> <li > <a href="/blog">Blog</a> </li> <li > <a href="/blog/categories">Categories</a> </li> <li > <a href="/contact">Contact Me</a> </li> </div> </div> </div> </div> </div> <footer> <p> Powered by Jekyll. Hosted on <a href="https://pages.github.com">Github</a>. Subscribe via <a href=" /feed.xml ">RSS <i class="fa fa-rss" aria-hidden="true"></i> </a> </p> </footer> </div> <script> var options = { classname: 'my-class', id: 'my-id' }; var nanobar = new Nanobar( options ); nanobar.go( 30 ); nanobar.go( 76 ); nanobar.go(100); </script> <!-- <div hidden id="snipcart" data-api-key="Y2I1NTAyNWYtMTNkMy00ODg0LWE4NDItNTZhYzUxNzJkZTI5NjM3MDI4NTUzNzYyMjQ4NzU0"></div> <script src="https://cdn.snipcart.com/themes/v3.0.0-beta.3/default/snipcart.js" defer></script> --> <script src="/assets/js/mode-switcher.js"></script> </body> </html>
