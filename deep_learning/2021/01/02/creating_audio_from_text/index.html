<!DOCTYPE html> <html lang=" en "><head> <meta charset="utf-8"> <title>Wilson Fok - A data science enthusiast</title> <meta http-equip="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <meta name="description" content="Create an audio clip for your favorite quotes using AI" /> <meta name="keywords" content="Create an audio clip for your favorite quotes using AI, Wilson Fok, Deep_Learning" /> <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml"> <meta content="" property="fb:app_id"> <meta content="Wilson Fok" property="og:site_name"> <meta content="Create an audio clip for your favorite quotes using AI" property="og:title"> <meta content="article" property="og:type"> <meta content="Create an audio clip for your favorite quotes using AI (updated)" property="og:description"> <meta content="/deep_learning/2021/01/02/creating_audio_from_text/" property="og:url"> <meta content="2021-01-02T00:00:00+08:00" property="article:published_time"> <meta content="/about/" property="article:author"> <meta content="Deep_Learning" property="article:section"> <meta name="twitter:card" content="summary"> <meta name="twitter:site" content="@"> <meta name="twitter:creator" content="@"> <meta name="twitter:title" content="Create an audio clip for your favorite quotes using AI"> <meta content="Wilson Fok" property="og:site_name"> <meta name="twitter:url" content="/deep_learning/2021/01/02/creating_audio_from_text/"> <meta name="twitter:description" content="Hello, My name is Wilson Fok. I love to extract useful insights and knowledge from big data. I also like to make new friends and connections. Let's connect! "> <!-- load layout style css --> <link rel="stylesheet" href="/assets/css/main.css" /> <link rel="stylesheet" href="/assets/css/custom-style.css" /> <link rel="stylesheet" href="/assets/bower_components/lightgallery/dist/css/lightgallery.min.css"/> <link rel="stylesheet" href="/assets/bower_components/bootstrap/dist/css/bootstrap.min.css" /> <link rel="stylesheet" href="/assets/bower_components/font-awesome/web-fonts-with-css/css/fontawesome-all.min.css" /> <!-- Favicon --> <link rel="icon" href="/assets/img/favicon.ico" type="image/gif" sizes="16x16"> <!-- Jquery --> <!-- one or more of the below scripts does fancy word animation and dropdown menu --> <script src="/assets/extra_js/jquery-3.4.1.min.js"></script> <script src="/assets/extra_js/picturefill min/picturefill.min.js"></script> <script src="/assets/extra_js/instantsearch min/instantsearch.min.js"></script> <script src="/assets/extra_js/moment min/moment.min.js"></script> <script src="/assets/bower_components/jquery.easing/jquery.easing.min.js"></script> <script src="/assets/bower_components/bootstrap/dist/js/bootstrap.bundle.min.js"></script> <script src="/assets/bower_components/jquery-mousewheel/jquery.mousewheel.min.js"></script> <script src="/assets/bower_components/lightgallery/dist/js/lightgallery-all.min.js"></script> <script src="/assets/bower_components/imagesloaded/imagesloaded.pkgd.min.js"></script> <script src="/assets/bower_components/nanobar/nanobar.min.js"></script> <script src="/assets/bower_components/typewrite/dist/typewrite.min.js"></script> </head><body> <div class="container-fluid"><header> <div class="col-lg-12"> <div class="row"> <nav class="navbar navbar-expand-lg fixed-top navbar-dark " id="topNav"> <!-- <a class="navbar-brand" href="#">Wilson Fok</a> --> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="/">Wilson Fok</a> <div class="collapse navbar-collapse" id="navbarNav"> <ul class="navbar-nav"> <li class="nav-item"> <a class="nav-link" href="/about">About Me</a> </li> <li class="nav-item"> <a class="nav-link" href="/blog">Blog</a> </li> <li class="nav-item"> <a class="nav-link" href="/blog/categories">Categories</a> </li> <li class="nav-item"> <a class="nav-link" href="/contact">Contact Me</a> </li> </ul> </div> <ul class="nav justify-content-end"> <!-- <li class="nav-item"> <a class="nav-link" id="search-icon" href="/search/"><i class="fa fa-search" aria-hidden="true"></i></a> </li> --> <li class="nav-item"> <input class="nav-link switch" id="theme-toggle" onclick="modeSwitcher() "type="checkbox" name="checkbox" > </li> </ul> </nav> </div> </div> </header><div class="col-lg-12"> <!-- Blog Post Breadcrumbs --><div class="col-lg-12"> <nav aria-label="breadcrumb" role="navigation"> <ol class="breadcrumb"> <li class="breadcrumb-item"> <a href="/blog"><i class="fa fa-home" aria-hidden="true"></i></a> </li> <li class="breadcrumb-item active" aria-current="page"><a href="/deep_learning/2021/01/02/creating_audio_from_text/">Create an audio clip for your favorite quotes using AI</a></li> </ol> </nav> </div><div class="row" id="blog-post-container"> <div class="col-lg-8 offset-md-2"><article class="card" itemscope itemtype="http://schema.org/BlogPosting"> <div class="card-header"> <h1 class="post-title" itemprop="name headline">Create an audio clip for your favorite quotes using AI</h1> <p></p> <h6 class="post-meta"> <i> Summary : Create an audio clip for your favorite quotes using AI (updated)</i> </h6> <p class="post-summary">Posted by : <img src="/assets/img/profile.png" class="author-profile-img"> <span itemprop="author" itemscope itemtype="http://schema.org/Person"> <span itemprop="name">Wilson Fok</span> </span> on <time datetime="2021-01-02 00:00:00 +0800" itemprop="datePublished">Jan 2, 2021</time> </p> <span class="disqus-comment-count" data-disqus-identifier="/deep_learning/2021/01/02/creating_audio_from_text/"></span> <div class="post-categories"> Category : <a href="/blog/categories/Deep_Learning">Deep_Learning</a> </div> </div> <div class="card-body" itemprop="articleBody"> <h2 id="introduction">Introduction</h2> <p>Over the years, I have collected many quotes and idioms from famous businessmen / businesswomen, politicians, artists, actors / actresses and people from the past. As much as I would like to learn them by heart and put them into practice. From time to time, I forgot the sayings and would like to be reminded.</p> <ul> <li>Have you ever been become too lazy to read your favorite quotes on paper?</li> <li>Have you ever forgotten your favorite quotes?</li> <li>Have you ever mixed up one quote with another?</li> <li>Have you ever thought that it would be nice to have someone read it out loud to you?</li> </ul> <p>Without having “someone”, I have come up with a low-cost solution: using a text-to-speech model to convert the quotes into audio files.</p> <p>On the one hand, from my personal experience, Tacotron 2 and WaveGlow are powerful AI text-to-speech models. However, they fall short in reading out loud long paragraphs, pages of books, etc. There is nothing wrong with what the models speak. I feel that the speech is less coherent as it lacks the rhythm that echoes the underlying idea or the thread of the lengthy piece of writing. Without true comprehension of the author’s intention, it is rather hard to produce a fluent speech that adequately express the intended meaning.</p> <p>On the other hand, quotes are special. They are short, succinct and to-the-point. These attributes make them suitable for AI text-to-speech model to read out loud.</p> <p>This task deploys two models in series. The first model (Tacotron 2), which converts the English text to a Mel Spectrogram sentence by sentence. The second model (WaveGlow), which converts the Mel Spectrogram to audio sound wave we can hear. To ensure quality, we also pass the audio through a denoiser.</p> <h2 id="why-tacotron-2-and-waveglow-">Why Tacotron 2 and WaveGlow ?</h2> <p>The most important reason is that these two models are well-trained and are available (model’s checkpoints) for use from Nvidia github repository. For further details on training accuracy, validation performance, detail architectures, publications and the implementation, please visit their <a href="https://github.com/NVIDIA/DeepLearningExamples/tree/master/PyTorch/SpeechSynthesis/Tacotron2"> official repository. </a></p> <h2 id="software-and-hardware-prerequisites">Software and Hardware Prerequisites</h2> <ul> <li>Nvidia GPU: GeForce 920MX</li> <li>CUDA version: 10.2</li> <li> <p>Driver version: 441.66</p> </li> <li>Python: 3.7.6</li> <li>Pytorch: 1.6.0</li> <li>Scipy: 1.4.1</li> </ul> <h2 id="methods">Methods</h2> <ol> <li> <p>Read in the quotes, which are stored in a text file in Unicode/ UTF- 8 (Python 3 standard) I put 10 quotes from Warren Buffett in this example to show how the pipeline can be made to work. <a href="/assets/texts/quotes.txt">Samples here !</a></p> </li> <li> <p>Load Tacotron 2 and WaveGlow. I keep the default setting for these two models. However, due to the GPU memory constrains, I could not fit WaveGlow model on the GPU. Thus, Tacotron 2 runs on the GPU while WaveGlow runs on the CPU. The ramification is that inference is pretty slow at the WaveGlow side.</p> </li> <li> <p>Convert every single word in the quote to word embedding (the model uses long integers to do that). Set the maximum sentence’s length. The Tacotron 2 works on consistent sentence length within a batch. We fill the shorter sentences with zero at the end (padding), so that every sentence looks equal in length for Tacotron 2. Tacotron 2 predicts the quote its Mel spectrogram.</p> </li> <li> <p>Create the Mel spectrogram to audio sound waves Note that the Mel spectrogram is now sitting on the GPU while WaveGlow is on the CPU. We transfer the data across the devices so that WaveGlow can predict the audio wave from the Mel spectrogram. Finally, we lower noise in the audio waves with the denoiser. Note the audio is an numpy array. Often we can control the loudness of the clip by lower or raising the amplitude. However, WaveGlow usually picks a good loudness level so that manual intervention is really unnecessary.</p> </li> <li> <p>Save the audio file to disk. Scipy wavfile can write the numpy array into a WAV audio file.</p> </li> </ol> <p><img src="/assets/images/text_to_speech/tacotron2_arch.png" alt="The overall work-flow taken from the official repository." width="1100px" /></p> <center> The overall work-flow taken from the <a href="https://github.com/NVIDIA/DeepLearningExamples/tree/master/PyTorch/SpeechSynthesis/Tacotron2"> official repository. </a> </center> <p></p> <h2 id="results">Results</h2> <h4 id="individual-quote-and-audio">Individual quote and audio</h4> <blockquote> <p>We simply attempt to be fearful when others are greedy and to be greedy only when others are fearful.</p> </blockquote> <audio controls=""> <source src="/assets/audio/Forbes_0000.wav" type="audio/wav" /> Your browser does not support the audio tag. </audio> <p></p> <blockquote> <p>It takes 20 years to build a reputation and five minutes to ruin it. If you think about that, you’ll do things differently.</p> </blockquote> <audio controls=""> <source src="/assets/audio/Forbes_0001.wav" type="audio/wav" /> Your browser does not support the audio tag. </audio> <p></p> <blockquote> <p>Price is what you pay. Value is what you get.</p> </blockquote> <audio controls=""> <source src="/assets/audio/Forbes_0002.wav" type="audio/wav" /> Your browser does not support the audio tag. </audio> <p></p> <blockquote> <p>Someone’s sitting in the shade today because someone planted a tree a long time ago.</p> </blockquote> <audio controls=""> <source src="/assets/audio/Forbes_0003.wav" type="audio/wav" /> Your browser does not support the audio tag. </audio> <p></p> <blockquote> <p>Rule Number 1: Never lose money. Rule Number 2: Never forget Rule Number 1.</p> </blockquote> <audio controls=""> <source src="/assets/audio/Forbes_0004.wav" type="audio/wav" /> Your browser does not support the audio tag. </audio> <p></p> <blockquote> <p>Risk comes from not knowing what you’re doing.</p> </blockquote> <audio controls=""> <source src="/assets/audio/Forbes_0005.wav" type="audio/wav" /> Your browser does not support the audio tag. </audio> <p></p> <blockquote> <p>It’s only when the tide goes out that you discover who’s been swimming naked.</p> </blockquote> <audio controls=""> <source src="/assets/audio/Forbes_0006.wav" type="audio/wav" /> Your browser does not support the audio tag. </audio> <p></p> <blockquote> <p>It’s far better to buy a wonderful company at a fair price than a fair company at a wonderful price.</p> </blockquote> <audio controls=""> <source src="/assets/audio/Forbes_0007.wav" type="audio/wav" /> Your browser does not support the audio tag. </audio> <p></p> <blockquote> <p>Our favorite holding period is forever.</p> </blockquote> <audio controls=""> <source src="/assets/audio/Forbes_0008.wav" type="audio/wav" /> Your browser does not support the audio tag. </audio> <p></p> <blockquote> <p>It’s better to hang out with people better than you. Pick out associates whose behavior is better than yours and you’ll drift in that direction.</p> </blockquote> <audio controls=""> <source src="/assets/audio/Forbes_0009.wav" type="audio/wav" /> Your browser does not support the audio tag. </audio> <p></p> <h4 id="create-an-app-that-plays-your-favorite-quotes">Create an app that plays your favorite quotes</h4> <p>Pain point: It is inconvenient to play and read each quote manually even though we have an AI read it out loud to us. To lower the effort and to improve the ease of learning, I have create an app that plays the quotes randomly and repeatedly, so that we can listen to them non-stop anywhere and anytime. Of course we can terminate the app once we have mastered the hidden gem in them and put them to work in practice.</p> <p>The goal of the app is to play the quote audio files and display the accompanied texts synchronously.<br /> The app should play the quotes in random yet sequential order indefinitely.</p> <p>To achieve the above, I use Pygame to create a “game” that loops through the quotes and their audio indefinitely in a randomly generated order. Pygame is very handy for this task as it provides a rich library of API for handling graphics, user’s inputs, sounds and more. Most importantly, it is easy to use. Of course, other GUI libraries such as Tkinter can also be used instead.</p> <p>Here is a short demo.</p> <iframe width="560" height="315" src="https://www.youtube.com/embed/Ft6uNHqMq5E" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe> <p>Enjoy and Happy learning. Please feel free to send me your favorite quotes or other suggestions.</p> <h2 id="python-scripts">Python Scripts</h2> <h4 id="generating-audio-on-quotes">Generating audio on quotes</h4> <p>Here I provided the adaptation I made to make use of Tacotron and WaveGlow. For the full information on the models, please visit their <a href="https://github.com/NVIDIA/DeepLearningExamples/tree/master/PyTorch/SpeechSynthesis/Tacotron2"> official repository. </a></p> <p>Set up Tacotron and WaveGlow</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">tacotron2.text</span> <span class="kn">import</span> <span class="n">text_to_sequence</span>
<span class="kn">import</span> <span class="nn">models</span><span class="p">,</span> <span class="n">os</span>
<span class="kn">import</span> <span class="nn">torch</span><span class="p">,</span> <span class="n">logging</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">from</span> <span class="nn">scipy.io.wavfile</span> <span class="kn">import</span> <span class="n">write</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">waveglow.denoiser</span> <span class="kn">import</span> <span class="n">Denoiser</span>
<span class="kn">from</span> <span class="nn">inference</span> <span class="kn">import</span> <span class="n">checkpoint_from_distributed</span><span class="p">,</span> <span class="n">unwrap_distributed</span><span class="p">,</span>\
    <span class="n">handle_input_text</span><span class="p">,</span> <span class="n">prepare_input_sequence</span><span class="p">,</span> <span class="n">MeasureTime</span>

<span class="k">def</span> <span class="nf">get_tacotron_config</span><span class="p">():</span>
    
    <span class="n">model_name</span> <span class="o">=</span> <span class="s">'Tacotron2'</span>
    <span class="n">model_config</span> <span class="o">=</span> <span class="p">{</span><span class="s">'mask_padding'</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span> <span class="s">'n_mel_channels'</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span> <span class="s">'n_symbols'</span><span class="p">:</span> <span class="mi">148</span><span class="p">,</span>
                    <span class="s">'symbols_embedding_dim'</span><span class="p">:</span> <span class="mi">512</span><span class="p">,</span> <span class="s">'encoder_kernel_size'</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> 
                    <span class="s">'encoder_n_convolutions'</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s">'encoder_embedding_dim'</span><span class="p">:</span> <span class="mi">512</span><span class="p">,</span> 
                    <span class="s">'attention_rnn_dim'</span><span class="p">:</span> <span class="mi">1024</span><span class="p">,</span> <span class="s">'attention_dim'</span><span class="p">:</span> <span class="mi">128</span><span class="p">,</span>
                    <span class="s">'attention_location_n_filters'</span><span class="p">:</span> <span class="mi">32</span><span class="p">,</span> 
                    <span class="s">'attention_location_kernel_size'</span><span class="p">:</span> <span class="mi">31</span><span class="p">,</span>
                    <span class="s">'n_frames_per_step'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> 
                    <span class="s">'decoder_rnn_dim'</span><span class="p">:</span> <span class="mi">1024</span><span class="p">,</span> <span class="s">'prenet_dim'</span><span class="p">:</span> <span class="mi">256</span><span class="p">,</span> 
                    <span class="s">'max_decoder_steps'</span><span class="p">:</span> <span class="mi">2000</span><span class="p">,</span> <span class="s">'gate_threshold'</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
                    <span class="s">'p_attention_dropout'</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s">'p_decoder_dropout'</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
                    <span class="s">'postnet_embedding_dim'</span><span class="p">:</span> <span class="mi">512</span><span class="p">,</span> <span class="s">'postnet_kernel_size'</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
                    <span class="s">'postnet_n_convolutions'</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s">'decoder_no_early_stopping'</span><span class="p">:</span> <span class="bp">False</span><span class="p">}</span>
    
    
    <span class="n">cpu_run</span><span class="p">,</span> <span class="n">forward_is_infer</span> <span class="o">=</span>  <span class="bp">False</span><span class="p">,</span> <span class="bp">True</span>
    <span class="n">checkpoint</span> <span class="o">=</span> <span class="s">'checkpoints/tacotron2_1032590_6000_amp'</span>
    
    <span class="k">return</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">model_config</span><span class="p">,</span> <span class="n">cpu_run</span><span class="p">,</span> <span class="n">forward_is_infer</span><span class="p">,</span> <span class="n">checkpoint</span> 

<span class="k">def</span> <span class="nf">get_waveGlow_config</span><span class="p">():</span>

    <span class="n">model_name</span> <span class="o">=</span> <span class="s">'WaveGlow'</span>
    <span class="n">model_config</span> <span class="o">=</span> <span class="p">{</span><span class="s">'n_mel_channels'</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span> <span class="s">'n_flows'</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span> <span class="s">'n_group'</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
                    <span class="s">'n_early_every'</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s">'n_early_size'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                    <span class="s">'WN_config'</span><span class="p">:</span> <span class="p">{</span><span class="s">'n_layers'</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s">'kernel_size'</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s">'n_channels'</span><span class="p">:</span> <span class="mi">256</span><span class="p">}}</span>
    <span class="n">checkpoint</span> <span class="o">=</span> <span class="s">'checkpoints/waveglow_1076430_14000_amp'</span>
    <span class="n">cpu_run</span><span class="p">,</span> <span class="n">forward_is_infer</span> <span class="o">=</span>  <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span>
    <span class="k">return</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">model_config</span><span class="p">,</span> <span class="n">cpu_run</span><span class="p">,</span> <span class="n">forward_is_infer</span><span class="p">,</span> <span class="n">checkpoint</span> 

<span class="k">def</span> <span class="nf">load_and_setup_model</span><span class="p">(</span><span class="n">model_name</span><span class="p">,</span> <span class="n">model_config</span><span class="p">,</span> <span class="n">cpu_run</span><span class="p">,</span> <span class="n">forward_is_infer</span><span class="p">,</span> <span class="n">checkpoint</span><span class="p">,</span> <span class="n">fp16_run</span><span class="p">):</span>
    
    <span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">model_name</span><span class="p">,</span> <span class="n">model_config</span><span class="p">,</span> <span class="n">cpu_run</span><span class="o">=</span><span class="n">cpu_run</span><span class="p">,</span>
                             <span class="n">forward_is_infer</span><span class="o">=</span><span class="n">forward_is_infer</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">checkpoint</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">cpu_run</span><span class="p">:</span>
            <span class="n">state_dict</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">checkpoint</span><span class="p">,</span> <span class="n">map_location</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s">'cpu'</span><span class="p">))[</span><span class="s">'state_dict'</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">state_dict</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">checkpoint</span><span class="p">)[</span><span class="s">'state_dict'</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">checkpoint_from_distributed</span><span class="p">(</span><span class="n">state_dict</span><span class="p">):</span>
            <span class="n">state_dict</span> <span class="o">=</span> <span class="n">unwrap_distributed</span><span class="p">(</span><span class="n">state_dict</span><span class="p">)</span>

        <span class="n">model</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">state_dict</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">model_name</span> <span class="o">==</span> <span class="s">"WaveGlow"</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">remove_weightnorm</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

    <span class="n">model</span><span class="o">.</span><span class="nb">eval</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">fp16_run</span><span class="p">:</span>
        <span class="n">model</span><span class="o">.</span><span class="n">half</span><span class="p">()</span>
        
    <span class="k">print</span> <span class="p">(</span><span class="n">model_name</span> <span class="p">,</span> <span class="s">' loaded'</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">model</span>

<span class="k">class</span> <span class="nc">Speaker</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">denoising_strength</span><span class="o">=</span><span class="mf">0.01</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">sigma_infer</span><span class="o">=</span><span class="mf">0.9</span>
        
        
        <span class="n">model_name</span><span class="p">,</span> <span class="n">model_config</span><span class="p">,</span> <span class="n">cpu_run</span><span class="p">,</span> <span class="n">forward_is_infer</span><span class="p">,</span> <span class="n">checkpoint</span> <span class="o">=</span> <span class="n">get_tacotron_config</span><span class="p">()</span>
        <span class="n">tacotron2</span> <span class="o">=</span> <span class="n">load_and_setup_model</span><span class="p">(</span><span class="n">model_name</span><span class="p">,</span> <span class="n">model_config</span><span class="p">,</span> <span class="n">cpu_run</span><span class="p">,</span> <span class="n">forward_is_infer</span><span class="p">,</span> <span class="n">checkpoint</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        
        <span class="n">model_name</span><span class="p">,</span> <span class="n">model_config</span><span class="p">,</span> <span class="n">cpu_run</span><span class="p">,</span> <span class="n">forward_is_infer</span><span class="p">,</span> <span class="n">checkpoint</span> <span class="o">=</span> <span class="n">get_waveGlow_config</span><span class="p">()</span>
        <span class="n">waveglow</span> <span class="o">=</span> <span class="n">load_and_setup_model</span><span class="p">(</span><span class="n">model_name</span><span class="p">,</span> <span class="n">model_config</span><span class="p">,</span> <span class="n">cpu_run</span><span class="p">,</span> <span class="n">forward_is_infer</span><span class="p">,</span> <span class="n">checkpoint</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        
        <span class="n">denoiser</span> <span class="o">=</span> <span class="n">Denoiser</span><span class="p">(</span><span class="n">waveglow</span><span class="p">)</span>
        <span class="c1"># if not args.cpu:
</span>        <span class="c1">#     denoiser.cuda()
</span>    
        <span class="n">jitted_tacotron2</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span><span class="p">(</span><span class="n">tacotron2</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">denoiser</span> <span class="o">=</span> <span class="n">denoiser</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tacotron</span> <span class="o">=</span> <span class="n">jitted_tacotron2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">waveglow</span> <span class="o">=</span> <span class="n">waveglow</span>
        
        
    <span class="k">def</span> <span class="nf">get_audio</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sequences_padded</span><span class="p">,</span> <span class="n">input_lengths</span><span class="p">,</span> <span class="n">logger</span><span class="p">):</span>
        
        <span class="n">measurements</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">(),</span> <span class="n">MeasureTime</span><span class="p">(</span><span class="n">measurements</span><span class="p">,</span> <span class="s">"tacotron2_time"</span><span class="p">,</span> <span class="n">cpu_run</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
            <span class="n">mel</span><span class="p">,</span> <span class="n">mel_lengths</span><span class="p">,</span> <span class="n">alignments</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tacotron</span><span class="p">(</span><span class="n">sequences_padded</span><span class="p">,</span> <span class="n">input_lengths</span><span class="p">)</span>
            
        <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">(),</span> <span class="n">MeasureTime</span><span class="p">(</span><span class="n">measurements</span><span class="p">,</span> <span class="s">"waveglow_time"</span><span class="p">,</span> <span class="n">cpu_run</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
            <span class="n">audios</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">waveglow</span><span class="p">(</span><span class="n">mel</span><span class="o">.</span><span class="n">cpu</span><span class="p">(),</span> <span class="n">sigma</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sigma_infer</span><span class="p">)</span>
            <span class="n">audios</span> <span class="o">=</span> <span class="n">audios</span><span class="o">.</span><span class="nb">float</span><span class="p">()</span>
        <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">(),</span> <span class="n">MeasureTime</span><span class="p">(</span><span class="n">measurements</span><span class="p">,</span> <span class="s">"denoiser_time"</span><span class="p">,</span> <span class="n">cpu_run</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
            <span class="n">audios</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">denoiser</span><span class="p">(</span><span class="n">audios</span><span class="p">,</span> <span class="n">strength</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">denoising_strength</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">"Stopping after "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">mel</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span><span class="s">" decoder steps"</span><span class="p">)</span>
    
        <span class="n">tacotron2_infer_perf</span> <span class="o">=</span> <span class="n">mel</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">mel</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">measurements</span><span class="p">[</span><span class="s">'tacotron2_time'</span><span class="p">]</span>   
        <span class="n">waveglow_infer_perf</span> <span class="o">=</span> <span class="n">audios</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">audios</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">measurements</span><span class="p">[</span><span class="s">'waveglow_time'</span><span class="p">]</span>
        
        
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">'tacotron2_infer_perf {}'</span><span class="o">.</span><span class="nb">format</span><span class="p">(</span><span class="n">tacotron2_infer_perf</span><span class="p">))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">'measurements {}'</span><span class="o">.</span><span class="nb">format</span><span class="p">(</span><span class="n">measurements</span><span class="p">))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">'waveglow_infer_perf {}'</span><span class="o">.</span><span class="nb">format</span><span class="p">(</span><span class="n">waveglow_infer_perf</span><span class="p">))</span>
        
        <span class="k">return</span> <span class="n">audios</span><span class="p">,</span> <span class="n">mel_lengths</span>
</code></pre></div></div> <p>Inference</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">prepare_input_sequence</span><span class="p">(</span><span class="n">texts</span><span class="p">,</span> <span class="n">cpu_run</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">texts</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>

    <span class="n">d</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">text</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">texts</span><span class="p">):</span>
        <span class="k">print</span> <span class="p">(</span><span class="s">'text '</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
        <span class="n">d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">IntTensor</span><span class="p">(</span>
            <span class="n">text_to_sequence</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="p">[</span><span class="s">'english_cleaners'</span><span class="p">])[:]))</span>

    <span class="n">text_padded</span><span class="p">,</span> <span class="n">input_lengths</span> <span class="o">=</span> <span class="n">pad_sequences</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">cpu_run</span><span class="p">:</span>
        <span class="n">text_padded</span> <span class="o">=</span> <span class="n">text_padded</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span><span class="o">.</span><span class="nb">long</span><span class="p">()</span>
        <span class="n">input_lengths</span> <span class="o">=</span> <span class="n">input_lengths</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span><span class="o">.</span><span class="nb">long</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">text_padded</span> <span class="o">=</span> <span class="n">text_padded</span><span class="o">.</span><span class="nb">long</span><span class="p">()</span>
        <span class="n">input_lengths</span> <span class="o">=</span> <span class="n">input_lengths</span><span class="o">.</span><span class="nb">long</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">text_padded</span><span class="p">,</span> <span class="n">input_lengths</span>

<span class="k">def</span> <span class="nf">remove_empty_lines</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span>
	
<span class="k">def</span> <span class="nf">handle_input_text</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    
    <span class="n">texts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">'r'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">'utf-8'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">texts</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Could not read file"</span><span class="p">)</span>
        <span class="k">print</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="nb">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        
    <span class="n">texts</span> <span class="o">=</span> <span class="n">remove_empty_lines</span><span class="p">(</span><span class="n">texts</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">texts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="nb">ValueError</span><span class="p">(</span><span class="s">'This text file is empty!'</span><span class="p">)</span>
        
    <span class="k">print</span> <span class="p">(</span><span class="s">'texts {}'</span><span class="o">.</span><span class="nb">format</span><span class="p">(</span><span class="n">texts</span><span class="p">))</span>
    
    <span class="k">return</span> <span class="n">texts</span>

<span class="k">def</span> <span class="nf">pad_sequences</span><span class="p">(</span><span class="n">batch</span><span class="p">):</span>
    
    <span class="n">input_lengths</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">]</span>
    <span class="n">max_input_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">input_lengths</span><span class="p">)</span>
    <span class="n">text_padded</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">LongTensor</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">batch</span><span class="p">),</span> <span class="n">max_input_len</span><span class="p">)</span>
    <span class="n">text_padded</span><span class="o">.</span><span class="n">zero_</span><span class="p">()</span>
    
    
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">text</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">batch</span><span class="p">):</span>
        <span class="n">text_padded</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="n">text</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">)]</span> <span class="o">=</span> <span class="n">text</span>
        
    <span class="k">return</span> <span class="n">text_padded</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">input_lengths</span><span class="p">)</span>
	
</code></pre></div></div> <p>Main script</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kn">from</span> <span class="nn">tacotron2.text</span> <span class="kn">import</span> <span class="n">text_to_sequence</span>
<span class="kn">import</span> <span class="nn">models</span><span class="p">,</span> <span class="n">os</span>
<span class="kn">import</span> <span class="nn">torch</span><span class="p">,</span> <span class="n">logging</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">from</span> <span class="nn">scipy.io.wavfile</span> <span class="kn">import</span> <span class="n">write</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">waveglow.denoiser</span> <span class="kn">import</span> <span class="n">Denoiser</span>
<span class="kn">from</span> <span class="nn">inference</span> <span class="kn">import</span> <span class="n">checkpoint_from_distributed</span><span class="p">,</span> <span class="n">unwrap_distributed</span><span class="p">,</span> <span class="n">handle_input_text</span><span class="p">,</span> <span class="n">prepare_input_sequence</span><span class="p">,</span> <span class="n">write</span>

<span class="kn">from</span> <span class="nn">txt_to_speech</span> <span class="kn">import</span> <span class="n">Speaker</span>



<span class="k">def</span> <span class="nf">start_logging</span><span class="p">():</span>
    
    <span class="n">log_dir</span> <span class="o">=</span> 
    <span class="n">fh</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">FileHandler</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">log_dir</span><span class="p">,</span> <span class="s">'quotes.log'</span><span class="p">),</span> <span class="s">'w'</span><span class="p">)</span>
    
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
    
    <span class="c1"># handler = logging.StreamHandler() # only for console display
</span>    <span class="n">bf</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="s">'{asctime} {name} {levelname:8s} {message}'</span><span class="p">,</span>
                        <span class="n">style</span><span class="o">=</span><span class="s">'{'</span><span class="p">)</span>
    <span class="c1"># handler.setFormatter(bf)
</span>    <span class="n">fh</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">bf</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">fh</span><span class="p">)</span>
    <span class="c1"># logger.addHandler(handler)
</span>    
    <span class="k">return</span> <span class="n">logger</span>

<span class="k">def</span> <span class="nf">pad_zero</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    
    <span class="n">target_len</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">sx</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">current_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sx</span><span class="p">)</span>
    <span class="n">padding</span> <span class="o">=</span> <span class="n">target_len</span> <span class="o">-</span> <span class="n">current_len</span> 
    <span class="k">if</span> <span class="n">padding</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">''</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">'0'</span><span class="p">]</span> <span class="o">*</span> <span class="n">padding</span><span class="p">)</span> <span class="o">+</span> <span class="n">sx</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">sx</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    

    <span class="n">logger</span> <span class="o">=</span> <span class="n">start_logging</span><span class="p">()</span>
    <span class="c1"># logger.debug('This is a DEBUG message')
</span>    <span class="n">speaker</span> <span class="o">=</span> <span class="n">Speaker</span><span class="p">()</span>

    <span class="n">input_dir</span> <span class="o">=</span> 
    <span class="n">tag</span> <span class="o">=</span> <span class="s">'quotes'</span>
    
    <span class="n">folders</span> <span class="o">=</span> <span class="p">[</span><span class="n">folder</span> <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">input_dir</span><span class="p">)</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">input_dir</span><span class="p">,</span> <span class="n">folder</span><span class="p">))</span> <span class="p">]</span>
    
    <span class="n">files</span> <span class="o">=</span> <span class="p">[(</span><span class="n">folder</span><span class="p">,</span> <span class="nb">file</span><span class="p">)</span>  <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">folders</span> <span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">input_dir</span><span class="p">,</span> <span class="n">folder</span><span class="p">))</span> <span class="k">if</span> <span class="n">tag</span> <span class="ow">in</span> <span class="nb">file</span><span class="p">]</span>
    
    
    <span class="c1"># files = [(folder, file) for folder in os.listdir(input_dir) for file in os.listdir(os.path.join(input_dir, folder)) if 'wav' in file]
</span>    <span class="c1"># for folder, file in files:
</span>    <span class="c1">#     os.remove(os.path.join(input_dir, folder, file))
</span>    
    <span class="n">total</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">'len(files) {}'</span><span class="o">.</span><span class="nb">format</span><span class="p">(</span><span class="n">total</span><span class="p">))</span>
    
    <span class="n">stft_hop_length</span><span class="o">=</span><span class="mi">256</span>
    <span class="n">sampling_rate</span><span class="o">=</span><span class="mi">22050</span>
    
    <span class="n">OVERWRITE</span> <span class="o">=</span> <span class="bp">False</span>
    
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">'OVERWRITE : {}'</span><span class="o">.</span><span class="nb">format</span><span class="p">(</span><span class="n">OVERWRITE</span><span class="p">))</span>
    
    <span class="n">page_number_code</span> <span class="o">=</span> <span class="mi">0</span>
   
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="nb">file</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>
                        
        <span class="c1"># page_number = file.split(tag)[0][::-1].split('_')[0]
</span>        <span class="c1"># page_number_code = 1000 * int(page_number)
</span>        
        <span class="n">txt_path</span> <span class="o">=</span>  <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">input_dir</span><span class="p">,</span> <span class="n">folder</span><span class="p">,</span> <span class="nb">file</span><span class="p">)</span>
        <span class="n">texts</span> <span class="o">=</span> <span class="n">handle_input_text</span><span class="p">(</span><span class="n">txt_path</span><span class="p">)</span>
        
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">'{} out of {} folder {}, file {}'</span><span class="o">.</span><span class="nb">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">total</span><span class="p">,</span> <span class="n">folder</span><span class="p">,</span> <span class="nb">file</span><span class="p">))</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">'txt_path {}'</span><span class="o">.</span><span class="nb">format</span><span class="p">(</span><span class="n">txt_path</span><span class="p">))</span>
        
        <span class="n">total_lines</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">texts</span><span class="p">)</span>    
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">text</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">texts</span><span class="p">):</span>

            <span class="n">page_number_code_zero</span> <span class="o">=</span> <span class="n">pad_zero</span><span class="p">(</span><span class="n">page_number_code</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span>
            <span class="n">output_filename</span> <span class="o">=</span> <span class="n">folder</span> <span class="o">+</span> <span class="s">'_'</span><span class="o">+</span> <span class="n">page_number_code_zero</span> <span class="o">+</span> <span class="s">'.wav'</span>
            <span class="n">output_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">input_dir</span><span class="p">,</span> <span class="n">folder</span><span class="p">,</span> <span class="n">output_filename</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output_path</span><span class="p">)</span> <span class="ow">or</span> <span class="n">OVERWRITE</span><span class="p">:</span>
    
                <span class="n">text</span> <span class="o">=</span> <span class="p">[</span><span class="n">text</span><span class="p">]</span> <span class="c1"># list format
</span>                <span class="n">sequences_padded</span><span class="p">,</span> <span class="n">input_lengths</span> <span class="o">=</span> <span class="n">prepare_input_sequence</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">cpu_run</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>            
                <span class="k">print</span> <span class="p">(</span><span class="s">'sequences_padded {}, input_lengths {}'</span><span class="o">.</span><span class="nb">format</span><span class="p">(</span><span class="n">sequences_padded</span><span class="p">,</span> <span class="n">input_lengths</span><span class="p">))</span>
                
            
                <span class="c1"># print (output_filename, page_number, file)
</span>           
                <span class="n">audios</span><span class="p">,</span> <span class="n">mel_lengths</span> <span class="o">=</span> <span class="n">speaker</span><span class="o">.</span><span class="n">get_audio</span><span class="p">(</span><span class="n">sequences_padded</span><span class="p">,</span> <span class="n">input_lengths</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
                
                <span class="c1"># audios = ['a']
</span>                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">audio</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">audios</span><span class="p">):</span>
                    
                    <span class="c1"># write(output_path, sampling_rate, np.random.rand(10*sampling_rate))
</span>        
                <span class="c1"># plt.imshow(alignments[i].float().data.cpu().numpy().T, aspect="auto", origin="lower")
</span>                <span class="c1"># figure_path = args.output+"alignment_"+str(i)+"_"+args.suffix+".png"
</span>                <span class="c1"># plt.savefig(figure_path)
</span>        
                    <span class="n">audio</span> <span class="o">=</span> <span class="n">audio</span><span class="p">[:</span><span class="n">mel_lengths</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">stft_hop_length</span><span class="p">]</span>
                    <span class="n">audio</span> <span class="o">=</span> <span class="n">audio</span><span class="o">/</span><span class="n">torch</span><span class="o">.</span><span class="nb">max</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">audio</span><span class="p">))</span>
                    <span class="n">write</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="n">sampling_rate</span><span class="p">,</span> <span class="n">audio</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
                    
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">'{} out of {} audio done'</span><span class="o">.</span><span class="nb">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">total_lines</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">'Already DONE'</span><span class="p">)</span>
				
</code></pre></div></div> <h4 id="building-and-running-the-app">Building and running the app</h4> <p>The app displays quote in the queue and quote being played in distinguishable manner.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pygame</span> <span class="p">,</span> <span class="n">time</span> 
<span class="kn">from</span> <span class="nn">app_tools</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="c1"># from math import pi 
</span>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    
    <span class="n">pygame</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>  
    <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_caption</span><span class="p">(</span><span class="s">"Play favorite quotes"</span><span class="p">)</span>  
    <span class="c1"># done variable is using as flag   
</span>    <span class="n">done</span> <span class="o">=</span> <span class="bp">False</span>  
    <span class="n">clock</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">Clock</span><span class="p">()</span>  
    
    <span class="c1">#load the fonts  
</span>    <span class="c1"># font = pygame.font.SysFont("Times new Roman", 24)  
</span>    <span class="n">font</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">font</span><span class="o">.</span><span class="n">SysFont</span><span class="p">(</span><span class="s">"Calibri"</span><span class="p">,</span> <span class="mi">24</span><span class="p">)</span>  
    <span class="c1"># Render background image in new surface  
</span>    <span class="n">img</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">'Warren-Buffett-cash-share-market-buy-GFC-profit-investors-stocks.jpg'</span><span class="p">)</span>
    
    
    <span class="n">rect</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span>
    <span class="n">size</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">get_rect</span><span class="p">()</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
    <span class="n">screen</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_mode</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>  
    <span class="n">img</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span>

    <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>  
    <span class="n">start</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">pause</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">lines</span><span class="p">,</span> <span class="n">audio_dict</span><span class="p">,</span> <span class="n">num_quotes</span> <span class="o">=</span> <span class="n">collect_inputs</span><span class="p">()</span>
    <span class="n">loop_mode</span> <span class="o">=</span> <span class="s">'forever'</span>
    <span class="n">play_mode</span> <span class="o">=</span> <span class="s">'shuffle'</span>
    <span class="n">master_index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">num_quotes</span><span class="p">))</span> <span class="c1"># holder, use for shuffle later on
</span>    
    <span class="k">if</span> <span class="n">play_mode</span> <span class="o">==</span> <span class="s">'shuffle'</span><span class="p">:</span>
        <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">master_index</span><span class="p">)</span>
    
    
    <span class="k">while</span> <span class="ow">not</span> <span class="n">done</span><span class="p">:</span>  
        <span class="c1"># clock.tick() limits the while loop to a max of 10 times per second.  
</span>        <span class="n">clock</span><span class="o">.</span><span class="n">tick</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> 

      
        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">pygame</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">():</span>  <span class="c1"># User did something  
</span>            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="nb">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">QUIT</span><span class="p">:</span>  <span class="c1"># If user clicked on close symbol   
</span>                <span class="n">done</span> <span class="o">=</span> <span class="bp">True</span>  <span class="c1"># done variable that we are complete, so we exit this loop  
</span>                
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="nb">type</span>  <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">KEYDOWN</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">K_SPACE</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">pause</span><span class="p">:</span>
                        <span class="n">pause</span> <span class="o">=</span> <span class="bp">True</span>
                        <span class="k">print</span> <span class="p">(</span><span class="s">'pause.......'</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">pause</span> <span class="o">=</span> <span class="bp">False</span>
                        <span class="k">print</span> <span class="p">(</span><span class="s">'resume.......'</span><span class="p">)</span>

                
        <span class="s">'''
        
        be very careful; don't put this inside the event loop
        
        event loop somehow awaiting for something.... very laggy
        '''</span>
                
        <span class="k">if</span> <span class="n">start</span><span class="p">:</span>

            <span class="n">sound_effect</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">Sound</span><span class="p">(</span><span class="n">audio_dict</span><span class="p">[</span><span class="n">master_index</span><span class="p">[</span><span class="n">counter</span><span class="p">]])</span>
            <span class="n">duration</span> <span class="o">=</span> <span class="n">sound_effect</span><span class="o">.</span><span class="n">get_length</span><span class="p">()</span> 
            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">sound_effect</span><span class="o">.</span><span class="n">play</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">pause</span><span class="p">:</span>
                <span class="c1"># pygame.mixer.pause()
</span>                <span class="n">sound_effect</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pygame</span><span class="o">.</span><span class="n">mixer</span><span class="o">.</span><span class="n">unpause</span><span class="p">()</span>

            <span class="n">start</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">duration</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
                
        <span class="k">if</span> <span class="n">counter</span> <span class="o">==</span> <span class="n">num_quotes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">loop_mode</span> <span class="o">!=</span> <span class="s">'forever'</span><span class="p">:</span>
                <span class="n">done</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">play_mode</span> <span class="o">==</span> <span class="s">'shuffle'</span><span class="p">:</span>
                    <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">master_index</span><span class="p">)</span>
                    <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>  
                    <span class="n">start</span> <span class="o">=</span> <span class="bp">True</span>
                
            
            
      
        <span class="c1"># All drawing code occurs after the for loop and but  
</span>        <span class="c1"># inside the main while done==False loop.  
</span>
        <span class="n">screen</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">rect</span><span class="p">)</span>
        
        <span class="n">display_quotes</span> <span class="o">=</span> <span class="n">counter</span>
        <span class="n">last_y</span> <span class="o">=</span>  <span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.05</span>
        <span class="n">margin_x</span> <span class="o">=</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span> <span class="mf">0.05</span>
        <span class="k">while</span> <span class="n">last_y</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span> <span class="mf">0.5</span> <span class="ow">and</span> <span class="n">display_quotes</span> <span class="o">&lt;</span> <span class="n">num_quotes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">display_quotes</span> <span class="o">==</span> <span class="n">counter</span><span class="p">:</span>
                <span class="n">color</span><span class="o">=</span><span class="n">pygame</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s">'white'</span><span class="p">)</span>
                <span class="n">bold</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">color</span><span class="o">=</span><span class="n">pygame</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s">'pink'</span><span class="p">)</span>
                <span class="n">bold</span> <span class="o">=</span> <span class="bp">False</span>
                
            <span class="n">font</span><span class="o">.</span><span class="n">set_bold</span><span class="p">(</span><span class="n">bold</span><span class="p">)</span>
            <span class="n">last_y</span> <span class="o">=</span> <span class="n">blit_text</span><span class="p">(</span><span class="n">screen</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">display_quotes</span><span class="p">)</span><span class="o">+</span><span class="s">' : '</span> <span class="o">+</span> <span class="n">lines</span><span class="p">[</span><span class="n">master_index</span><span class="p">[</span><span class="n">display_quotes</span><span class="p">]],</span>
                               <span class="p">(</span><span class="n">margin_x</span><span class="p">,</span><span class="n">last_y</span><span class="p">),</span> <span class="n">font</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>
            <span class="n">display_quotes</span>  <span class="o">+=</span> <span class="mi">1</span>
    

        <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">flip</span><span class="p">()</span>  
          
    <span class="c1"># Quite the execution when clicking on close  
</span>    <span class="n">pygame</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</code></pre></div></div> <p>Formating and I/O</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pygame</span> <span class="p">,</span> <span class="n">time</span> 


<span class="k">def</span> <span class="nf">blit_text</span><span class="p">(</span><span class="n">surface</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">pygame</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s">'black'</span><span class="p">)):</span>
    <span class="n">words</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">' '</span><span class="p">)</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">text</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()]</span>  <span class="c1"># 2D array where each row is a list of words.
</span>    <span class="n">space</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="s">' '</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># The width of a space.
</span>    <span class="n">max_width</span><span class="p">,</span> <span class="n">max_height</span> <span class="o">=</span> <span class="n">surface</span><span class="o">.</span><span class="n">get_size</span><span class="p">()</span>
    <span class="n">max_width</span> <span class="o">/=</span> <span class="mf">2.5</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="n">word_surface</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>
            <span class="n">word_width</span><span class="p">,</span> <span class="n">word_height</span> <span class="o">=</span> <span class="n">word_surface</span><span class="o">.</span><span class="n">get_size</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">x</span> <span class="o">+</span> <span class="n">word_width</span> <span class="o">&gt;=</span> <span class="n">max_width</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Reset the x.
</span>                <span class="n">y</span> <span class="o">+=</span> <span class="n">word_height</span>  <span class="c1"># Start on new row.
</span>            <span class="n">surface</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="n">word_surface</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
            <span class="n">x</span> <span class="o">+=</span> <span class="n">word_width</span> <span class="o">+</span> <span class="n">space</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Reset the x.
</span>        <span class="n">y</span> <span class="o">+=</span> <span class="n">word_height</span>  <span class="c1"># Start on new row.
</span>    <span class="k">return</span> <span class="n">y</span>

<span class="k">def</span> <span class="nf">collect_inputs</span><span class="p">():</span>
    
    <span class="k">with</span> <span class="nb">open</span><span class="p">(,</span> <span class="s">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    
    <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">]</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span><span class="n">line</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">)}</span>
    
    <span class="n">audio_path</span> <span class="o">=</span> 
    <span class="n">audio</span> <span class="o">=</span> <span class="p">[</span><span class="nb">file</span> <span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">audio_path</span><span class="p">)</span> <span class="k">if</span> <span class="nb">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">'.wav'</span><span class="p">)]</span>
    
    <span class="n">audio_dict</span> <span class="o">=</span> <span class="p">{</span><span class="nb">int</span><span class="p">(</span><span class="nb">file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">'_'</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">'.wav'</span><span class="p">)):</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">audio_path</span><span class="p">,</span> <span class="nb">file</span><span class="p">)</span> <span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">audio</span><span class="p">}</span>
    
    <span class="n">num_quotes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">audio_dict</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">audio_dict</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
    
    <span class="k">print</span> <span class="p">(</span><span class="s">'{} quotes and sound files loaded.'</span><span class="o">.</span><span class="nb">format</span><span class="p">(</span><span class="n">num_quotes</span><span class="p">))</span>
    
    <span class="k">return</span> <span class="n">lines</span><span class="p">,</span> <span class="n">audio_dict</span><span class="p">,</span> <span class="n">num_quotes</span>
    
</code></pre></div></div> </div> <div id="disqus_thread"></div> </article> <script> var disqus_config = function () { this.page.url = "/deep_learning/2021/01/02/creating_audio_from_text/"; /* Replace PAGE_URL with your page's canonical URL variable */ this.page.identifier = "/deep_learning/2021/01/02/creating_audio_from_text"; /* Replace PAGE_IDENTIFIER with your page's unique identifier variable */ }; (function () { /* DON'T EDIT BELOW THIS LINE */ var d = document, s = d.createElement('script'); s.src = 'https://.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a> </noscript></div> </div> <!-- End of row--> <div class="row"> <div class="col-md-4"> <div class="card"> <div class="card-header"> About </div> <div class="card-body"> <!-- Your Bio --> <p class="author_bio"> Hello, My name is Wilson Fok. I love to extract useful insights and knowledge from big data. Constructive feedback and insightful comments are very welcome!</p> </div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-header">Categories </div> <div class="card-body text-dark"> <div id="#Finance"></div> <li class="tag-head"> <a href="/blog/categories/Finance">Finance</a> </li> <a name="Finance"></a> <div id="#NLP"></div> <li class="tag-head"> <a href="/blog/categories/NLP">NLP</a> </li> <a name="NLP"></a> <div id="#Deep_Learning"></div> <li class="tag-head"> <a href="/blog/categories/Deep_Learning">Deep_Learning</a> </li> <a name="Deep_Learning"></a> <div id="#Others"></div> <li class="tag-head"> <a href="/blog/categories/Others">Others</a> </li> <a name="Others"></a> </div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-header">Useful Links </div> <div class="card-body text-dark"> <li > <a href="/about">About Me</a> </li> <li > <a href="/blog">Blog</a> </li> <li > <a href="/blog/categories">Categories</a> </li> <li > <a href="/contact">Contact Me</a> </li> </div> </div> </div> </div> </div> <footer> <p> Powered by Jekyll. Hosted on <a href="https://pages.github.com">Github</a>. Subscribe via <a href=" /feed.xml ">RSS <i class="fa fa-rss" aria-hidden="true"></i> </a> </p> </footer> </div> <script> var options = { classname: 'my-class', id: 'my-id' }; var nanobar = new Nanobar( options ); nanobar.go( 30 ); nanobar.go( 76 ); nanobar.go(100); </script> <!-- <div hidden id="snipcart" data-api-key="Y2I1NTAyNWYtMTNkMy00ODg0LWE4NDItNTZhYzUxNzJkZTI5NjM3MDI4NTUzNzYyMjQ4NzU0"></div> <script src="https://cdn.snipcart.com/themes/v3.0.0-beta.3/default/snipcart.js" defer></script> --> <script src="/assets/js/mode-switcher.js"></script> </body> </html>
