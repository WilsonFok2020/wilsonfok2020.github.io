<!DOCTYPE html> <html lang=" en "><head> <meta charset="utf-8"> <title>Wilson Fok - A data science enthusiast</title> <meta http-equip="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <meta name="description" content="Streaming Scipy optimization steps" /> <meta name="keywords" content="Streaming Scipy optimization steps, Wilson Fok, Deep_Learning" /> <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml"> <meta content="" property="fb:app_id"> <meta content="Wilson Fok" property="og:site_name"> <meta content="Streaming Scipy optimization steps" property="og:title"> <meta content="article" property="og:type"> <meta content="A web application that configures, solves, and displays the minimization of Rosenbrock function by Differential Evolution algorithm or L-BFGS algorithm." property="og:description"> <meta content="/deep_learning/2023/01/27/StreamScipyOptimization/" property="og:url"> <meta content="2023-01-27T00:00:00+08:00" property="article:published_time"> <meta content="/about/" property="article:author"> <meta content="Deep_Learning" property="article:section"> <meta name="twitter:card" content="summary"> <meta name="twitter:site" content="@"> <meta name="twitter:creator" content="@"> <meta name="twitter:title" content="Streaming Scipy optimization steps"> <meta content="Wilson Fok" property="og:site_name"> <meta name="twitter:url" content="/deep_learning/2023/01/27/StreamScipyOptimization/"> <meta name="twitter:description" content="Hello, My name is Wilson Fok. I love to extract useful insights and knowledge from big data. I also like to make new friends and connections. Let's connect! "> <!-- load layout style css --> <link rel="stylesheet" href="/assets/css/main.css" /> <link rel="stylesheet" href="/assets/css/custom-style.css" /> <link rel="stylesheet" href="/assets/bower_components/lightgallery/dist/css/lightgallery.min.css"/> <link rel="stylesheet" href="/assets/bower_components/bootstrap/dist/css/bootstrap.min.css" /> <link rel="stylesheet" href="/assets/bower_components/font-awesome/web-fonts-with-css/css/fontawesome-all.min.css" /> <!-- Favicon --> <link rel="icon" href="/assets/img/favicon.ico" type="image/gif" sizes="16x16"> <!-- Jquery --> <!-- one or more of the below scripts does fancy word animation and dropdown menu --> <script src="/assets/extra_js/jquery-3.4.1.min.js"></script> <script src="/assets/extra_js/picturefill min/picturefill.min.js"></script> <script src="/assets/extra_js/instantsearch min/instantsearch.min.js"></script> <script src="/assets/extra_js/moment min/moment.min.js"></script> <script src="/assets/bower_components/jquery.easing/jquery.easing.min.js"></script> <script src="/assets/bower_components/bootstrap/dist/js/bootstrap.bundle.min.js"></script> <script src="/assets/bower_components/jquery-mousewheel/jquery.mousewheel.min.js"></script> <script src="/assets/bower_components/lightgallery/dist/js/lightgallery-all.min.js"></script> <script src="/assets/bower_components/imagesloaded/imagesloaded.pkgd.min.js"></script> <script src="/assets/bower_components/nanobar/nanobar.min.js"></script> <script src="/assets/bower_components/typewrite/dist/typewrite.min.js"></script> </head><body> <div class="container-fluid"><header> <script src="https://cdn.knightlab.com/libs/juxtapose/latest/js/juxtapose.min.js"></script> <link rel="stylesheet" href="https://cdn.knightlab.com/libs/juxtapose/latest/css/juxtapose.css"> <div class="col-lg-12"> <div class="row"> <nav class="navbar navbar-expand-lg fixed-top navbar-dark " id="topNav"> <!-- <a class="navbar-brand" href="#">Wilson Fok</a> --> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="/">Wilson Fok</a> <div class="collapse navbar-collapse" id="navbarNav"> <ul class="navbar-nav"> <li class="nav-item"> <a class="nav-link" href="/about">About Me</a> </li> <li class="nav-item"> <a class="nav-link" href="/blog">Blog</a> </li> <li class="nav-item"> <a class="nav-link" href="/blog/categories">Categories</a> </li> <li class="nav-item"> <a class="nav-link" href="/contact">Contact Me</a> </li> </ul> </div> <ul class="nav justify-content-end"> <!-- <li class="nav-item"> <a class="nav-link" id="search-icon" href="/search/"><i class="fa fa-search" aria-hidden="true"></i></a> </li> --> <li class="nav-item"> <input class="nav-link switch" id="theme-toggle" onclick="modeSwitcher() "type="checkbox" name="checkbox" > </li> </ul> </nav> </div> </div> </header><div class="col-lg-12"> <!-- Blog Post Breadcrumbs --><div class="col-lg-12"> <nav aria-label="breadcrumb" role="navigation"> <ol class="breadcrumb"> <li class="breadcrumb-item"> <a href="/blog"><i class="fa fa-home" aria-hidden="true"></i></a> </li> <li class="breadcrumb-item active" aria-current="page"><a href="/deep_learning/2023/01/27/StreamScipyOptimization/">Streaming Scipy optimization steps</a></li> </ol> </nav> </div><div class="row" id="blog-post-container"> <div class="col-lg-8 offset-md-2"><article class="card" itemscope itemtype="http://schema.org/BlogPosting"> <div class="card-header"> <h1 class="post-title" itemprop="name headline">Streaming Scipy optimization steps</h1> <p></p> <h6 class="post-meta"> <i> Summary : A web application that configures, solves, and displays the minimization of Rosenbrock function by Differential Evolution algorithm or L-BFGS algorithm.</i> </h6> <p class="post-summary">Posted by : <img src="/assets/img/profile.png" class="author-profile-img"> <span itemprop="author" itemscope itemtype="http://schema.org/Person"> <span itemprop="name">Wilson Fok</span> </span> on <time datetime="2023-01-27 00:00:00 +0800" itemprop="datePublished">Jan 27, 2023</time> </p> <span class="disqus-comment-count" data-disqus-identifier="/deep_learning/2023/01/27/StreamScipyOptimization/"></span> <div class="post-categories"> Category : <a href="/blog/categories/Deep_Learning">Deep_Learning</a> </div> </div> <div class="card-body" itemprop="articleBody"> <h2 id="introduction">Introduction</h2> <p>This three-part series aims to teach readers how to create a web application that configures, solves, and displays the minimization of <a href="https://en.wikipedia.org/wiki/Rosenbrock_function">Rosenbrock function</a> by Differential Evolution algorithm and L-BFGS algorithm. Such application is very useful for anyone who wishes to monitor the step-by-step progress of the minimization. A gradual fall in the energy or function value is a good sign and the opposite is a bad sign. Early signs help to suggest how appropriate the initial guesses or bounds might be. For instance, overly tight bounds or far off guesses usually makes the optimizer oscillate or stagnate at sub-optimal solutions. This is especially paramount for image registration because its objective function (numerical similarity metric) may only correlate partially to how human discern visual similarity.</p> <p>In Part I, I describe how to modify the existing Scipy functions (namely Differential Evolution algorithm and L-BFGS algorithm) so that we can obtain the step-by-step or intermediate solutions. I also explain why the built-in callback option is not viable for us when the code runs on the server.</p> <p>In Part II, I describe how to create a web page that represents our graphical user interface that interacts with the server in Part III. While differential evolution algorithm requires no gradient approximation, L-BFGS estimates first order function derivatives (which are then linearly combined to approximate its second order derivatives). The web page layout must therefore adapt to the outputs of the algorithms, and its content must be updated dynamically via streaming. To achieve this, I describe how I make use of Template.</p> <p>In Part III, I describe how to use Flask (micro-framework) to make a very basic server that parses userâ€™s request, calls the correct Scipy routines to minimize Rosenbrock function, and renders a complete set of solutions in HTML.</p> <h2 id="prerequisites">Prerequisites</h2> <ul> <li>Python 3.10</li> <li>Flask 2.2.2</li> <li>Scipy 1.9.3</li> <li>Numpy 1.23.5</li> <li>Windows 10</li> </ul> <h2 id="part-i---scipy-optimization-functions">Part I - Scipy Optimization Functions</h2> <p>We can conveniently locate many commonly used optimization algorithms (wrapped in Python) in Scipy library. Amongst them, I have modified <a href="https://en.wikipedia.org/wiki/Differential_evolution"><strong>differential evolution algorithm</strong></a> and <a href="https://en.wikipedia.org/wiki/Broyden%E2%80%93Fletcher%E2%80%93Goldfarb%E2%80%93Shanno_algorithm"><strong>L-BFGS algorithm</strong></a>. Since differential evolution algorithm does not require the estimation of objective function gradients, we can try it out on problems that do not offer a quick calculation of gradients. However, the gradient often indicates the direction in which a better solution may reside. L-BFGS takes the gradient into account when updating the current estimate of a solution.</p> <p>I let <a href="https://en.wikipedia.org/wiki/Rosenbrock_function">Rosenbrock function</a>, which is commonly featured in toy examples, be the objective function. Coefficient a and coefficient b determine the shape of the valley of the function.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">rosenbrock_func</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
    <span class="s">"""
    x is a 1-D vector (N,)
    """</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mf">2.0</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mf">2.0</span><span class="p">)</span><span class="o">**</span><span class="mf">2.0</span><span class="p">)</span>
</code></pre></div></div> <p>The differential evolution solver in Scipy package is the full implementation of the differential evolution algorithm. What I need to modify is to make it suitable for streaming on the server. So I create a class called ModifiedEvolution that inherits DifferentialEvolutionSolver.</p> <p>On a Flask server, streaming is implemented as a generator object. As the generator yields its information that arrives piece-by-piece, the piece is sent to client directly (in a form of a Flask response object).</p> <p>With that methodology in mind, ModifiedEvolution has three sequential methods, namely initialize_population, evolving, and polishing. The initialize_population creates a population of possible solution at the beginning. The evolving is a generator that streams or yields all intermediate steps of a solution. The polishing polishes the solution found by differential evolution by L-BFGS algorithm and gives us back a typical Scipy optimization result object.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c1"># https://github.com/scipy/scipy/blob/v1.10.0/scipy/optimize/_differentialevolution.py#L22-L399
</span><span class="k">class</span> <span class="nc">ModifiedEvolution</span><span class="p">(</span><span class="n">DifferentialEvolutionSolver</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(),</span>
                        <span class="n">strategy</span><span class="o">=</span><span class="s">'best1bin'</span><span class="p">,</span>
                        <span class="n">maxiter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">popsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
                        <span class="n">mutation</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">recombination</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                        <span class="n">callback</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">disp</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">polish</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                        <span class="n">init</span><span class="o">=</span><span class="s">'latinhypercube'</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">updating</span><span class="o">=</span><span class="s">'immediate'</span><span class="p">,</span>
                        <span class="n">workers</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">constraints</span><span class="o">=</span><span class="p">(),</span> <span class="n">x0</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
                        <span class="n">integrality</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">vectorized</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span>
                                     <span class="n">strategy</span><span class="o">=</span><span class="n">strategy</span><span class="p">,</span>
                                     <span class="n">maxiter</span><span class="o">=</span><span class="n">maxiter</span><span class="p">,</span>
                                     <span class="n">popsize</span><span class="o">=</span><span class="n">popsize</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="n">tol</span><span class="p">,</span>
                                     <span class="n">mutation</span><span class="o">=</span><span class="n">mutation</span><span class="p">,</span>
                                     <span class="n">recombination</span><span class="o">=</span><span class="n">recombination</span><span class="p">,</span>
                                     <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">polish</span><span class="o">=</span><span class="n">polish</span><span class="p">,</span>
                                     <span class="n">callback</span><span class="o">=</span><span class="n">callback</span><span class="p">,</span>
                                     <span class="n">disp</span><span class="o">=</span><span class="n">disp</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="n">init</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="n">atol</span><span class="p">,</span>
                                     <span class="n">updating</span><span class="o">=</span><span class="n">updating</span><span class="p">,</span>
                                     <span class="n">workers</span><span class="o">=</span><span class="n">workers</span><span class="p">,</span>
                                     <span class="n">constraints</span><span class="o">=</span><span class="n">constraints</span><span class="p">,</span>
                                     <span class="n">x0</span><span class="o">=</span><span class="n">x0</span><span class="p">,</span>
                                     <span class="n">integrality</span><span class="o">=</span><span class="n">integrality</span><span class="p">,</span>
                                     <span class="n">vectorized</span><span class="o">=</span><span class="n">vectorized</span><span class="p">)</span>
        
        <span class="c1"># placeholder
</span>        <span class="bp">self</span><span class="o">.</span><span class="n">warning_flag</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_message</span> <span class="o">=</span> <span class="bp">None</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">last_nit</span> <span class="o">=</span> <span class="bp">None</span>

        
    <span class="k">def</span> <span class="nf">initialize_population</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">status_message</span> <span class="o">=</span> <span class="n">_status_message</span><span class="p">[</span><span class="s">'success'</span><span class="p">]</span>

        <span class="c1"># The population may have just been initialized (all entries are
</span>        <span class="c1"># np.inf). If it has you have to calculate the initial energies.
</span>        <span class="c1"># Although this is also done in the evolve generator it's possible
</span>        <span class="c1"># that someone can set maxiter=0, at which point we still want the
</span>        <span class="c1"># initial energies to be calculated (the following loop isn't run).
</span>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="nb">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">population_energies</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">feasible</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">constraint_violation</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_population_feasibilities</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">population</span><span class="p">))</span>

            <span class="c1"># only work out population energies for feasible solutions
</span>            <span class="bp">self</span><span class="o">.</span><span class="n">population_energies</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">feasible</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_population_energies</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">population</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">feasible</span><span class="p">]))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_promote_lowest_energy</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">evolving</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># do the optimization.
</span>        <span class="k">for</span> <span class="n">nit</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxiter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="c1"># evolve the population by a generation
</span>            <span class="k">try</span><span class="p">:</span>
                <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="c1"># I am a generator!
</span>            <span class="k">except</span> <span class="nb">StopIteration</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">warning_flag</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nfev</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxfun</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">status_message</span> <span class="o">=</span> <span class="n">_status_message</span><span class="p">[</span><span class="s">'maxfev'</span><span class="p">]</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nfev</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxfun</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">status_message</span> <span class="o">=</span> <span class="p">(</span><span class="s">'Maximum number of function evaluations'</span>
                                      <span class="s">' has been reached.'</span><span class="p">)</span>
                <span class="k">break</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">disp</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s">"differential_evolution step {nit}: f({self.x})= {self.population_energies[0]}"</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">:</span>
                <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tol</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">convergence</span> <span class="o">+</span> <span class="n">_MACHEPS</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">warning_flag</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">convergence</span><span class="o">=</span><span class="n">c</span><span class="p">))</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">warning_flag</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">status_message</span> <span class="o">=</span> <span class="p">(</span><span class="s">'callback function requested stop early'</span>
                                      <span class="s">' by returning True'</span><span class="p">)</span>

            <span class="c1"># should the solver terminate?
</span>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">warning_flag</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">converged</span><span class="p">():</span>
                <span class="k">break</span>

            <span class="k">yield</span> <span class="p">(</span><span class="n">nit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">population_energies</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="c1"># slow down for visualization
</span>            <span class="c1"># time.sleep(1)
</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status_message</span> <span class="o">=</span> <span class="n">_status_message</span><span class="p">[</span><span class="s">'maxiter'</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warning_flag</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">last_nit</span> <span class="o">=</span> <span class="n">nit</span>
        <span class="k">print</span> <span class="p">(</span><span class="s">'reaching the end.................'</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">package_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">DE_result</span> <span class="o">=</span> <span class="n">OptimizeResult</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
            <span class="n">fun</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">population_energies</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">nfev</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_nfev</span><span class="p">,</span>
            <span class="n">nit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">last_nit</span><span class="p">,</span>
            <span class="n">message</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">status_message</span><span class="p">,</span>
            <span class="n">success</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">warning_flag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">True</span><span class="p">))</span>
        
        <span class="k">return</span> <span class="n">DE_result</span>
    
    <span class="k">def</span> <span class="nf">perform_polishing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">DE_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">package_results</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">polish</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="nb">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">integrality</span><span class="p">):</span>
            <span class="n">DE_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">polishing</span><span class="p">(</span><span class="n">DE_result</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">DE_result</span>
        

    
    <span class="k">def</span> <span class="nf">polishing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">DE_result</span><span class="p">,</span> <span class="n">polish_method</span> <span class="o">=</span> <span class="s">'L-BFGS-B'</span><span class="p">):</span>
        <span class="c1"># can't polish if all the parameters are integers
</span>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">integrality</span><span class="p">):</span>
            <span class="c1"># set the lower/upper bounds equal so that any integrality
</span>            <span class="c1"># constraints work.
</span>            <span class="n">limits</span><span class="p">,</span> <span class="n">integrality</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">limits</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">integrality</span>
            <span class="n">limits</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">integrality</span><span class="p">]</span> <span class="o">=</span> <span class="n">DE_result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">integrality</span><span class="p">]</span>
            <span class="n">limits</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">integrality</span><span class="p">]</span> <span class="o">=</span> <span class="n">DE_result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">integrality</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapped_constraints</span><span class="p">:</span>
            <span class="n">polish_method</span> <span class="o">=</span> <span class="s">'trust-constr'</span>

            <span class="n">constr_violation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_constraint_violation_fn</span><span class="p">(</span><span class="n">DE_result</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="nb">any</span><span class="p">(</span><span class="n">constr_violation</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">):</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">"differential evolution didn't find a"</span>
                                <span class="s">" solution satisfying the constraints,"</span>
                                <span class="s">" attempting to polish from the least"</span>
                                <span class="s">" infeasible solution"</span><span class="p">,</span> <span class="nb">UserWarning</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">disp</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s">"Polishing solution with '{polish_method}'"</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">,</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">DE_result</span><span class="o">.</span><span class="n">x</span><span class="p">),</span>
                            <span class="n">method</span><span class="o">=</span><span class="n">polish_method</span><span class="p">,</span>
                            <span class="n">bounds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">limits</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                            <span class="n">constraints</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">constraints</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_nfev</span> <span class="o">+=</span> <span class="n">result</span><span class="o">.</span><span class="n">nfev</span>
        <span class="n">DE_result</span><span class="o">.</span><span class="n">nfev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nfev</span>

        <span class="c1"># Polishing solution is only accepted if there is an improvement in
</span>        <span class="c1"># cost function, the polishing was successful and the solution lies
</span>        <span class="c1"># within the bounds.
</span>        <span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">fun</span> <span class="o">&lt;</span> <span class="n">DE_result</span><span class="o">.</span><span class="n">fun</span> <span class="ow">and</span>
                <span class="n">result</span><span class="o">.</span><span class="n">success</span> <span class="ow">and</span>
                <span class="n">np</span><span class="o">.</span><span class="nb">all</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">limits</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">and</span>
                <span class="n">np</span><span class="o">.</span><span class="nb">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">)):</span>
            <span class="n">DE_result</span><span class="o">.</span><span class="n">fun</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">fun</span>
            <span class="n">DE_result</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">x</span>
            <span class="n">DE_result</span><span class="o">.</span><span class="n">jac</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">jac</span>
            <span class="c1"># to keep internal state consistent
</span>            <span class="bp">self</span><span class="o">.</span><span class="n">population_energies</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">fun</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">population</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unscale_parameters</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapped_constraints</span><span class="p">:</span>
            <span class="n">DE_result</span><span class="o">.</span><span class="n">constr</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">violation</span><span class="p">(</span><span class="n">DE_result</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span>
                                <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapped_constraints</span><span class="p">]</span>
            <span class="n">DE_result</span><span class="o">.</span><span class="n">constr_violation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="nb">max</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">DE_result</span><span class="o">.</span><span class="n">constr</span><span class="p">))</span>
            <span class="n">DE_result</span><span class="o">.</span><span class="n">maxcv</span> <span class="o">=</span> <span class="n">DE_result</span><span class="o">.</span><span class="n">constr_violation</span>
            <span class="k">if</span> <span class="n">DE_result</span><span class="o">.</span><span class="n">maxcv</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># if the result is infeasible then success must be False
</span>                <span class="n">DE_result</span><span class="o">.</span><span class="n">success</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="n">DE_result</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="p">(</span><span class="s">"The solution does not satisfy the "</span>
                                        <span class="n">f</span><span class="s">"constraints, MAXCV = {DE_result.maxcv}"</span><span class="p">)</span>
                
        <span class="k">return</span> <span class="n">DE_result</span>


</code></pre></div></div> <p>Although Scipy implementation provides a callback option, I could not turn it into a generator-like object. If that were achievable, much less coding would be required.</p> <p>ModifiedLBFGSB has three sequential methods, namely initialization, solving, and package_result. The initialization prepares variables in a way that are compatible with the Fortran L-FBGS code. The solving represents a generator-like object. The package_result gives the optimization result as in a typical Scipy optimization algorithm.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># from https://github.com/scipy/scipy/blob/dde50595862a4f9cede24b5d1c86935c30f1f88a/scipy/optimize/_lbfgsb_py.py#L386
</span><span class="k">class</span> <span class="nc">ModifiedLBFGSB</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fun</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(),</span> <span class="n">jac</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                     <span class="n">disp</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">maxcor</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">ftol</span><span class="o">=</span><span class="mf">2.2204460492503131e-09</span><span class="p">,</span>
                     <span class="n">gtol</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span> <span class="n">maxfun</span><span class="o">=</span><span class="mi">15000</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="mi">15000</span><span class="p">,</span>
                     <span class="n">iprint</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">maxls</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                     <span class="n">finite_diff_rel_step</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">unknown_options</span><span class="p">):</span>


        
        <span class="n">_check_unknown_options</span><span class="p">(</span><span class="n">unknown_options</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="n">maxcor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pgtol</span> <span class="o">=</span> <span class="n">gtol</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">factr</span> <span class="o">=</span> <span class="n">ftol</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">callback</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxfun</span> <span class="o">=</span> <span class="n">maxfun</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxiter</span> <span class="o">=</span> <span class="n">maxiter</span>

        <span class="n">x0</span> <span class="o">=</span> <span class="n">asarray</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="o">=</span> <span class="n">x0</span><span class="o">.</span><span class="n">shape</span>

        <span class="k">if</span> <span class="n">bounds</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">bounds</span> <span class="o">=</span> <span class="p">[(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bounds</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">:</span>
            <span class="k">print</span> <span class="p">(</span><span class="n">bounds</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">x0</span><span class="p">)</span>
            <span class="k">raise</span> <span class="nb">ValueError</span><span class="p">(</span><span class="s">'length of x0 != length of bounds'</span><span class="p">)</span>

        <span class="c1"># unbounded variables must use None, not +-inf, for optimizer to work properly
</span>        <span class="n">bounds</span> <span class="o">=</span> <span class="p">[(</span><span class="bp">None</span> <span class="k">if</span> <span class="n">l</span> <span class="o">==</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span> <span class="k">else</span> <span class="n">l</span><span class="p">,</span> <span class="bp">None</span> <span class="k">if</span> <span class="n">u</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span> <span class="k">else</span> <span class="n">u</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span><span class="p">,</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">bounds</span><span class="p">]</span>
        <span class="c1"># LBFGSB is sent 'old-style' bounds, 'new-style' bounds are required by
</span>        <span class="c1"># approx_derivative and ScalarFunction
</span>        <span class="n">new_bounds</span> <span class="o">=</span> <span class="n">old_bound_to_new</span><span class="p">(</span><span class="n">bounds</span><span class="p">)</span>

        <span class="c1"># check bounds
</span>        <span class="k">if</span> <span class="p">(</span><span class="n">new_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">new_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="nb">any</span><span class="p">():</span>
            <span class="k">raise</span> <span class="nb">ValueError</span><span class="p">(</span><span class="s">"LBFGSB - one of the lower bounds is greater than an upper bound."</span><span class="p">)</span>

        <span class="c1"># initial vector must lie within the bounds. Otherwise ScalarFunction and
</span>        <span class="c1"># approx_derivative will cause problems
</span>        <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">new_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">new_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">iprint</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="n">sf</span> <span class="o">=</span> <span class="n">_prepare_scalar_function</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">jac</span><span class="o">=</span><span class="n">jac</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span>
                                    <span class="n">bounds</span><span class="o">=</span><span class="n">new_bounds</span><span class="p">,</span>
                                    <span class="n">finite_diff_rel_step</span><span class="o">=</span><span class="n">finite_diff_rel_step</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">func_and_grad</span> <span class="o">=</span> <span class="n">sf</span><span class="o">.</span><span class="n">fun_and_grad</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sf</span> <span class="o">=</span> <span class="n">sf</span>

        <span class="n">fortran_int</span> <span class="o">=</span> <span class="n">_lbfgsb</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">intvar</span><span class="o">.</span><span class="n">dtype</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nbd</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">fortran_int</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">low_bnd</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">float64</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">upper_bnd</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">float64</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bounds_map</span> <span class="o">=</span> <span class="p">{(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="mi">2</span><span class="p">,</span>
                    <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="mi">3</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">):</span>
            <span class="n">l</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="n">bounds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">l</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">low_bnd</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">l</span>
                <span class="n">l</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">u</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">upper_bnd</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span>
                <span class="n">u</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nbd</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds_map</span><span class="p">[</span><span class="n">l</span><span class="p">,</span> <span class="n">u</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">maxls</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nb">ValueError</span><span class="p">(</span><span class="s">'maxls must be positive.'</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">maxls</span> <span class="o">=</span> <span class="n">maxls</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">float64</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">float64</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,),</span> <span class="n">float64</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wa</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">+</span> <span class="mi">5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">+</span> <span class="mi">11</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">+</span> <span class="mi">8</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="n">float64</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iwa</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">fortran_int</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">task</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">'S60'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csave</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">'S60'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lsave</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">fortran_int</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isave</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="mi">44</span><span class="p">,</span> <span class="n">fortran_int</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dsave</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="mi">29</span><span class="p">,</span> <span class="n">float64</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">task</span><span class="p">[:]</span> <span class="o">=</span> <span class="s">'START'</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">n_iterations</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">solving</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># x, f, g, wa, iwa, task, csave, lsave, isave, dsave = \
</span>            <span class="n">_lbfgsb</span><span class="o">.</span><span class="n">setulb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">low_bnd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">upper_bnd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nbd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">factr</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">pgtol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">wa</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">iwa</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">task</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">iprint</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">csave</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lsave</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">isave</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dsave</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxls</span><span class="p">)</span>
            <span class="n">task_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">task_str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">b</span><span class="s">'FG'</span><span class="p">):</span>
                <span class="c1"># The minimization routine wants f and g at the current x.
</span>                <span class="c1"># Note that interruptions due to maxfun are postponed
</span>                <span class="c1"># until the completion of the current minimization iteration.
</span>                <span class="c1"># Overwrite f and g:
</span>                <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">func_and_grad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
                <span class="k">yield</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_iterations</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sf</span><span class="o">.</span><span class="n">nfev</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">task_str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">b</span><span class="s">'NEW_X'</span><span class="p">):</span>
                
                <span class="c1"># new iteration
</span>                <span class="bp">self</span><span class="o">.</span><span class="n">n_iterations</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">))</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_iterations</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxiter</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">task</span><span class="p">[:]</span> <span class="o">=</span> <span class="s">'STOP: TOTAL NO. of ITERATIONS REACHED LIMIT'</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">sf</span><span class="o">.</span><span class="n">nfev</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxfun</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">task</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">(</span><span class="s">'STOP: TOTAL NO. of f AND g EVALUATIONS '</span>
                            <span class="s">'EXCEEDS LIMIT'</span><span class="p">)</span>
                <span class="c1"># this step calculates the solution at the end of an iteration
</span>                <span class="c1"># thus, we cannot see the steps taken to evaluate numerical gradient at f'(x)
</span>                <span class="c1"># yield (self.n_iterations, self.x, self.sf.nfev,self.f,self.g)
</span>            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>

            <span class="c1"># print ('self.n_iterations {}, self.x {}, self.sf.nfev {}, f {}, g {}'.format(
</span>            <span class="c1">#     self.n_iterations,
</span>            <span class="c1">#     self.x,
</span>            <span class="c1">#     self.sf.nfev,
</span>            <span class="c1">#         self.f,
</span>            <span class="c1">#         self.g))
</span>            


    <span class="k">def</span> <span class="nf">package_result</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">task_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">b</span><span class="s">'</span><span class="se">\x00</span><span class="s">'</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">task_str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">b</span><span class="s">'CONV'</span><span class="p">):</span>
            <span class="n">warnflag</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">sf</span><span class="o">.</span><span class="n">nfev</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxfun</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_iterations</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxiter</span><span class="p">:</span>
            <span class="n">warnflag</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">warnflag</span> <span class="o">=</span> <span class="mi">2</span>

        <span class="c1"># These two portions of the workspace are described in the mainlb
</span>        <span class="c1"># subroutine in lbfgsb.f. See line 363.
</span>        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wa</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wa</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">:</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>

        <span class="c1"># See lbfgsb.f line 160 for this portion of the workspace.
</span>        <span class="c1"># isave(31) = the total number of BFGS updates prior the current iteration;
</span>        <span class="n">n_bfgs_updates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">isave</span><span class="p">[</span><span class="mi">30</span><span class="p">]</span>

        <span class="n">n_corrs</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">n_bfgs_updates</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">)</span>
        <span class="n">hess_inv</span> <span class="o">=</span> <span class="n">LbfgsInvHessProduct</span><span class="p">(</span><span class="n">s</span><span class="p">[:</span><span class="n">n_corrs</span><span class="p">],</span> <span class="n">y</span><span class="p">[:</span><span class="n">n_corrs</span><span class="p">])</span>

        <span class="n">task_str</span> <span class="o">=</span> <span class="n">task_str</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">OptimizeResult</span><span class="p">(</span><span class="n">fun</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="n">jac</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="p">,</span> <span class="n">nfev</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sf</span><span class="o">.</span><span class="n">nfev</span><span class="p">,</span>
                            <span class="n">njev</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sf</span><span class="o">.</span><span class="n">ngev</span><span class="p">,</span>
                            <span class="n">nit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_iterations</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="n">warnflag</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="n">task_str</span><span class="p">,</span>
                            <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">success</span><span class="o">=</span><span class="p">(</span><span class="n">warnflag</span> <span class="o">==</span> <span class="mi">0</span><span class="p">),</span> <span class="n">hess_inv</span><span class="o">=</span><span class="n">hess_inv</span><span class="p">)</span>
        
        <span class="k">print</span> <span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>	
</code></pre></div></div> <p>As an aside, I design these solver objects with compatibility in mind. Thus, they take in the same set of parameters and output the same OptimizeResult object as the original Scipy implementation.</p> <h2 id="part-ii---graphical-user-interface--web-page">Part II - Graphical User Interface / Web page</h2> <p>To understand the graphical user interface of the web application, letâ€™s start by taking a closer look at the final web page.</p> <div class="juxtapose"> <img src="/assets/images/streamingScipyOptimization/differentialEvolution1.png" /> <img src="/assets/images/streamingScipyOptimization/lbfgs1.png" /> </div> <script src="https://cdn.knightlab.com/libs/juxtapose/latest/js/juxtapose.min.js"></script> <link rel="stylesheet" href="https://cdn.knightlab.com/libs/juxtapose/latest/css/juxtapose.css" /> <p>The upper half contains the configuration of the Rosenbrock function, solution space, and the optimization algorithms. (the Rosenbrock function coefficients, choice of the optimization algorithm, the upper and lower bounds of the search space, initial guesses of solution (x), and the maximum number of iterations) The lower half contains a table of the sequential steps of a chosen optimizer.</p> <p><a href="https://getbootstrap.com">Bootstrap</a> provides this basic design of the web page; <a href="https://github.com/NUKnightLab/juxtapose">Juxtapose</a> allows users to visually compare the intermediate solutions of each algorithm. Pushing the central slider left or right reveals the screen-shot of the web page for differential evolution outputs and L-BFGS outputs respectively.</p> <p>Even though the screen-shots are static, in reality, during streaming, the HTML of the web page is updated dynamically by the server responses. An easy way to achieve this is to manipulate HTML by <a href="https://flask.palletsprojects.com/en/2.2.x/quickstart/">Flask</a>, which provides APIs that leverage <a href="https://palletsprojects.com/p/jinja/">Jinja2 engine</a> that generate new HTML from HTML templates.</p> <p>I have made heavy use of variables, if statements, for loops and filters in Jinja2. The form input variable values are set by Python string variables. Practically speaking, the default input values are python string that are hard coded on the server.</p> <p>I need to take extra care when it comes to the result table headers. Unlike differential evolution algorithm, L-BFGS calculates the gradient of the objective function. Jinja2 length filter tells me how many items are sent back. I then know what names should go in the header!</p> <p>Outer for loop creates HTML code snippets that renders the row of the intermediate result table; the inner for loop creates table data code snippet which populates the table row with values that are being streamed from server. The namespace variable allows me to turn off header after the first row.</p> <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!doctype html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"width=device-width, initial-scale=1"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;title&gt;</span>Scipy optimization demo<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">integrity=</span><span class="s">"sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65"</span> <span class="na">crossorigin=</span><span class="s">"anonymous"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Hello, world of Scipy optimization!<span class="nt">&lt;/h1&gt;</span>
	<span class="nt">&lt;h3&gt;</span>Minimizing Rosenbrock Function <span class="nt">&lt;/h3&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"</span> <span class="na">integrity=</span><span class="s">"sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"</span> <span class="na">crossorigin=</span><span class="s">"anonymous"</span><span class="nt">&gt;&lt;/script&gt;</span>

	<span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/solver"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
	<span class="nt">&lt;table</span> <span class="na">class=</span><span class="s">"table"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;thead&gt;</span>
		<span class="nt">&lt;tr&gt;</span>
			<span class="nt">&lt;th&gt;</span> Function parameters<span class="nt">&lt;/th&gt;</span>
			<span class="nt">&lt;th&gt;</span> Values<span class="nt">&lt;/th&gt;</span>
		<span class="nt">&lt;/tr&gt;</span>
		<span class="nt">&lt;/thead&gt;</span>
		<span class="nt">&lt;tbody&gt;</span>
		<span class="nt">&lt;tr&gt;</span>
			<span class="nt">&lt;td&gt;</span>a<span class="nt">&lt;/td&gt;</span>
			<span class="nt">&lt;td&gt;&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">id=</span><span class="s">"a"</span> <span class="na">name=</span><span class="s">"a"</span> <span class="na">value=</span><span class="s">{{a}}</span><span class="nt">&gt;&lt;/td&gt;</span>
		<span class="nt">&lt;/tr&gt;</span>
		
		<span class="nt">&lt;tr&gt;</span>
			<span class="nt">&lt;td&gt;</span>b<span class="nt">&lt;/td&gt;</span>
			<span class="nt">&lt;td&gt;&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">id=</span><span class="s">"b"</span> <span class="na">name=</span><span class="s">"b"</span> <span class="na">value=</span><span class="s">{{b}}</span><span class="nt">&gt;&lt;/td&gt;</span>
		<span class="nt">&lt;/tr&gt;</span>
		<span class="nt">&lt;/tbody&gt;</span>
		
		<span class="nt">&lt;thead&gt;</span>
		<span class="nt">&lt;tr&gt;</span>
			<span class="nt">&lt;th&gt;</span> Solution Bound<span class="nt">&lt;/th&gt;</span>
			<span class="nt">&lt;th&gt;</span> Values<span class="nt">&lt;/th&gt;</span>
		<span class="nt">&lt;/thead&gt;</span>
		<span class="nt">&lt;tbody&gt;</span>
		<span class="nt">&lt;tr&gt;</span>
			<span class="nt">&lt;td&gt;</span>lower<span class="nt">&lt;/td&gt;</span>
			<span class="nt">&lt;td&gt;&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">id=</span><span class="s">"lower"</span> <span class="na">name=</span><span class="s">"lower"</span> <span class="na">value=</span><span class="s">{{lower}}</span><span class="nt">&gt;&lt;/td&gt;</span>
		<span class="nt">&lt;/tr&gt;</span>
		
		<span class="nt">&lt;tr&gt;</span>
			<span class="nt">&lt;td&gt;</span>upper<span class="nt">&lt;/td&gt;</span>
			<span class="nt">&lt;td&gt;&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">id=</span><span class="s">"upper"</span> <span class="na">name=</span><span class="s">"upper"</span> <span class="na">value=</span><span class="s">{{upper}}</span><span class="nt">&gt;&lt;/td&gt;</span>
		<span class="nt">&lt;/tr&gt;</span>
		
		<span class="nt">&lt;tr&gt;</span>
			<span class="nt">&lt;td&gt;</span>x (initial guess)<span class="nt">&lt;/td&gt;</span>
			<span class="nt">&lt;td&gt;&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">id=</span><span class="s">"initialGuess"</span> <span class="na">name=</span><span class="s">"initialGuess"</span> <span class="na">value=</span><span class="s">{{initialGuess}}</span><span class="nt">&gt;&lt;/td&gt;</span>
		<span class="nt">&lt;/tr&gt;</span>
		<span class="nt">&lt;/tbody&gt;</span>
		
		<span class="nt">&lt;thead&gt;</span>
		<span class="nt">&lt;tr&gt;</span>
			<span class="nt">&lt;th&gt;</span> Solver Configuration<span class="nt">&lt;/th&gt;</span>
			<span class="nt">&lt;th&gt;</span> Values<span class="nt">&lt;/th&gt;</span>
		<span class="nt">&lt;/tr&gt;</span>
		<span class="nt">&lt;/thead&gt;</span>
		<span class="nt">&lt;tbody&gt;</span>
		<span class="nt">&lt;tr&gt;</span>
			<span class="nt">&lt;td&gt;</span>max iterations<span class="nt">&lt;/td&gt;</span>
			<span class="nt">&lt;td&gt;&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">id=</span><span class="s">"maxiter"</span> <span class="na">name=</span><span class="s">"maxiter"</span> <span class="na">value=</span><span class="s">{{maxiter}}</span><span class="nt">&gt;&lt;/td&gt;</span>
		<span class="nt">&lt;/tr&gt;</span>
		

		
		
		<span class="nt">&lt;tr&gt;</span>
			<span class="nt">&lt;td&gt;</span>methods<span class="nt">&lt;/td&gt;</span>
			<span class="nt">&lt;td&gt;</span>
			<span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"methods"</span><span class="err">,</span> <span class="na">name=</span><span class="s">"methods"</span><span class="nt">&gt;</span>
				<span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"LBFGS"</span><span class="nt">&gt;</span>LBFGS<span class="nt">&lt;/option&gt;</span>
				<span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"Differential Evolution"</span><span class="nt">&gt;</span>Differential Evolution<span class="nt">&lt;/option&gt;</span>
			<span class="nt">&lt;/select&gt;</span>
			<span class="nt">&lt;/td&gt;</span>
			
		<span class="nt">&lt;/tr&gt;</span>
		<span class="nt">&lt;/tbody&gt;</span>
		<span class="nt">&lt;tr&gt;</span>
			<span class="nt">&lt;td&gt;&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;&lt;/td&gt;</span>
			<span class="nt">&lt;td&gt;&lt;a</span> <span class="na">class=</span><span class="s">"nav-link"</span> <span class="na">href=</span><span class="s">"{{ url_for('hello_world') }}"</span><span class="nt">&gt;</span>Clear results and return to Home page<span class="nt">&lt;/a&gt;&lt;/td&gt;</span>
		<span class="nt">&lt;/tr&gt;</span>

		<span class="nt">&lt;/tbody&gt;</span>
	<span class="nt">&lt;/table&gt;</span>

	<span class="nt">&lt;/form&gt;</span>
	
	<span class="c">&lt;!--
	namespace ensures the variable is available outside of this scope (including the for loop) !
	---&gt;</span>
	
	{% set display = namespace(header=true) %}
	
	{% for (result, timeElapsed) in results %}
		{% if display.header %}
		<span class="nt">&lt;table</span> <span class="na">class=</span><span class="s">"table"</span><span class="nt">&gt;</span>
			{% if result | length == 3 %}
			<span class="nt">&lt;thead&gt;</span>
				<span class="nt">&lt;tr&gt;</span>
					<span class="nt">&lt;th&gt;</span> Iteration<span class="nt">&lt;/th&gt;</span>
					<span class="nt">&lt;th&gt;</span> x <span class="nt">&lt;/th&gt;</span>
					<span class="nt">&lt;th&gt;</span> f(x) <span class="nt">&lt;/th&gt;</span>
					<span class="nt">&lt;th&gt;</span> time elapsed (s) <span class="nt">&lt;/th&gt;</span>
				<span class="nt">&lt;/tr&gt;</span>
			<span class="nt">&lt;/thead&gt;</span>
			
			{% elif result | length == 5 %}
			<span class="nt">&lt;thead&gt;</span>
				<span class="nt">&lt;tr&gt;</span>
					<span class="nt">&lt;th&gt;</span> Iteration<span class="nt">&lt;/th&gt;</span>
					<span class="nt">&lt;th&gt;</span> x <span class="nt">&lt;/th&gt;</span>
					<span class="nt">&lt;th&gt;</span> number of f(x) evaluations<span class="nt">&lt;/th&gt;</span>
					<span class="nt">&lt;th&gt;</span> f(x) <span class="nt">&lt;/th&gt;</span>
					<span class="nt">&lt;th&gt;</span> f'(x) <span class="nt">&lt;/th&gt;</span>
					<span class="nt">&lt;th&gt;</span> time elapsed (s) <span class="nt">&lt;/th&gt;</span>
				<span class="nt">&lt;/tr&gt;</span>
			<span class="nt">&lt;/thead&gt;</span>
			{% endif %}
			
			<span class="nt">&lt;tbody&gt;</span>
			{% set display.header = false %}
		
		{% endif %}
		

	<span class="nt">&lt;tr&gt;</span>
		{% for item in result %}
		<span class="nt">&lt;td&gt;</span> {{item}} <span class="nt">&lt;/td&gt;</span>
		{% endfor %}
		<span class="nt">&lt;td&gt;</span> {{timeElapsed}} <span class="nt">&lt;/td&gt;</span>
	<span class="nt">&lt;/tr&gt;</span>
	
	{% endfor %}
	<span class="nt">&lt;/tbody&gt;</span>
	<span class="nt">&lt;/table&gt;</span>

  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div> <h2 id="part-iii---flask-server">Part III - Flask Server</h2> <p>Flask is my first choice for setting up a web server (WSGI - web server gateway interface application) because its documentation is quite comprehensive and its APIs are quite readable. The reason is seven-fold.</p> <ol> <li>Flask manages the endpoints using a decorator</li> <li>Flask handles request via a request object and response via a response object for you</li> <li>Flask renders HTML template automatically</li> <li>Flask isolates the current application scope and lets programmers create variables or default values inside it</li> <li>String variables are easily passed around</li> <li>Flask has default settings, a feature that simplifies the code (i.e. all HTML templates are placed under templates folder, a location where Flask goes to and looks up templates files automatically)</li> <li>By running <em>flask run â€“reload â€“debugger</em> in the command prompt, reload means Flask detects file change and reloads the latest version; debugger shows an error traceback on the HTML page</li> </ol> <p>To show you what the project structure is like, I draw a tree using windows <em>tree /f</em> command. This organization helps reduce the risk of circular importing.</p> <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:.
â”‚   run_app.py
â”‚
â”œâ”€â”€â”€api
â”‚   â”‚   routes.py
â”‚   â”‚   scipyOptimizer.py
â”‚   â”‚   __init__.py
â”‚   â”‚
â”‚   â”œâ”€â”€â”€templates
â”‚   â”‚       callback.html
â”‚   â”‚
â”‚   â””â”€â”€â”€__pycache__
â”‚           routes.cpython-310.pyc
â”‚           scipyOptimizer.cpython-310.pyc
â”‚           __init__.cpython-310.pyc
â”‚
â””â”€â”€â”€__pycache__
        run_app.cpython-310.pyc
</code></pre></div></div> <p>The server starts when Flask runs run_app.py. I often set Flask environment variable before calling flask run for the sake of convenience. (use Set FLASK_APP=run_app.py on windows)</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">api</span> <span class="kn">import</span> <span class="n">app</span>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>

    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div> <p>The api module initializes the application as shown below:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">current_app</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">stream_template</span><span class="p">,</span> <span class="n">Response</span><span class="p">,</span> <span class="n">request</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">debug</span><span class="o">=</span><span class="bp">True</span>

<span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">app_context</span><span class="p">():</span>
    <span class="s">"""
    Default optimization setting
    """</span>
    <span class="n">current_app</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">current_app</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="mf">100.0</span>
    <span class="n">current_app</span><span class="o">.</span><span class="n">lower</span> <span class="o">=</span> <span class="o">-</span><span class="mf">4.0</span>
    <span class="n">current_app</span><span class="o">.</span><span class="n">upper</span> <span class="o">=</span> <span class="mf">4.0</span>
    <span class="n">current_app</span><span class="o">.</span><span class="n">maxiter</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">current_app</span><span class="o">.</span><span class="n">initialGuess</span> <span class="o">=</span> <span class="s">"0.5,0.5"</span>

<span class="kn">from</span> <span class="nn">api</span> <span class="kn">import</span> <span class="n">routes</span>
</code></pre></div></div> <p>Note that we must initialize all routes. Or else we cannot find our endpoints.</p> <p>The routes are listed below:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">current_app</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">stream_template</span><span class="p">,</span> <span class="n">Response</span><span class="p">,</span> <span class="n">request</span>
<span class="kn">from</span> <span class="nn">.scipyOptimizer</span> <span class="kn">import</span> <span class="n">ModifiedEvolution</span><span class="p">,</span> <span class="n">rosenbrock_func</span><span class="p">,</span> <span class="n">ModifiedLBFGSB</span>
<span class="kn">import</span> <span class="nn">time</span><span class="p">,</span> <span class="n">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">api</span> <span class="kn">import</span> <span class="n">app</span>

<span class="k">def</span> <span class="nf">extract_form</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="c1"># we cannot get json as we did not submit json &gt;_&lt;
</span>    <span class="c1"># variable_name = request.get_json()
</span>    <span class="c1"># 
</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'a'</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'b'</span><span class="p">)</span>
    <span class="n">lower</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'lower'</span><span class="p">)</span>
    <span class="n">upper</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'upper'</span><span class="p">)</span>
    <span class="n">maxiter</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'maxiter'</span><span class="p">)</span>

    <span class="n">initialGuess</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'initialGuess'</span><span class="p">)</span>
    <span class="k">print</span> <span class="p">(</span><span class="s">'initialGuess '</span><span class="p">,</span> <span class="n">initialGuess</span><span class="p">)</span>
    <span class="n">initialGuess</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">initialGuess</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">','</span><span class="p">)]</span>

    <span class="c1"># values in request objects are string
</span>    <span class="n">func</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">rosenbrock_func</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
    <span class="n">maxiter</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">maxiter</span><span class="p">)</span>
    <span class="n">lower</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">lower</span><span class="p">)</span>
    <span class="n">upper</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">upper</span><span class="p">)</span>

    <span class="n">bounds</span> <span class="o">=</span> <span class="p">[(</span><span class="n">lower</span><span class="p">,</span><span class="n">upper</span><span class="p">),</span> <span class="p">(</span><span class="n">lower</span><span class="p">,</span><span class="n">upper</span><span class="p">)]</span>
    <span class="k">print</span> <span class="p">(</span><span class="s">'bounds '</span><span class="p">,</span> <span class="n">bounds</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">maxiter</span><span class="p">,</span> <span class="n">initialGuess</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span>
    

<span class="o">@</span><span class="n">app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hello_world</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">"callback.html"</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="n">current_app</span><span class="o">.</span><span class="n">maxiter</span><span class="p">,</span>
                            <span class="n">a</span><span class="o">=</span><span class="n">current_app</span><span class="o">.</span><span class="n">a</span><span class="p">,</span>
                              <span class="n">b</span><span class="o">=</span><span class="n">current_app</span><span class="o">.</span><span class="n">b</span><span class="p">,</span>
                                <span class="n">lower</span><span class="o">=</span><span class="n">current_app</span><span class="o">.</span><span class="n">lower</span><span class="p">,</span>
                                  <span class="n">upper</span><span class="o">=</span><span class="n">current_app</span><span class="o">.</span><span class="n">upper</span><span class="p">,</span>
                                    <span class="n">initialGuess</span><span class="o">=</span><span class="n">current_app</span><span class="o">.</span><span class="n">initialGuess</span><span class="p">)</span>


<span class="o">@</span><span class="n">app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s">"/solver"</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">'POST'</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">solver</span><span class="p">():</span>
    
    <span class="n">methods</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'methods'</span><span class="p">)</span>
    <span class="k">print</span> <span class="p">(</span><span class="s">'methods = '</span><span class="p">,</span> <span class="n">methods</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">methods</span> <span class="o">==</span> <span class="s">"Differential Evolution"</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">callEvolution</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">methods</span> <span class="o">==</span> <span class="s">"LBFGS"</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">call_LBFGS</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="nb">RuntimeError</span><span class="p">(</span><span class="s">'unknown methods'</span><span class="p">)</span>

<span class="o">@</span><span class="n">app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s">"/evolve"</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">"POST"</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">callEvolution</span><span class="p">():</span>
     
    <span class="n">bounds</span><span class="p">,</span> <span class="n">maxiter</span><span class="p">,</span> <span class="n">initialGuess</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span>  <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="n">extract_form</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

    <span class="c1"># start a timer to see how long it takes to solve the problem
</span>    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">add_html</span><span class="p">():</span>
        <span class="s">"""
        Create a generator that produces the intermediate results of the optimizer
        """</span>
        <span class="c1"># using a context manager means that any created Pool objects are
</span>        <span class="c1"># cleared up.
</span>        <span class="c1"># don't pass args because they try to enter the f(x) as arguments
</span>        <span class="k">with</span> <span class="n">ModifiedEvolution</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="n">maxiter</span><span class="p">,</span>
                             <span class="n">polish</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">disp</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">solver</span><span class="p">:</span>
            
            <span class="n">solver</span><span class="o">.</span><span class="n">initialize_population</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">intermediate_results</span> <span class="ow">in</span> <span class="n">solver</span><span class="o">.</span><span class="n">evolving</span><span class="p">():</span>
                <span class="k">yield</span> <span class="p">(</span><span class="n">intermediate_results</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">start_time</span><span class="p">)</span>
                
            <span class="n">result</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">perform_polishing</span><span class="p">()</span>

        <span class="k">yield</span> <span class="p">((</span><span class="s">"final"</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">fun</span><span class="p">),</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">start_time</span><span class="p">)</span>
            

    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">stream_template</span><span class="p">(</span><span class="s">'callback.html'</span><span class="p">,</span>
                                     <span class="n">results</span><span class="o">=</span><span class="n">add_html</span><span class="p">(),</span>
                                    <span class="n">initialGuess</span><span class="o">=</span><span class="s">','</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">initialGuess</span><span class="p">]),</span>
                                    <span class="n">maxiter</span><span class="o">=</span><span class="n">maxiter</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">,</span> 
                                    <span class="n">lower</span><span class="o">=</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="n">upper</span><span class="p">))</span>

<span class="o">@</span><span class="n">app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/lbfgs'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">'POST'</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">call_LBFGS</span><span class="p">():</span>
    
    <span class="n">bounds</span><span class="p">,</span> <span class="n">maxiter</span><span class="p">,</span> <span class="n">initialGuess</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span>  <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="n">extract_form</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="c1"># start a timer to see how long it takes to solve the problem
</span>    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="n">solver</span> <span class="o">=</span> <span class="n">ModifiedLBFGSB</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">initialGuess</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="n">maxiter</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">add_html</span><span class="p">(</span><span class="n">solver</span><span class="p">):</span>
        <span class="s">"""
        Create a generator that produces the intermediate results of the optimizer
        """</span>
        
        <span class="k">for</span> <span class="n">intermediate_results</span> <span class="ow">in</span> <span class="n">solver</span><span class="o">.</span><span class="n">solving</span><span class="p">():</span>
            <span class="k">yield</span> <span class="p">(</span><span class="n">intermediate_results</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">start_time</span><span class="p">)</span>
                
        <span class="n">result</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">package_result</span><span class="p">()</span>

        <span class="k">yield</span> <span class="p">((</span><span class="s">"final"</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">nfev</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">fun</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">jac</span><span class="p">),</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">start_time</span><span class="p">)</span>
            
    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">stream_template</span><span class="p">(</span><span class="s">'callback.html'</span><span class="p">,</span>
                                     <span class="n">results</span><span class="o">=</span><span class="n">add_html</span><span class="p">(</span><span class="n">solver</span><span class="p">),</span>
                                    <span class="n">initialGuess</span><span class="o">=</span><span class="s">','</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">initialGuess</span><span class="p">]),</span>
                                    <span class="n">maxiter</span><span class="o">=</span><span class="n">maxiter</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">,</span> 
                                    <span class="n">lower</span><span class="o">=</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="n">upper</span><span class="p">))</span>
</code></pre></div></div> <p>I always extract userâ€™s form to obtain the most up-to-date configurations. When Flask renders the HTML page, I pass the configurations along so that the user configurations are persistent (without being overwritten by default optimization setting) on the HTML page. It is worth noting that stream_with_context can also be used here if the request object ought to be retained during streaming.</p> </div> <div id="disqus_thread"></div> </article> <script> var disqus_config = function () { this.page.url = "/deep_learning/2023/01/27/StreamScipyOptimization/"; /* Replace PAGE_URL with your page's canonical URL variable */ this.page.identifier = "/deep_learning/2023/01/27/StreamScipyOptimization"; /* Replace PAGE_IDENTIFIER with your page's unique identifier variable */ }; (function () { /* DON'T EDIT BELOW THIS LINE */ var d = document, s = d.createElement('script'); s.src = 'https://.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a> </noscript></div> </div> <!-- End of row--> <div class="row"> <div class="col-md-4"> <div class="card"> <div class="card-header"> About </div> <div class="card-body"> <!-- Your Bio --> <p class="author_bio"> Hello, My name is Wilson Fok. I love to extract useful insights and knowledge from big data. Constructive feedback and insightful comments are very welcome!</p> </div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-header">Categories </div> <div class="card-body text-dark"> <div id="#Finance"></div> <li class="tag-head"> <a href="/blog/categories/Finance">Finance</a> </li> <a name="Finance"></a> <div id="#NLP"></div> <li class="tag-head"> <a href="/blog/categories/NLP">NLP</a> </li> <a name="NLP"></a> <div id="#Deep_Learning"></div> <li class="tag-head"> <a href="/blog/categories/Deep_Learning">Deep_Learning</a> </li> <a name="Deep_Learning"></a> <div id="#Others"></div> <li class="tag-head"> <a href="/blog/categories/Others">Others</a> </li> <a name="Others"></a> </div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-header">Useful Links </div> <div class="card-body text-dark"> <li > <a href="/about">About Me</a> </li> <li > <a href="/blog">Blog</a> </li> <li > <a href="/blog/categories">Categories</a> </li> <li > <a href="/contact">Contact Me</a> </li> </div> </div> </div> </div> </div> <footer> <p> Powered by Jekyll. Hosted on <a href="https://pages.github.com">Github</a>. Subscribe via <a href=" /feed.xml ">RSS <i class="fa fa-rss" aria-hidden="true"></i> </a> </p> </footer> </div> <script> var options = { classname: 'my-class', id: 'my-id' }; var nanobar = new Nanobar( options ); nanobar.go( 30 ); nanobar.go( 76 ); nanobar.go(100); </script> <!-- <div hidden id="snipcart" data-api-key="Y2I1NTAyNWYtMTNkMy00ODg0LWE4NDItNTZhYzUxNzJkZTI5NjM3MDI4NTUzNzYyMjQ4NzU0"></div> <script src="https://cdn.snipcart.com/themes/v3.0.0-beta.3/default/snipcart.js" defer></script> --> <script src="/assets/js/mode-switcher.js"></script> </body> </html>
