<!DOCTYPE html> <html lang=" en "><head> <meta charset="utf-8"> <title>Wilson Fok - A data science enthusiast</title> <meta http-equip="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <meta name="description" content="Learning object detection part 2 - detection of shapes and colors" /> <meta name="keywords" content="Learning object detection part 2 - detection of shapes and colors, Wilson Fok, Deep_Learning" /> <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml"> <meta content="" property="fb:app_id"> <meta content="Wilson Fok" property="og:site_name"> <meta content="Learning object detection part 2 - detection of shapes and colors" property="og:title"> <meta content="article" property="og:type"> <meta content="Using a simple toy problem to learn object detection methods and principles" property="og:description"> <meta content="/deep_learning/2020/08/02/Learning_Object_Detection_part2/" property="og:url"> <meta content="2020-08-02T00:00:00+08:00" property="article:published_time"> <meta content="/about/" property="article:author"> <meta content="/assets/img/posts//assets/images/toy/dataset/toyDataset.png" property="og:image"> <meta content="Deep_Learning" property="article:section"> <meta name="twitter:card" content="summary"> <meta name="twitter:site" content="@"> <meta name="twitter:creator" content="@"> <meta name="twitter:title" content="Learning object detection part 2 - detection of shapes and colors"> <meta content="Wilson Fok" property="og:site_name"> <meta name="twitter:url" content="/deep_learning/2020/08/02/Learning_Object_Detection_part2/"> <meta name="twitter:description" content="Hello, My name is Wilson Fok. I love to extract useful insights and knowledge from big data. I also like to make new friends and connections. Let's connect! "> <!-- load layout style css --> <link rel="stylesheet" href="/assets/css/main.css" /> <link rel="stylesheet" href="/assets/css/custom-style.css" /> <link rel="stylesheet" href="/assets/bower_components/lightgallery/dist/css/lightgallery.min.css"/> <link rel="stylesheet" href="/assets/bower_components/bootstrap/dist/css/bootstrap.min.css" /> <link rel="stylesheet" href="/assets/bower_components/font-awesome/web-fonts-with-css/css/fontawesome-all.min.css" /> <!-- Favicon --> <link rel="icon" href="/assets/img/favicon.ico" type="image/gif" sizes="16x16"> <!-- Jquery --> <!-- one or more of the below scripts does fancy word animation and dropdown menu --> <script src="/assets/extra_js/jquery-3.4.1.min.js"></script> <script src="/assets/extra_js/picturefill min/picturefill.min.js"></script> <script src="/assets/extra_js/instantsearch min/instantsearch.min.js"></script> <script src="/assets/extra_js/moment min/moment.min.js"></script> <script src="/assets/bower_components/jquery.easing/jquery.easing.min.js"></script> <script src="/assets/bower_components/bootstrap/dist/js/bootstrap.bundle.min.js"></script> <script src="/assets/bower_components/jquery-mousewheel/jquery.mousewheel.min.js"></script> <script src="/assets/bower_components/lightgallery/dist/js/lightgallery-all.min.js"></script> <script src="/assets/bower_components/imagesloaded/imagesloaded.pkgd.min.js"></script> <script src="/assets/bower_components/nanobar/nanobar.min.js"></script> <script src="/assets/bower_components/typewrite/dist/typewrite.min.js"></script> <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script> </head><body> <div class="container-fluid"><header> <script src="https://cdn.knightlab.com/libs/juxtapose/latest/js/juxtapose.min.js"></script> <link rel="stylesheet" href="https://cdn.knightlab.com/libs/juxtapose/latest/css/juxtapose.css"> <div class="col-lg-12"> <div class="row"> <nav class="navbar navbar-expand-lg fixed-top navbar-dark " id="topNav"> <!-- <a class="navbar-brand" href="#">Wilson Fok</a> --> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="/">Wilson Fok</a> <div class="collapse navbar-collapse" id="navbarNav"> <ul class="navbar-nav"> <li class="nav-item"> <a class="nav-link" href="/about">About Me</a> </li> <li class="nav-item"> <a class="nav-link" href="/blog">Blog</a> </li> <li class="nav-item"> <a class="nav-link" href="/blog/categories">Categories</a> </li> <li class="nav-item"> <a class="nav-link" href="/gallery">Gallery</a> </li> <li class="nav-item"> <a class="nav-link" href="/contact">Contact Me</a> </li> </ul> </div> <ul class="nav justify-content-end"> <!-- <li class="nav-item"> <a class="nav-link" id="search-icon" href="/search/"><i class="fa fa-search" aria-hidden="true"></i></a> </li> --> <li class="nav-item"> <input class="nav-link switch" id="theme-toggle" onclick="modeSwitcher() "type="checkbox" name="checkbox" > </li> </ul> </nav> </div> </div> </header><div class="col-lg-12"> <!-- Blog Post Breadcrumbs --><div class="col-lg-12"> <nav aria-label="breadcrumb" role="navigation"> <ol class="breadcrumb"> <li class="breadcrumb-item"> <a href="/blog"><i class="fa fa-home" aria-hidden="true"></i></a> </li> <li class="breadcrumb-item active" aria-current="page"><a href="/deep_learning/2020/08/02/Learning_Object_Detection_part2/">Learning object detection part 2 - detection of shapes and colors</a></li> </ol> </nav> </div><div class="row" id="blog-post-container"> <div class="col-lg-8 offset-md-2"><article class="card" itemscope itemtype="http://schema.org/BlogPosting"> <div class="card-header"> <h1 class="post-title" itemprop="name headline">Learning object detection part 2 - detection of shapes and colors</h1> <p></p> <h6 class="post-meta"> <i> Summary : Using a simple toy problem to learn object detection methods and principles</i> </h6> <p class="post-summary">Posted by : <img src="/assets/img/profile.png" class="author-profile-img"> <span itemprop="author" itemscope itemtype="http://schema.org/Person"> <span itemprop="name">Wilson Fok</span> </span> on <time datetime="2020-08-02 00:00:00 +0800" itemprop="datePublished">Aug 2, 2020</time> </p> <span class="disqus-comment-count" data-disqus-identifier="/deep_learning/2020/08/02/Learning_Object_Detection_part2/"></span> <div class="post-categories"> Category : <a href="/blog/categories/Deep_Learning">Deep_Learning</a> </div> </div> <div class="card-body" itemprop="articleBody"> <h3 id="toy-dataset">Toy Dataset</h3> <p>I think RetinaNet is a good starting point, for RetinaNet is relatively simple to implement and its performance is fairly good across different public datasets. To begin, I have artificially synthesized a very simple toy dataset to learn object detection methods and principles.</p> <p><img src="/assets/images/toy/dataset/toyDataset.png" alt="Picture description" width="1100px" /></p> <center> Samples from toy dataset, showing different shapes and colors </center> <p></p> <p>A sample of what is inside the toy dataset is shown above. Black background with three objects, namely a circle, a rectangle and a triangle. These shapes can have various sizes. Their areas have to be greater than minimum area threshold. The rationale is that I have realized if the objects are too tiny, we need to either create more tiny anchor boxes to cover them or expand the feature pyramid levels to cover a wider range of object sizes. The threshold I picked seems to work well; the circle, rectangle and triangles are not too big and not too small on the input canvas of 224 by 224. The objects can have one of the following colors: red, green and blue. Thus, we see:</p> <ul> <li>Red circle</li> <li>Red rectangle</li> <li> <p>Red triangle</p> </li> <li>Blue circle</li> <li>Blue rectangle</li> <li> <p>Blue triangle</p> </li> <li>Green circle</li> <li>Green rectangle</li> <li>Green triangle</li> </ul> <p>The locations, shapes, and colors are all independently and randomly generated. To draw a circle, I need to generate a random radius value. The “area” is not strictly the area of a circle, but it refers to the area of its bounding boxes. Nonetheless, such differences are negligible for this task. To draw a rectangle, I need to generate random corner coordinates. A rectangle can be a square if its width is as long as its height.</p> <p>The hardest shape to draw is a triangle. The three corners of the triangle cannot be on a plane or anywhere close to it as it can make the triangle looks very flat or like a line. The corners are constrained such that one corner cannot be too far or too close from another corner. To do so, I have generated the corners one by one as I continuously check whether constrains are met. A balltree algorithm is a good way to quickly work out the distances of all nearly points inside a neighborhood of a certain radius. Another check is to make sure corners are not aligned on a single plane, so that the triangle looks like a triangle.</p> <p>OpenCV have functions for drawing circle and rectangle directly, but not triangle. However, it is easy because we just need to first connect the three corners by lines and fill up the enclosed area. 5000 and 100 images are generated for training and testing respectively.</p> <p>The way this toy dataset is generated has some ramification. Currently, color and shape are independent. Later, because of this independence, I have trained a shape detector and a color classifier separately. Furthermore, I have only tried one object for each shape. It can easily be extended to more objects with different shapes. I would recommend my readers to try with more objects and to observe how the detector handles them.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">BallTree</span>

<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="n">MIN_AREA</span> <span class="o">=</span> <span class="mi">400</span> <span class="c1"># the bounding box's area
</span>
<span class="k">def</span> <span class="nf">generate_corners</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">ratio</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
    <span class="n">x1</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">W</span><span class="p">),</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">x2</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">W</span><span class="o">*</span><span class="n">ratio</span><span class="p">)),</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span> <span class="c1"># at least 1 pixel further
</span>    
    <span class="k">return</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span>

<span class="k">def</span> <span class="nf">add_circle</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">ratio</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
    
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        
        <span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">W</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">color</span><span class="p">,</span> <span class="n">color_label</span> <span class="o">=</span> <span class="n">random_color</span><span class="p">()</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">W</span><span class="o">*</span><span class="n">ratio</span><span class="p">)),</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="n">col</span> <span class="o">-</span> <span class="n">r</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="n">col</span> <span class="o">+</span> <span class="n">r</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="n">row</span> <span class="o">-</span> <span class="n">r</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="n">row</span> <span class="o">+</span> <span class="n">r</span>
        
        <span class="n">area</span> <span class="o">=</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span>
        <span class="k">print</span> <span class="p">(</span><span class="n">area</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">area</span> <span class="o">&gt;</span> <span class="n">MIN_AREA</span><span class="p">:</span>
            
            <span class="k">break</span>
    <span class="c1"># -1 means filled    
</span>    <span class="n">cv2</span><span class="p">.</span><span class="n">circle</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">),</span> <span class="n">r</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">img</span><span class="p">,</span> <span class="n">color_label</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span>

<span class="k">def</span> <span class="nf">random_color</span><span class="p">():</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="n">choice</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">arr</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span>
    <span class="c1"># cv2 takes tuple
</span>    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">arr</span><span class="p">),</span> <span class="n">c</span>

<span class="k">def</span> <span class="nf">add_rectangle</span><span class="p">(</span><span class="n">img</span><span class="p">):</span>
    <span class="n">H</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">img</span><span class="p">.</span><span class="n">shape</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">generate_corners</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
        <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">generate_corners</span><span class="p">(</span><span class="n">H</span><span class="p">)</span>
        
        <span class="n">area</span> <span class="o">=</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">area</span> <span class="o">&gt;</span> <span class="n">MIN_AREA</span><span class="p">:</span>
            <span class="k">break</span> 
    <span class="n">color</span><span class="p">,</span> <span class="n">color_label</span> <span class="o">=</span> <span class="n">random_color</span><span class="p">()</span>
    <span class="n">cv2</span><span class="p">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">),</span> <span class="n">color</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">img</span><span class="p">,</span> <span class="n">color_label</span><span class="p">,</span> <span class="n">x1</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="n">x2</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span> <span class="n">y1</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="n">y2</span><span class="o">+</span><span class="mi">3</span> <span class="c1"># not to tight
</span>
<span class="k">def</span> <span class="nf">not_being_too_close</span><span class="p">(</span><span class="n">q2</span><span class="p">,</span> <span class="n">dist</span><span class="p">):</span>
    <span class="n">q2</span> <span class="o">=</span> <span class="n">q2</span><span class="p">[</span><span class="n">dist</span> <span class="o">&gt;=</span> <span class="n">np</span><span class="p">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="mi">80</span><span class="p">)]</span> <span class="c1"># higher than 80% of samples
</span>    <span class="k">return</span> <span class="n">q2</span>

<span class="k">def</span> <span class="nf">come_up_with_co</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">co</span><span class="p">,</span> <span class="n">tree</span><span class="p">):</span>
    
    <span class="n">q2</span><span class="p">,</span> <span class="n">dist</span> <span class="o">=</span> <span class="n">tree</span><span class="p">.</span><span class="n">query_radius</span><span class="p">([[</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">]],</span> <span class="n">r</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">return_distance</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">q2</span> <span class="o">=</span> <span class="n">q2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">dist</span> <span class="o">=</span> <span class="n">dist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="n">coq2</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="n">co</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">q2</span><span class="p">])</span>
    <span class="c1"># avoid points on the same plane
</span>    <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">dstack</span><span class="p">([</span><span class="n">coq2</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">x1</span><span class="p">,</span> <span class="n">coq2</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">y1</span><span class="p">]))</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nb">all</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">IndexError</span><span class="p">:</span>
        <span class="n">redo</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">redo</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">q2</span> <span class="o">=</span> <span class="n">q2</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="n">dist</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
        
        <span class="n">q2</span> <span class="o">=</span> <span class="n">not_being_too_close</span><span class="p">(</span><span class="n">q2</span><span class="p">,</span> <span class="n">dist</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="n">redo</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">redo</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">redo</span><span class="p">,</span> <span class="n">q2</span><span class="p">)</span>
    
<span class="k">def</span> <span class="nf">add_triangle</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">tree</span><span class="p">,</span> <span class="n">co</span><span class="p">,</span> <span class="n">W</span><span class="p">):</span>
    
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">redo</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">while</span> <span class="n">redo</span><span class="p">:</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">generate_corners</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="n">come_up_with_co</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span><span class="n">co</span><span class="p">,</span> <span class="n">tree</span><span class="p">)</span>
            <span class="n">redo</span> <span class="o">=</span> <span class="n">ans</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            
        <span class="n">q2</span> <span class="o">=</span> <span class="n">ans</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        
        <span class="n">redo</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">while</span> <span class="n">redo</span><span class="p">:</span>
            <span class="n">vertices2</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">q2</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">co</span><span class="p">[</span><span class="n">vertices2</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="n">come_up_with_co</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="n">co</span><span class="p">,</span> <span class="n">tree</span><span class="p">)</span>
            <span class="n">redo</span> <span class="o">=</span> <span class="n">ans</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">q3</span> <span class="o">=</span> <span class="n">ans</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        
        <span class="n">vertices3</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">q3</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">x3</span><span class="p">,</span> <span class="n">y3</span> <span class="o">=</span> <span class="n">co</span><span class="p">[</span><span class="n">vertices3</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        
        <span class="c1">#make sure the datatype is correct for cv
</span>        <span class="n">vertices</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([[</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">],</span> <span class="p">[</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">],</span> <span class="p">[</span><span class="n">x3</span><span class="p">,</span> <span class="n">y3</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">color</span><span class="p">,</span> <span class="n">color_label</span> <span class="o">=</span> <span class="n">random_color</span><span class="p">()</span>
        
        
        <span class="n">bbx1</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">x3</span><span class="p">])</span>
        <span class="n">bby1</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">y1</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span> <span class="n">y3</span><span class="p">])</span>
        <span class="n">bbx2</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">x3</span><span class="p">])</span>
        <span class="n">bby2</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">y1</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span> <span class="n">y3</span><span class="p">])</span>
        
        <span class="n">area</span> <span class="o">=</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">area</span> <span class="o">&gt;</span> <span class="n">MIN_AREA</span><span class="p">:</span>
            <span class="k">break</span>
        
    <span class="n">cv2</span><span class="p">.</span><span class="n">polylines</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">[</span><span class="n">pts</span><span class="p">],</span> <span class="n">isClosed</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">cv2</span><span class="p">.</span><span class="n">fillPoly</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">[</span><span class="n">pts</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">img</span><span class="p">,</span> <span class="n">color_label</span><span class="p">,</span> <span class="n">bbx1</span><span class="p">,</span> <span class="n">bbx2</span><span class="p">,</span> <span class="n">bby1</span><span class="p">,</span> <span class="n">bby2</span>

<span class="n">H</span><span class="p">,</span><span class="n">W</span> <span class="o">=</span> <span class="mi">224</span><span class="p">,</span> <span class="mi">224</span>
<span class="n">MAX_SAMPLES</span> <span class="o">=</span> <span class="mi">40</span>

<span class="n">output_dir</span> <span class="o">=</span> <span class="p">.......</span>

<span class="n">shape_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">color_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">color_dict</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="s">'red'</span><span class="p">,</span>
              <span class="mi">1</span><span class="p">:</span><span class="s">'green'</span><span class="p">,</span>
              <span class="mi">2</span><span class="p">:</span><span class="s">'blue'</span><span class="p">}</span>

<span class="c1"># setup a grid
</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="n">H</span><span class="p">)</span>
<span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>

<span class="n">co</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">dstack</span><span class="p">([</span><span class="n">X</span><span class="p">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">Y</span><span class="p">.</span><span class="n">flatten</span><span class="p">()])</span>
<span class="n">co</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">co</span><span class="p">)</span>
<span class="n">tree</span> <span class="o">=</span> <span class="n">BallTree</span><span class="p">(</span><span class="n">co</span><span class="p">)</span>


<span class="k">for</span> <span class="n">counter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MAX_SAMPLES</span><span class="p">):</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">H</span><span class="p">,</span><span class="n">W</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
    
    
    <span class="n">img</span><span class="p">,</span> <span class="n">color_label</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">add_circle</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    <span class="n">img</span><span class="p">,</span> <span class="n">color_label</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">add_rectangle</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    <span class="n">img</span><span class="p">,</span> <span class="n">color_label</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">add_triangle</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">tree</span><span class="p">,</span> <span class="n">co</span><span class="p">,</span> <span class="n">W</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    
<span class="c1">#    plt.show()
</span>    <span class="n">plt</span><span class="p">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span> <span class="o">+</span> <span class="s">'.png'</span><span class="p">),</span>
                <span class="n">transparent</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    
    <span class="k">del</span> <span class="n">img</span>


</code></pre></div></div> </div> <div id="disqus_thread"></div> </article> <article class="card" itemscope itemtype="http://schema.org/BlogPosting"> <div class="card-body" itemprop="articleBody"> <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"> <div class="card-header"> <span class="title"> <i class="fa fa-share"></i> Share this to: </span> </div> <div id="share-bar"> <div class="share-buttons"> <a href="https://www.facebook.com/sharer/sharer.php?u=/deep_learning/2020/08/02/Learning_Object_Detection_part2/" onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook" > <i class="fa fa-facebook-official share-button"> facebook</i> </a> <a href="https://twitter.com/intent/tweet?text=Learning object detection part 2 - detection of shapes and colors&url=/deep_learning/2020/08/02/Learning_Object_Detection_part2/" onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter" > <i class="fa fa-twitter share-button"> twitter</i> </a> <a href="https://plus.google.com/share?url=/deep_learning/2020/08/02/Learning_Object_Detection_part2/" onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Google+" > <i class="fa fa-google-plus share-button"> google</i> </a> <a href="https://www.pinterest.com/pin/create/button/?url=/deep_learning/2020/08/02/Learning_Object_Detection_part2/" onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;" title="Share on Pinterest" > <i class="fa fa-pinterest-p share-button"> pinterest</i> </a> <a href="https://www.tumblr.com/share/link?url=/deep_learning/2020/08/02/Learning_Object_Detection_part2/" onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;" title="Share on Tumblr" > <i class="fa fa-tumblr share-button"> tumblr</i> </a> <a href="http://www.reddit.com/submit?url=/deep_learning/2020/08/02/Learning_Object_Detection_part2/" onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;" title="Share on Reddit" > <i class="fa fa-reddit-alien share-button"> reddit</i> </a> <a href="https://www.linkedin.com/shareArticle?mini=true&url=/deep_learning/2020/08/02/Learning_Object_Detection_part2/&title=Learning object detection part 2 - detection of shapes and colors&summary=&source=Wilson Fok" onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn" > <i class="fa fa-linkedin share-button"> linkedin</i> </a> <a href="mailto:?subject=Learning object detection part 2 - detection of shapes and colors&amp;body=Check out this site /deep_learning/2020/08/02/Learning_Object_Detection_part2/" title="Share via Email" > <i class="fa fa-envelope share-button"> email</i> </a> </div> </div> </div> </article> <script> var disqus_config = function () { this.page.url = "/deep_learning/2020/08/02/Learning_Object_Detection_part2/"; /* Replace PAGE_URL with your page's canonical URL variable */ this.page.identifier = "/deep_learning/2020/08/02/Learning_Object_Detection_part2"; /* Replace PAGE_IDENTIFIER with your page's unique identifier variable */ }; (function () { /* DON'T EDIT BELOW THIS LINE */ var d = document, s = d.createElement('script'); s.src = 'https://.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a> </noscript></div> </div> <!-- End of row--> <div class="row"> <div class="col-md-4"> <div class="card"> <div class="card-header"> About </div> <div class="card-body"> <!-- Your Bio --> <p class="author_bio"> Hello, My name is Wilson Fok. I love to extract useful insights and knowledge from big data. Constructive feedback and insightful comments are very welcome!</p> </div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-header">Categories </div> <div class="card-body text-dark"> <div id="#Finance"></div> <li class="tag-head"> <a href="/blog/categories/Finance">Finance</a> </li> <a name="Finance"></a> <div id="#NLP"></div> <li class="tag-head"> <a href="/blog/categories/NLP">NLP</a> </li> <a name="NLP"></a> <div id="#Deep_Learning"></div> <li class="tag-head"> <a href="/blog/categories/Deep_Learning">Deep_Learning</a> </li> <a name="Deep_Learning"></a> <div id="#Others"></div> <li class="tag-head"> <a href="/blog/categories/Others">Others</a> </li> <a name="Others"></a> <div id="#Reading"></div> <li class="tag-head"> <a href="/blog/categories/Reading">Reading</a> </li> <a name="Reading"></a> <div id="#Toastmasters"></div> <li class="tag-head"> <a href="/blog/categories/Toastmasters">Toastmasters</a> </li> <a name="Toastmasters"></a> </div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-header">Useful Links </div> <div class="card-body text-dark"> <li > <a href="/about">About Me</a> </li> <li > <a href="/blog">Blog</a> </li> <li > <a href="/blog/categories">Categories</a> </li> <li > <a href="/gallery">Gallery</a> </li> <li > <a href="/contact">Contact Me</a> </li> </div> </div> </div> </div> </div> <footer> <p> Powered by Jekyll. Hosted on <a href="https://pages.github.com">Github</a>. Subscribe via <a href=" /feed.xml ">RSS <i class="fa fa-rss" aria-hidden="true"></i> </a> </p> </footer> </div> <script> var options = { classname: 'my-class', id: 'my-id' }; var nanobar = new Nanobar( options ); nanobar.go( 30 ); nanobar.go( 76 ); nanobar.go(100); </script> <!-- <div hidden id="snipcart" data-api-key="Y2I1NTAyNWYtMTNkMy00ODg0LWE4NDItNTZhYzUxNzJkZTI5NjM3MDI4NTUzNzYyMjQ4NzU0"></div> <script src="https://cdn.snipcart.com/themes/v3.0.0-beta.3/default/snipcart.js" defer></script> --> <script src="/assets/js/mode-switcher.js"></script> <script src="/assets/js/slideshow.js"></script> </body> </html>
