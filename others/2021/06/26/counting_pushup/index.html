<!DOCTYPE html> <html lang=" en "><head> <meta charset="utf-8"> <title>Wilson Fok - A data science enthusiast</title> <meta http-equip="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <meta name="description" content="Counting Push ups" /> <meta name="keywords" content="Counting Push ups, Wilson Fok, Others" /> <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml"> <meta content="" property="fb:app_id"> <meta content="Wilson Fok" property="og:site_name"> <meta content="Counting Push ups" property="og:title"> <meta content="article" property="og:type"> <meta content="Detecting and quantifying change of motion via optical flow algorithm" property="og:description"> <meta content="/others/2021/06/26/counting_pushup/" property="og:url"> <meta content="2021-06-26T00:00:00+08:00" property="article:published_time"> <meta content="/about/" property="article:author"> <meta content="/assets/img/posts//assets/images/pushup/rate.png" property="og:image"> <meta content="Others" property="article:section"> <meta name="twitter:card" content="summary"> <meta name="twitter:site" content="@"> <meta name="twitter:creator" content="@"> <meta name="twitter:title" content="Counting Push ups"> <meta content="Wilson Fok" property="og:site_name"> <meta name="twitter:url" content="/others/2021/06/26/counting_pushup/"> <meta name="twitter:description" content="Hello, My name is Wilson Fok. I love to extract useful insights and knowledge from big data. I also like to make new friends and connections. Let's connect! "> <!-- load layout style css --> <link rel="stylesheet" href="/assets/css/main.css" /> <link rel="stylesheet" href="/assets/css/custom-style.css" /> <link rel="stylesheet" href="/assets/bower_components/lightgallery/dist/css/lightgallery.min.css"/> <link rel="stylesheet" href="/assets/bower_components/bootstrap/dist/css/bootstrap.min.css" /> <link rel="stylesheet" href="/assets/bower_components/font-awesome/web-fonts-with-css/css/fontawesome-all.min.css" /> <!-- Favicon --> <link rel="icon" href="/assets/img/favicon.ico" type="image/gif" sizes="16x16"> <!-- Jquery --> <!-- one or more of the below scripts does fancy word animation and dropdown menu --> <script src="/assets/extra_js/jquery-3.4.1.min.js"></script> <script src="/assets/extra_js/picturefill min/picturefill.min.js"></script> <script src="/assets/extra_js/instantsearch min/instantsearch.min.js"></script> <script src="/assets/extra_js/moment min/moment.min.js"></script> <script src="/assets/bower_components/jquery.easing/jquery.easing.min.js"></script> <script src="/assets/bower_components/bootstrap/dist/js/bootstrap.bundle.min.js"></script> <script src="/assets/bower_components/jquery-mousewheel/jquery.mousewheel.min.js"></script> <script src="/assets/bower_components/lightgallery/dist/js/lightgallery-all.min.js"></script> <script src="/assets/bower_components/imagesloaded/imagesloaded.pkgd.min.js"></script> <script src="/assets/bower_components/nanobar/nanobar.min.js"></script> <script src="/assets/bower_components/typewrite/dist/typewrite.min.js"></script> </head><body> <div class="container-fluid"><header> <script src="https://cdn.knightlab.com/libs/juxtapose/latest/js/juxtapose.min.js"></script> <link rel="stylesheet" href="https://cdn.knightlab.com/libs/juxtapose/latest/css/juxtapose.css"> <div class="col-lg-12"> <div class="row"> <nav class="navbar navbar-expand-lg fixed-top navbar-dark " id="topNav"> <!-- <a class="navbar-brand" href="#">Wilson Fok</a> --> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="/">Wilson Fok</a> <div class="collapse navbar-collapse" id="navbarNav"> <ul class="navbar-nav"> <li class="nav-item"> <a class="nav-link" href="/about">About Me</a> </li> <li class="nav-item"> <a class="nav-link" href="/blog">Blog</a> </li> <li class="nav-item"> <a class="nav-link" href="/blog/categories">Categories</a> </li> <li class="nav-item"> <a class="nav-link" href="/gallery">Gallery</a> </li> <li class="nav-item"> <a class="nav-link" href="/contact">Contact Me</a> </li> </ul> </div> <ul class="nav justify-content-end"> <!-- <li class="nav-item"> <a class="nav-link" id="search-icon" href="/search/"><i class="fa fa-search" aria-hidden="true"></i></a> </li> --> <li class="nav-item"> <input class="nav-link switch" id="theme-toggle" onclick="modeSwitcher() "type="checkbox" name="checkbox" > </li> </ul> </nav> </div> </div> </header><div class="col-lg-12"> <!-- Blog Post Breadcrumbs --><div class="col-lg-12"> <nav aria-label="breadcrumb" role="navigation"> <ol class="breadcrumb"> <li class="breadcrumb-item"> <a href="/blog"><i class="fa fa-home" aria-hidden="true"></i></a> </li> <li class="breadcrumb-item active" aria-current="page"><a href="/others/2021/06/26/counting_pushup/">Counting Push ups</a></li> </ol> </nav> </div><div class="row" id="blog-post-container"> <div class="col-lg-8 offset-md-2"><article class="card" itemscope itemtype="http://schema.org/BlogPosting"> <div class="card-header"> <h1 class="post-title" itemprop="name headline">Counting Push ups</h1> <p></p> <h6 class="post-meta"> <i> Summary : Detecting and quantifying change of motion via optical flow algorithm</i> </h6> <p class="post-summary">Posted by : <img src="/assets/img/profile.png" class="author-profile-img"> <span itemprop="author" itemscope itemtype="http://schema.org/Person"> <span itemprop="name">Wilson Fok</span> </span> on <time datetime="2021-06-26 00:00:00 +0800" itemprop="datePublished">Jun 26, 2021</time> </p> <span class="disqus-comment-count" data-disqus-identifier="/others/2021/06/26/counting_pushup/"></span> <div class="post-categories"> Category : <a href="/blog/categories/Others">Others</a> </div> </div> <div class="card-body" itemprop="articleBody"> <h2 id="introduction">Introduction</h2> <p>Today I would like to share with you on some basic operations:</p> <ul> <li>Reading a video</li> <li>Detecting and quantifying change of motion via optical flow algorithm</li> <li>Measuring action duration</li> <li>Writing a video</li> </ul> <p>The motivation comes from a recent job interview I had. During Q and A session of the interview, I was asked to use a simple algorithm to count the number of repetitions a subject has performed in a short video. So what I am about to share may be of some use.</p> <h2 id="methods">Methods</h2> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c1"># -*- coding: utf-8 -*-
</span>
<span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">from</span> <span class="nn">skimage.measure</span> <span class="kn">import</span> <span class="n">label</span><span class="p">,</span> <span class="n">regionprops</span>

<span class="k">def</span> <span class="nf">calculate_area</span><span class="p">(</span><span class="n">threshold</span><span class="p">,</span> <span class="n">arr</span><span class="p">,</span> <span class="n">status</span><span class="p">):</span>
    
    <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">greater_equal</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">threshold</span><span class="p">)</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nb">all</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    

    <span class="n">label_image</span> <span class="o">=</span> <span class="n">label</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
    
    
    <span class="n">biggest</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="n">regionprops</span><span class="p">(</span><span class="n">label_image</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">region</span><span class="p">.</span><span class="n">area</span> <span class="o">&gt;=</span> <span class="n">biggest</span><span class="p">:</span>
            <span class="n">biggest</span> <span class="o">=</span> <span class="n">region</span><span class="p">.</span><span class="n">area</span>

            
    <span class="c1"># print ('biggest area for ', status, biggest)
</span>    
    <span class="k">return</span> <span class="n">biggest</span>

<span class="c1">################# config ###################
</span><span class="n">font</span>                   <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">FONT_HERSHEY_SIMPLEX</span>
<span class="n">bottomLeftCornerOfText</span> <span class="o">=</span> <span class="p">(</span><span class="mi">150</span><span class="p">,</span><span class="mi">150</span><span class="p">)</span>
<span class="n">fontScale</span>              <span class="o">=</span> <span class="mi">1</span>
<span class="n">fontColor</span>              <span class="o">=</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">)</span>
<span class="n">lineType</span>               <span class="o">=</span> <span class="mi">2</span>
    
    
<span class="s">'''
BGR format (default of openCV)
color intensity thresholds
'''</span>
<span class="n">up_threshold</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([[[</span><span class="mi">100</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]]])</span>
<span class="n">area_threshold</span> <span class="o">=</span> <span class="mi">5000</span>

<span class="n">down_threshold</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">0</span><span class="p">]]])</span>

<span class="n">rep</span> <span class="o">=</span> <span class="p">[]</span>

<span class="s">'''
capture video stream but discard the audio stream
'''</span>
<span class="n">cap</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="s">"test.mp4"</span><span class="p">)</span>
<span class="n">fps</span> <span class="o">=</span> <span class="n">cap</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">cv2</span><span class="p">.</span><span class="n">CAP_PROP_FPS</span><span class="p">)</span>
<span class="k">print</span> <span class="p">(</span><span class="s">"Frames per second : {0}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">fps</span><span class="p">))</span>

<span class="s">'''
MJPG codecs generate AVI videos
'''</span>
<span class="n">fourcc</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">VideoWriter_fourcc</span><span class="p">(</span><span class="s">'M'</span><span class="p">,</span><span class="s">'J'</span><span class="p">,</span><span class="s">'P'</span><span class="p">,</span><span class="s">'G'</span><span class="p">)</span>

<span class="c1"># double the width to accommadate raw video and optical flow
</span><span class="n">out</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">VideoWriter</span><span class="p">(</span><span class="s">'output_count.avi'</span><span class="p">,</span><span class="n">fourcc</span><span class="p">,</span> <span class="n">fps</span> <span class="p">,(</span><span class="nb">int</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">cap</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="mi">3</span><span class="p">)),</span><span class="nb">int</span><span class="p">(</span><span class="n">cap</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
                                                       <span class="p">))</span>

<span class="n">ret</span><span class="p">,</span> <span class="n">frame1</span> <span class="o">=</span> <span class="n">cap</span><span class="p">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">prvs</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">frame1</span><span class="p">,</span><span class="n">cv2</span><span class="p">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
<span class="n">hsv</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">frame1</span><span class="p">)</span>
<span class="n">hsv</span><span class="p">[...,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span>
<span class="n">i</span><span class="o">=</span> <span class="mi">0</span>
<span class="n">timestamps</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">while</span><span class="p">(</span><span class="n">cap</span><span class="p">.</span><span class="n">isOpened</span><span class="p">()):</span>
    <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
    

    <span class="n">ret</span><span class="p">,</span> <span class="n">frame2</span> <span class="o">=</span> <span class="n">cap</span><span class="p">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">ret</span><span class="p">):</span> <span class="k">break</span>
    <span class="nb">next</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">frame2</span><span class="p">,</span><span class="n">cv2</span><span class="p">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">flow</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">calcOpticalFlowFarneback</span><span class="p">(</span><span class="n">prvs</span><span class="p">,</span><span class="nb">next</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">flow</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">calcOpticalFlowFarneback</span><span class="p">(</span><span class="n">prvs</span><span class="p">,</span><span class="nb">next</span><span class="p">,</span> <span class="n">flow</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    
    <span class="n">mag</span><span class="p">,</span> <span class="n">ang</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">cartToPolar</span><span class="p">(</span><span class="n">flow</span><span class="p">[...,</span><span class="mi">0</span><span class="p">],</span> <span class="n">flow</span><span class="p">[...,</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">hsv</span><span class="p">[...,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ang</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">hsv</span><span class="p">[...,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">mag</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="n">cv2</span><span class="p">.</span><span class="n">NORM_MINMAX</span><span class="p">)</span>
    <span class="n">rgb</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">hsv</span><span class="p">,</span><span class="n">cv2</span><span class="p">.</span><span class="n">COLOR_HSV2BGR</span><span class="p">)</span>
    
    
    <span class="n">d1</span> <span class="o">=</span> <span class="n">calculate_area</span><span class="p">(</span><span class="n">down_threshold</span><span class="p">,</span> <span class="n">rgb</span><span class="p">,</span> <span class="s">'down'</span><span class="p">)</span>
    <span class="n">u1</span> <span class="o">=</span> <span class="n">calculate_area</span><span class="p">(</span><span class="n">up_threshold</span><span class="p">,</span> <span class="n">rgb</span><span class="p">,</span> <span class="s">'up'</span><span class="p">)</span>
    
    
    <span class="k">if</span> <span class="n">d1</span> <span class="o">&gt;</span> <span class="n">area_threshold</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">u1</span> <span class="o">&gt;</span>  <span class="n">area_threshold</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">d1</span> <span class="o">&gt;</span> <span class="n">u1</span><span class="p">:</span>
                <span class="n">status</span> <span class="o">=</span> <span class="s">'down'</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">status</span> <span class="o">=</span> <span class="s">'up'</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">status</span> <span class="o">=</span> <span class="s">'down'</span>
    <span class="k">elif</span> <span class="n">u1</span> <span class="o">&gt;</span> <span class="n">area_threshold</span><span class="p">:</span>
        <span class="n">status</span> <span class="o">=</span> <span class="s">'up'</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">status</span> <span class="o">=</span> <span class="bp">None</span>
        
        
    <span class="k">if</span> <span class="n">status</span><span class="p">:</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rep</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">rep</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>
            <span class="n">timestamps</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">rep</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">status</span><span class="p">:</span>
            <span class="n">rep</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>
            <span class="n">timestamps</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

    
    <span class="k">print</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">timestamps</span><span class="p">,</span> <span class="n">rep</span><span class="p">,</span> <span class="n">rep</span><span class="p">.</span><span class="n">count</span><span class="p">(</span><span class="s">'down'</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    
 
    
    <span class="n">cv2</span><span class="p">.</span><span class="n">putText</span><span class="p">(</span><span class="n">frame2</span><span class="p">,</span> <span class="s">"Repetitions: "</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rep</span><span class="p">.</span><span class="n">count</span><span class="p">(</span><span class="s">'down'</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">bottomLeftCornerOfText</span><span class="p">,</span><span class="n">font</span><span class="p">,</span> <span class="n">fontScale</span><span class="p">,</span><span class="n">fontColor</span><span class="p">,</span><span class="n">lineType</span><span class="p">)</span>
    
    <span class="n">frame2</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">frame2</span><span class="p">,</span> <span class="n">rgb</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="n">out</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">frame2</span><span class="p">)</span>
    <span class="n">prvs</span> <span class="o">=</span> <span class="nb">next</span>
    
    <span class="c1"># if i &gt; 30:
</span>    <span class="c1">#     break
</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Video Generated"</span><span class="p">)</span>
<span class="n">out</span><span class="p">.</span><span class="n">release</span><span class="p">()</span>
<span class="n">cap</span><span class="p">.</span><span class="n">release</span><span class="p">()</span>
<span class="n">cv2</span><span class="p">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>

<span class="c1">################# rate of motion ###############
</span>
<span class="n">rates</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">diff</span><span class="p">(</span><span class="n">timestamps</span><span class="p">)</span>

<span class="n">down_up</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">rates</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1</span><span class="o">/</span><span class="n">fps</span>
<span class="n">up_down</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">rates</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span> <span class="p">)</span> <span class="o">*</span> <span class="mi">1</span><span class="o">/</span><span class="n">fps</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="n">num</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="p">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span><span class="p">.</span><span class="n">bar</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="p">.</span><span class="n">mean</span><span class="p">(</span><span class="n">down_up</span><span class="p">),</span> <span class="n">yerr</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">std</span><span class="p">(</span><span class="n">down_up</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="s">'b'</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">bar</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">np</span><span class="p">.</span><span class="n">mean</span><span class="p">(</span><span class="n">up_down</span><span class="p">),</span> <span class="n">yerr</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">std</span><span class="p">(</span><span class="n">up_down</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="s">'g'</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">)</span>
<span class="c1"># ax.legend()
</span><span class="n">ax</span><span class="p">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s">'down_to_up'</span><span class="p">,</span> <span class="s">'up_to_down'</span><span class="p">])</span>
<span class="n">ax</span><span class="p">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">'time taken to perform a motion in seconds'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="s">'Push up: is it faster to drop back down than to push up?'</span><span class="p">)</span>

<span class="n">plt</span><span class="p">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">'rate.png'</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s">'tight'</span> <span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

</code></pre></div></div> <p>Optical flow measures the u and v velocity vectors (horizontal and vertical) by assuming that adjacent frames are similar except the object that has moved. After watching the video, I believe this assumption is largely valid. The background is mostly static with exception I shall discuss later in the result section and its intensity remains constant throughout. The algorithm reads the video frame by frame and calculates FarneBack (optical flow algorithm) on sequential frames.</p> <p>Dense optical flow such as FarneBack has a benefit over sparse optical flow algorithms. Unlike a sparse optical flow algorithm which tracks the movement of targeted markers or points, it does not need to track feature points on the torso. The torso features are unnecessary as the torso itself occupies a large area of the center in each frame. It is worth noting that, despite using the previous flow value as the initialization of the next frame, the final flow appears to be the same with or without initialization.</p> <h2 id="results">Results</h2> <p>When someone pushes up, we look for directional change of the torso. By mapping the flow vectors to the RGB color space, we can intuitively “see” the motion vector in action.</p> <iframe width="560" height="315" src="https://www.youtube.com/embed/3UMkwWXNf90" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe> <p>Left panel shows the raw video along with the repetition counts written in white. Right panel shows the optical flow magnitude for the most recent 2 frames.</p> <p>At the time when the torso changes its direction (either at the top or at the ground / bottom), optical flow quantifies the vector change which can be easily seen in color above. That change occurs predominantly at a specific direction (shown in a particular color) and occurs with a large group of pixels outlining the torso of the subject. Thus, a simple thresholding is sufficient to trigger and record the signal. Going back to the camera motion noise, on some specific frames, we observe non-zero optical flow values across the entire background. I suspect this is due to the camera motion as I see the camera shifted amid the push up.</p> <p><img src="/assets/images/pushup/rate.png" alt="Picture description" width="512px" /></p> <p>Typically pushing upward is more effortful than dropping down. We can demonstrate this in the video by calculating the time elapsed between pushing up and dropping down. The frame at which direction has changed tells us the time of the occurrences and the difference between them indicates their duration. The time from down position to up position is plotted in blue; from up position to down position in green. More time taken in the pushing up than dropping down.</p> <h2 id="conclusions">Conclusions</h2> <p>I hope this short tutorial is helpful for your next interview.</p> <h2 id="references">References</h2> <ul> <li><a href="https://docs.opencv.org/3.4/d4/dee/tutorial_optical_flow.html">OpenCV tutorials on Optical Flow</a></li> </ul> </div> <div id="disqus_thread"></div> </article> <article class="card" itemscope itemtype="http://schema.org/BlogPosting"> <div class="card-body" itemprop="articleBody"> <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"> <div class="card-header"> <span class="title"> <i class="fa fa-share"></i> Share this to: </span> </div> <div id="share-bar"> <div class="share-buttons"> <a href="https://www.facebook.com/sharer/sharer.php?u=/others/2021/06/26/counting_pushup/" onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook" > <i class="fa fa-facebook-official share-button"> facebook</i> </a> <a href="https://twitter.com/intent/tweet?text=Counting Push ups&url=/others/2021/06/26/counting_pushup/" onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter" > <i class="fa fa-twitter share-button"> twitter</i> </a> <a href="https://plus.google.com/share?url=/others/2021/06/26/counting_pushup/" onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Google+" > <i class="fa fa-google-plus share-button"> google</i> </a> <a href="https://www.pinterest.com/pin/create/button/?url=/others/2021/06/26/counting_pushup/" onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;" title="Share on Pinterest" > <i class="fa fa-pinterest-p share-button"> pinterest</i> </a> <a href="https://www.tumblr.com/share/link?url=/others/2021/06/26/counting_pushup/" onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;" title="Share on Tumblr" > <i class="fa fa-tumblr share-button"> tumblr</i> </a> <a href="http://www.reddit.com/submit?url=/others/2021/06/26/counting_pushup/" onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;" title="Share on Reddit" > <i class="fa fa-reddit-alien share-button"> reddit</i> </a> <a href="https://www.linkedin.com/shareArticle?mini=true&url=/others/2021/06/26/counting_pushup/&title=Counting Push ups&summary=&source=Wilson Fok" onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn" > <i class="fa fa-linkedin share-button"> linkedin</i> </a> <a href="mailto:?subject=Counting Push ups&amp;body=Check out this site /others/2021/06/26/counting_pushup/" title="Share via Email" > <i class="fa fa-envelope share-button"> email</i> </a> </div> </div> </div> </article> <script> var disqus_config = function () { this.page.url = "/others/2021/06/26/counting_pushup/"; /* Replace PAGE_URL with your page's canonical URL variable */ this.page.identifier = "/others/2021/06/26/counting_pushup"; /* Replace PAGE_IDENTIFIER with your page's unique identifier variable */ }; (function () { /* DON'T EDIT BELOW THIS LINE */ var d = document, s = d.createElement('script'); s.src = 'https://.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a> </noscript></div> </div> <!-- End of row--> <div class="row"> <div class="col-md-4"> <div class="card"> <div class="card-header"> About </div> <div class="card-body"> <!-- Your Bio --> <p class="author_bio"> Hello, My name is Wilson Fok. I love to extract useful insights and knowledge from big data. Constructive feedback and insightful comments are very welcome!</p> </div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-header">Categories </div> <div class="card-body text-dark"> <div id="#Finance"></div> <li class="tag-head"> <a href="/blog/categories/Finance">Finance</a> </li> <a name="Finance"></a> <div id="#NLP"></div> <li class="tag-head"> <a href="/blog/categories/NLP">NLP</a> </li> <a name="NLP"></a> <div id="#Deep_Learning"></div> <li class="tag-head"> <a href="/blog/categories/Deep_Learning">Deep_Learning</a> </li> <a name="Deep_Learning"></a> <div id="#Others"></div> <li class="tag-head"> <a href="/blog/categories/Others">Others</a> </li> <a name="Others"></a> <div id="#Reading"></div> <li class="tag-head"> <a href="/blog/categories/Reading">Reading</a> </li> <a name="Reading"></a> <div id="#Toastmasters"></div> <li class="tag-head"> <a href="/blog/categories/Toastmasters">Toastmasters</a> </li> <a name="Toastmasters"></a> </div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-header">Useful Links </div> <div class="card-body text-dark"> <li > <a href="/about">About Me</a> </li> <li > <a href="/blog">Blog</a> </li> <li > <a href="/blog/categories">Categories</a> </li> <li > <a href="/gallery">Gallery</a> </li> <li > <a href="/contact">Contact Me</a> </li> </div> </div> </div> </div> </div> <footer> <p> Powered by Jekyll. Hosted on <a href="https://pages.github.com">Github</a>. Subscribe via <a href=" /feed.xml ">RSS <i class="fa fa-rss" aria-hidden="true"></i> </a> </p> </footer> </div> <script> var options = { classname: 'my-class', id: 'my-id' }; var nanobar = new Nanobar( options ); nanobar.go( 30 ); nanobar.go( 76 ); nanobar.go(100); </script> <!-- <div hidden id="snipcart" data-api-key="Y2I1NTAyNWYtMTNkMy00ODg0LWE4NDItNTZhYzUxNzJkZTI5NjM3MDI4NTUzNzYyMjQ4NzU0"></div> <script src="https://cdn.snipcart.com/themes/v3.0.0-beta.3/default/snipcart.js" defer></script> --> <script src="/assets/js/mode-switcher.js"></script> <script src="/assets/js/slideshow.js"></script> </body> </html>
